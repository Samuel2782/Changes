import{I as e,r as t,A as a,a3 as i}from"./index-DY0DW88M.js";import{I as r}from"./IframeMessenger-Bl7PPCjo.js";import s from"./icon-error-state-DPDi2Xf2.js";import{n}from"./_plugin-vue2_normalizer-DeUNqxFl.js";const l=e({name:"IframeHost",props:{messenger:{type:Object,required:!0},startingHeight:{type:String,default:"100%"},fallbackUrl:{type:String,default:""},fallbackTimeoutDelay:{type:Number,default:8e3},allow:{type:String,default:""},loadingSpinner:{type:Boolean,default:!0}},setup:()=>({iframe:t(),offlineTimeout:void 0}),data(){return{height:this.startingHeight,iframeOffline:!1,iframeLoading:!0}},computed:{ready(){return this.messenger.connected},fullFallbackUrl(){return this.fallbackUrl+(this.fallbackUrl.includes("?")?"&fallback=true":"?fallback=true")}},mounted(){this.messenger.addMessageListener(r,this.updateIframeHeight)},destroyed(){clearTimeout(this.offlineTimeout)},methods:{async onIframeLoad(){if(!this.iframe)return this.setIframeOffline();this.iframeLoading=!1,this.offlineTimeout=setTimeout((()=>{this.messenger.connected||this.setIframeOffline()}),this.fallbackTimeoutDelay),await this.messenger.connect(this.iframe)},updateIframeHeight({height:e}){this.height=e??this.startingHeight},setIframeOffline(){a.capture("iframe offline show",{feature:this.messenger.id}),this.iframeOffline=!0},captureFallbackClick(){a.capture("iframe fallback click",{feature:this.messenger.id})}}}),f=()=>{i(((e,t)=>({33679464:e.height})))},o=l.setup;l.setup=o?(e,t)=>(f(),o(e,t)):f;const m=n(l,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"iframe-host"},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[e.iframeOffline?t("div",{key:"offline",staticClass:"iframe-offline"},[e._t("offline",(function(){return[t("inline-svg",{staticClass:"icon icon-error",attrs:{src:s}}),t("p",[e._v("Oops! Looks like something went wrong."),t("br"),e._v("Please continue on our website.")]),e.fallbackUrl?t("a",{staticClass:"button",attrs:{href:e.fullFallbackUrl,"data-test":"fallback-button",target:"_blank"},on:{click:e.captureFallbackClick}},[e._v(" Continue ")]):e._e()]}))],2):t("iframe",{key:e.messenger.url,ref:"iframe",staticClass:"iframe-frame",attrs:{src:e.messenger.url,"data-test-loaded":e.ready,allow:e.allow,allowtransparency:!0},on:{load:e.onIframeLoad}})]),t("transition",{attrs:{name:"fade"}},[e.iframeLoading&&e.loadingSpinner?t("div",{staticClass:"iframe-loading"},[t("div",{staticClass:"loading-spinner"})]):e._e()])],1)}),[],!1,null,"68c66fac").exports;export{m as I};