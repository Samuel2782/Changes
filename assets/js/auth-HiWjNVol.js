import{D as e,J as t,g as o,d as a,K as s}from"./index-DY0DW88M.js";import{M as r,d as n}from"./DataSyncService-BnTv72BN.js";import{p as x}from"./persistStore-CE5fTtZd.js";import{b as i}from"./Logger-CErMjlBd.js";const u=x((({loadedRef:e})=>n("user",{state:()=>({uuid:""}),getters:{loaded:()=>e.value}})),{mode:r.Cache,syncAutomatically:!0});var l="2.25.1";const d=(t,o)=>t?(localStorage.setItem("token",t),o&&localStorage.setItem("token_uuid",o),e()?c():Promise.resolve({message:"Conditions to save token in app storage not met."})):Promise.reject("No token provided"),c=()=>{if(!e())return Promise.reject("saveTokenToAppStorage only works on Safari");const a=localStorage.getItem("token");if(!a)return Promise.reject("No token in localStorage");const s={token:a,tokenUuid:localStorage.getItem("token_uuid"),clientUuid:localStorage.getItem("client_uuid"),userUuid:t(),email:localStorage.getItem("email")};return o().runtime.sendNativeMessage("com.momentumdash.momentum.safari",{eventName:"setUserTokenInfo",userTokenInfo:JSON.stringify(s)}).catch((e=>{throw console.error(e),new Error("Error setting token in shared app storage")}))},g=()=>o().runtime.sendNativeMessage("com.momentumdash.momentum.safari",{eventName:"getUserTokenInfo"}).then((e=>(null==e?void 0:e.userTokenInfo)?JSON.parse(e.userTokenInfo):null)),f=async({token:e,token_uuid:t,settings:o,user_uuid:a,features:s})=>{localStorage.removeItem("unregistered"),localStorage.removeItem("registrationStatePending"),e&&await d(e),t&&localStorage.setItem("token_uuid",t),a&&(localStorage.setItem("user_uuid",a),localStorage.setItem("userId",a),u().uuid=a),o&&m.syncCoordinator.loadSettings(o),s&&m.conditionalFeatures.updateFeatures(s)},S=e=>/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/.test(e),p=e=>e.length>=6,k=()=>a.introductionActive||a.oneTimeLoginActive||s(),I=Object.freeze(Object.defineProperty({__proto__:null,authFlowIsPending:k,getTokenFromAppStorage:g,handleAuthResponse:f,isValidEmail:S,isValidPassword:p,saveTokenToAppStorage:c,setMomentumAuthHeader:e=>{const t=localStorage.getItem("token"),o=localStorage.getItem("client_uuid");if(t&&e.setRequestHeader("Authorization","Bearer "+t),o&&e.setRequestHeader("X-Momentum-ClientId",o),e.setRequestHeader("X-Momentum-Version",l),e.setRequestHeader("X-Momentum-ClientDate",i()),m.conditionalFeatures.featureEnabled("allowoptions")){const t=localStorage.getItem("X-Momentum-Options");t&&e.setRequestHeader("X-Momentum-Options",t)}const a=localStorage.getItem("activeTags");a&&e.setRequestHeader("X-Momentum-Tags",a)},setToken:d},Symbol.toStringTag,{value:"Module"}));export{S as a,I as b,k as c,g,f as h,p as i,c as s,u};