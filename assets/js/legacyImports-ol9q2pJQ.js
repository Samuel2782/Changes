const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/addin-F82kL3BM.js","assets/js/handlebarLoader-xbtIzd6B.js","assets/css/addin-d63gIpXH.css","assets/js/addin-DvWoD2ka.js","assets/css/addin-D68qkMKk.css","assets/js/addin-jir9R8Hb.js","assets/js/addin-VYoGP72w.js","assets/js/modal-CXkRDJ21.js","assets/js/style-cpFB66wV.js","assets/css/style-CrTXrpPu.css","assets/js/enums-C0TfsRui.js","assets/js/settingsViewState-ZEr74HQm.js","assets/js/ViewState-DzCxxm0h.js","assets/js/DataSyncService-BnTv72BN.js","assets/js/index-DY0DW88M.js","assets/js/Logger-CErMjlBd.js","assets/js/appZStack-B9FmF8l5.js","assets/css/addin-CxFKzqYy.css","assets/js/addin-Cv3UHJrl.js","assets/js/addin-P-yyQEqD.js","assets/css/addin-V8Bd5j6H.css","assets/js/addin-PbfzzmHT.js","assets/css/addin-B7YvehCO.css","assets/js/addin-CDT2ay7D.js","assets/js/addin-DIVYf_6b.js","assets/js/tasksViewState-DGees08o.js","assets/css/addin-BUIiiR2p.css","assets/css/addin-q7nCwiop.css","assets/js/addin-BC-vfPdF.js","assets/js/addins-CR-biuia.js","assets/js/Popup-3lZ9av7x.js","assets/js/BaseIcon-Bb2ZVMd4.js","assets/js/dynamic-import-helper-DIl3ayLm.js","assets/js/_plugin-vue2_normalizer-DeUNqxFl.js","assets/css/BaseIcon-Bkqy2Cka.css","assets/js/BaseDropdownContent-Nf5O_5Ty.js","assets/js/constants-CALDQiUE.js","assets/js/index-CV0q_XsJ.js","assets/css/BaseDropdownContent-BVfvvT0B.css","assets/css/Popup-D9NqdHv-.css","assets/js/reactiveCustomization-B8WwDagp.js"])))=>i.map(i=>d[i]);
import{e,i as t,f as i}from"./DataSyncService-BnTv72BN.js";import{W as n,D as a,aQ as o,aR as s,aK as r,d as l,A as d,G as c,p as u}from"./index-DY0DW88M.js";import{_ as g}from"./style-cpFB66wV.js";import{_ as h}from"./dynamic-import-helper-DIl3ayLm.js";import{h as f}from"./index-BaInu6ja.js";import{s as p,a as v}from"./experiments-D9-xSE76.js";import{g as y}from"./partner-Xu2c1ljz.js";import{d as b,b as w}from"./helpers-Dah3fQ_V.js";import{C as k}from"./SettingsTypes-C_Wf2Ybw.js";import{T as S}from"./TimeframeService-Bnjub5ug.js";import{a as C}from"./constants-KuzCZNtH.js";import{C as I,m as T,a as M}from"./visibility-DfK0D4b2.js";import{d as A}from"./state-odjm2uKU.js";import{a as x}from"./settings-rA0qDzbq.js";import{u as F}from"./state-DDN7j9xD.js";import{o as O,s as E}from"./upgrade-DsD9ozzX.js";import{a as L}from"./modal-CXkRDJ21.js";import{U as P,s as D,l as B}from"./enums-C0TfsRui.js";import{l as V}from"./onboarding-Cm39YS_P.js";import{c as z}from"./auth-HiWjNVol.js";import{S as N}from"./settingsViewState-ZEr74HQm.js";import"./Logger-CErMjlBd.js";import"./TabLeaderElection-S4Ghxpfd.js";import"./balanceMode-DJvywwES.js";import"./reactiveCustomization-B8WwDagp.js";import"./LocalStorageStoreSyncedItem-kVGQtJA7.js";import"./constants-CHIvVb_r.js";import"./embeddedApp-R3YDNjex.js";import"./plusStatusBanner-hTEdr56E.js";import"./SubscriptionSummary-BQ9oLLHV.js";import"./persistStore-CE5fTtZd.js";import"./ViewState-DzCxxm0h.js";import"./appZStack-B9FmF8l5.js";var j,q,R,W,U="2.25.1",H="Chrome",G="production";window.m=_.extend(window.m,{$window:$(window),appView:"",models:{},collect:{},views:{},addins:{},settingsUtils:{},bootstrappers:{},commands:{},templates:{},widgets:[],appsReady:!1,appsLoaded:!1,console:{log:function(e){m.log+=e+"\n"}},log:"",date:function(){return new Date},now:function(){return m.date().getTime()},startTime:0,elapsed:function(){return m.now()-m.startTime},isLoggedIn:function(){return localStorage.getItem("token")&&!localStorage.getItem("unregistered")&&!n()},browserInfo:(q=navigator.userAgent,R=q.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],/trident/i.test(R[1])?{name:"IE",version:(j=/\brv[ :]+(\d+)/g.exec(q)||[])[1]||""}:"Chrome"===R[1]&&null!==(j=q.match(/\b(OPR|Edge)\/(\d+)/))?{name:j[1].replace("OPR","Opera"),version:j[2]}:(R=R[2]?[R[1],R[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(j=q.match(/version\/(\d+)/i))&&R.splice(1,1,j[1]),{name:R[0],version:R[1]})),logEnvironment:function(){var e=m.conditionalFeatures.featureEnabled("team"),t=m.models.teamInfo.get("team"),i=e&&t&&t.type===m.constants.organizationTypes.COMMUNITY,n=t&&t.userIsAdmin,a=m.conditionalFeatures.featureEnabled("plus"),o=m.models.backgroundManager.getActiveItem(),s=localStorage.getItem("email"),r=a&&m.models.customization.get("themeFont")||"classic",l=m.models.customization.get("themeColour")||"system",d=navigator.clipboard&&navigator.clipboard.writeText;"system"===l&&(l+=" ("+(m.models.themeManager.systemMediaQueryLight.matches?"Light":"Dark")+")");var c={platform:{version:U,mode:G,browser:H+" "+m.browserInfo.version},user:{accountType:i&&n?"Community":e&&!i?"Team":a?"Plus":s?"Free":"Unregistered",email:s,id:m.utils.getUserUuid(),clientId:localStorage.getItem("client_uuid")},team:{},community:{},theme:{color:m.utils.capitalizeWords(l),font:m.utils.capitalizeWords(r)},background:{title:o.get("title"),id:o.get("_id")||o.get("id"),source:o.get("source"),fallback:o.get("filename")&&o.get("filename").startsWith("backgrounds/"),custom:o.get("isCustom")}};if(e){var u=i?"community":"team";delete c[i?"team":"community"],c[u].name=t.teamName,c[u].id=t.teamUuid,c.user.admin=n}else delete c.team,delete c.community;var g="";Object.keys(c).forEach((function(e,t,i){g+=e.toUpperCase()+"\n",Object.keys(c[e]).forEach((function(t){var i=c[e][t];(i||0===i||!1===i)&&(g+=m.utils.camelCaseToReadable(t)+": "+i+"\n")})),t<i.length-1&&(g+="\n")})),d?navigator.clipboard.writeText(g).then((function(){g="*** Copied To Clipboard ***\n\n"+g})).catch((function(){})).finally((function(){console.log(g)})):console.log(g)}},Backbone.Events),m.firstLoadEver=!localStorage.getItem("client_uuid"),m.startTime=m.now(),Backbone.View=(W=Backbone.View).extend({constructor:function(e){this.options=e||{},W.apply(this,arguments)}});var J=Backbone.sync;Backbone.sync=function(e,t,i){(i=i||{}).beforeSend=function(e){m.helpers.auth.setMomentumAuthHeader(e),e.overrideMimeType("application/json")},t.get("isDummy")||J(e,t,i)};var K=Backbone.localSync;Backbone.localSync=function(e,t){var i=t.localStorage||t.collection.localStorage,n=localStorage.getItem(i.name);n&&(i.records=n.split(",")),t.get("isDummy")||K.apply(this,arguments)},Backbone.$=$,Backbone.ajax=$.ajax,Backbone.Model.extend=Backbone.Collection.extend=function(e,t){var i,n=this;i=e&&_.has(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},_.extend(i,n,t);var a=function(){this.constructor=i};return a.prototype=n.prototype,i.prototype=new a,e&&_.extend(i.prototype,e),Object.defineProperty(i,"__super__",{enumerable:!1,value:n.prototype}),i},localStorage.getItem("openAppleUpgradeOnLoad")&&(m.helpers.embeddedApp.openAppleUpgrade(),localStorage.removeItem("openAppleUpgradeOnLoad")),a()&&window.browser&&window.browser.runtime&&window.browser.runtime.sendNativeMessage&&browser.runtime.sendNativeMessage("com.momentumdash.momentum.safari",{eventName:"setExtensionLoadedOnce",extensionLoadedOnce:"true"}).catch((function(e){console.error("Error setting extensionLoadedOnce in shared app storage",e)}));const Q={1:function(e,t,i,n,a){var o,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<span class="metric-stat-unit">'+e.escapeExpression("function"==typeof(o=null!=(o=s(i,"metricUnit")||(null!=t?s(t,"metricUnit"):t))?o:e.hooks.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"metricUnit",hash:{},data:a,loc:{start:{line:4,column:107},end:{line:4,column:121}}}):o)+"</span>"},compiler:[8,">= 4.3.0"],main:function(e,t,i,n,a){var o,s,r=null!=t?t:e.nullContext||{},l=e.hooks.helperMissing,d="function",c=e.escapeExpression,m=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="view">\n\t<div class="primary">\n\t\t<div class="metric-stat">\n\t\t\t<span class="metric-stat-number">'+c(typeof(s=null!=(s=m(i,"metricValue")||(null!=t?m(t,"metricValue"):t))?s:l)===d?s.call(r,{name:"metricValue",hash:{},data:a,loc:{start:{line:4,column:36},end:{line:4,column:51}}}):s)+"</span>"+(null!=(o=m(i,"if").call(r,null!=t?m(t,"metricUnit"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:4,column:58},end:{line:4,column:135}}}))?o:"")+'\n\t\t</div>\n\t\t<div class="metric-label">\n\t\t\t<span class="metric-label-name">'+c(typeof(s=null!=(s=m(i,"metricLabel")||(null!=t?m(t,"metricLabel"):t))?s:l)===d?s.call(r,{name:"metricLabel",hash:{},data:a,loc:{start:{line:7,column:35},end:{line:7,column:50}}}):s)+'</span>\n\t\t</div>\n\t</div>\n\t<span class="metric-message"></span>\n</div>\n'},useData:!0},Y={compiler:[8,">= 4.3.0"],main:function(e,t,i,n,a){var o,s=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,l="function",d=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="app-wrapper app-placeholder nipple">\n\t<div class="app '+d(typeof(o=null!=(o=c(i,"appClass")||(null!=t?c(t,"appClass"):t))?o:r)===l?o.call(s,{name:"appClass",hash:{},data:a,loc:{start:{line:2,column:17},end:{line:2,column:29}}}):o)+'" style="height:'+d(typeof(o=null!=(o=c(i,"height")||(null!=t?c(t,"height"):t))?o:r)===l?o.call(s,{name:"height",hash:{},data:a,loc:{start:{line:2,column:45},end:{line:2,column:55}}}):o)+"; width:"+d(typeof(o=null!=(o=c(i,"width")||(null!=t?c(t,"width"):t))?o:r)===l?o.call(s,{name:"width",hash:{},data:a,loc:{start:{line:2,column:63},end:{line:2,column:72}}}):o)+'">\n\t\t<div class="app-placeholder-loading">\n\t\t\t<i class="loading-icon"></i>Loading...\n\t\t</div>\n\t</div>\n\t<div class="touch-overlay"></div>\n</div>\n<span class="app-dash toggle '+d((c(i,"lower")||t&&c(t,"lower")||r).call(s,null!=t?c(t,"label"):t,{name:"lower",hash:{},data:a,loc:{start:{line:9,column:29},end:{line:9,column:44}}}))+'-toggle" data-test="'+d((c(i,"kebab")||t&&c(t,"kebab")||r).call(s,null!=t?c(t,"label"):t,{name:"kebab",hash:{},data:a,loc:{start:{line:9,column:64},end:{line:9,column:79}}}))+'-app-dash" data-ob="'+d((c(i,"kebab")||t&&c(t,"kebab")||r).call(s,null!=t?c(t,"label"):t,{name:"kebab",hash:{},data:a,loc:{start:{line:9,column:99},end:{line:9,column:114}}}))+'-app-dash">'+d(typeof(o=null!=(o=c(i,"label")||(null!=t?c(t,"label"):t))?o:r)===l?o.call(s,{name:"label",hash:{},data:a,loc:{start:{line:9,column:125},end:{line:9,column:134}}}):o)+"</span>\n"},useData:!0},Z=Object.assign({"../app/widgetmanager/templates/metric.hbs":Q,"../app/widgetmanager/templates/pane.hbs":Y});m.templates=m.templates||{},m.templates.widgetmanager=m.templates.widgetmanager||{};for(const _ in Z){const e=Z[_];m.templates.widgetmanager[`${_.split("/").at(-1).replace(".hbs","")}`]=Handlebars.template(e)}m.models.Manager=Backbone.Model.extend({}),m.collect.Manager=Backbone.Collection.extend({}),m.models.Addin=Backbone.Model.extend({defaults:{evaluated:!1,processed:!1,processing:!1,lazy:!1}}),m.collect.AddinCollection=Backbone.Collection.extend({model:m.models.Addin}),m.models.AddinManagerBase=Backbone.Model.extend({initialize:function(){var e=this;this.preInitialize&&this.preInitialize(),this.addinCollection=new m.collect.AddinCollection,this.loadDependencyMap(),this.listenTo(this.addinCollection,"add change",this.processPending),setTimeout((function(){e.loadFromAddinObject(!0)}),50)},loadEvaluatedAddin:function(e,t){this.addinCollection.add({id:e,evaluated:!0,addInCode:t})},loadAddin:function(e){this.addinCollection.add({rawCode:e})},loadFromAddinObject:function(e){var t=this,i=!1;_.each(m.addins,(function(e,n){i=!0,t.addinCollection.findWhere({id:n})||t.loadEvaluatedAddin(n,e)})),i&&e&&this.processPending()},registerAddinLocalSource:function(e,t){this.addinCollection.findWhere({id:e})||this.addinCollection.add({id:e,path:t})},registerAddinFn:function(e,t){var i=this.addinCollection.findWhere({id:e});i?i.set({evaluated:!0,addInCode:t}):this.addinCollection.add({id:e,evaluated:!0,addInCode:t})},loadDependencyMap:function(){if(!this.localAddins&&!this.localLoadFailed){var e=[],t={},i={},n={};this.dependencies=n;for(var a=0;a<this.configInfo.length;a++){var o=this.configInfo[a],s=o.addin.toLowerCase();s||console.log("addin not found: "+s),e.push(s),t[s]=o.id,i[o.id]=s,o.dependencies&&o.dependencies.length>0&&(n[s]=o.dependencies)}this.localAddins={addins:e,map:t,mapNameToId:i}}},ensureAddinNameLoaded:function(e,t,i,n){if(this.localAddins){var a=e.toLowerCase(),o=this.localAddins.mapNameToId[a];o?this.ensureAddinLoaded(o,t,i,n):console.log("can't find id for addin name"+a)}else console.log("localAddins info not populated in ensureAddinNameLoaded")},ensureAddinLoaded:function(e,t,i,n){var a=this;e=e.toLowerCase();var o=this.addinCollection.get(e);if(o&&o.get("loaded"))t&&t(o);else if(!o||!o.get("loading")){var s=null;if(this.localAddins){var r=e.toLowerCase(),l=this.localAddins.map[r];l&&(s="app/"+l+".js")}if(i)try{i()}catch(v){console.log(v)}var d=null;if(!o&&this.dependencies[e]){var c=this.dependencies[e];d=[];for(var u=0;u<c.length;u++){var g=c[u];(f=this.localAddins.mapNameToId[g])&&d.push(f)}}if(o||(o=this.addinCollection.add({id:e,evaluated:!1,processed:!1,lazy:!1,dependencyIds:d})),o.get("loading"))t&&this.listenToOnce(this,"addin:loaded:"+e,(function(){o.set({loading:!1,loaded:!0}),t()}));else{var h=o.get("dependencyIds");if(h&&h.length>0)for(u=0;u<h.length;u++){var f=h[u],p=this.addinCollection.get(f);if(p&&!p.get("loaded")&&!p.get("loading"))return this.listenToOnce(this,"addin:loaded:"+f,(function(){a.ensureAddinLoaded(e,t,i,n)})),void a.ensureAddinLoaded(f,(function(){a.ensureAddinLoaded(e,t,i,n)}),i,n)}o.set({loading:!0}),m.console.log(m.elapsed()+": script added "+s),t&&this.listenToOnce(this,"addin:loaded:"+e,(function(){o.set({loading:!1,loaded:!0}),t()})),this.importAddin(e,s)}}},importAddin:function(e,t,i){var n=this.configInfo.find((function(t){return t.addin===e}));if(n&&n.esm)m.trigger("loadEsmAddin",n.id,e);else try{h(Object.assign({"../addins/company_link/addin.js":()=>g((()=>import("./addin-F82kL3BM.js")),__vite__mapDeps([0,1,2])),"../addins/focus_css_override/addin.js":()=>g((()=>import("./addin-DvWoD2ka.js")),__vite__mapDeps([3,1,4])),"../addins/settings/addin.js":()=>g((()=>import("./addin-jir9R8Hb.js")),__vite__mapDeps([5,1])),"../addins/settings_backgrounds/addin.js":()=>g((()=>import("./addin-VYoGP72w.js")),__vite__mapDeps([6,7,8,9,10,11,12,13,14,15,16,1,17])),"../addins/settings_clickup/addin.js":()=>g((()=>import("./addin-Cv3UHJrl.js")),__vite__mapDeps([18,11,12,13,14,15,8,9,16,1])),"../addins/settings_mantras/addin.js":()=>g((()=>import("./addin-P-yyQEqD.js")),__vite__mapDeps([19,7,8,9,10,1,20])),"../addins/settings_quotes/addin.js":()=>g((()=>import("./addin-PbfzzmHT.js")),__vite__mapDeps([21,7,8,9,10,1,22])),"../addins/settings_todo/addin.js":()=>g((()=>import("./addin-CDT2ay7D.js")),__vite__mapDeps([23,7,8,9,10,24,11,12,13,14,15,16,25,1,26,27])),"../addins/settings_trello/addin.js":()=>g((()=>import("./addin-BC-vfPdF.js")),__vite__mapDeps([28,11,12,13,14,15,8,9,16,1])),"../addins/todo/addin.js":()=>g((()=>import("./addin-DIVYf_6b.js")),__vite__mapDeps([24,7,8,9,10,11,12,13,14,15,16,25,1,26]))}),`../addins/${t.replace("app/","").split(".")[0]}/addin.js`,5)}catch(a){i(a)}},getWidgets:function(){return _.filter(this.configInfo,(function(e){return!!e.widget}))},getCommands:function(){var e=[];return _.map(this.configInfo,(function(t){if(t.commands&&t.commands.length>0)for(var i=0;i<t.commands.length;i++)e.push({id:t.commands[i],addin:t.addin})})),e},getAddinCommands:function(e){return e&&this.addinCollection.get(e).instance.commands||{}},refresh:function(){this.loadFromAddinObject(!0)},processPending:function(){var e=this;this.evaluatePending(),_.each(this.addinCollection.where({evaluated:!0,processed:!1,processing:!1,lazy:!1}),(function(t){try{if(t.get("processing")||t.get("processed"))return;var i=t.get("addInCode");if(i){var n={},a=t.get("dependencyIds");if(a&&a.length>0)for(var o=0;o<a.length;o++){var s=a[o],r=e.addinCollection.get(s);if(!r||!r.get("loaded"))return void e.ensureAddinLoaded(s);n[e.localAddins.map[s]]=r.instance}Handlebars.registerHelper(f),t.set({processing:!0}),t.instance=i(m,$,n),t.set({evaluated:!0,loading:!1,loaded:!0,processing:!0}),e.trigger("addin:loaded:"+t.id),e.trigger("addin:loaded",t.id)}}catch(l){console.error(l)}}))},evaluatePending:function(){}}),m.models.AddinManager=m.models.AddinManagerBase.extend({}),m.models.AddinManager=m.models.AddinManager.extend({configInfo:[{widget:!0,autoLoad:!0,id:"company_link",label:"Company Link",region:"top-center",requiredFeature:"company_link",addin:"dce1a4fc-4d92-41d5-8aaf-329e5f267b70"},{widget:!0,autoLoad:!0,id:"focus_css_override",addin:"a98d637b-0035-46f3-96ac-c1bd00c950b1",requiredFeature:"noPersonalFocus"},{widget:!0,esm:!0,placeholderType:"none",precludingFeature:"countdown",id:"addMetric",waitFor:!0,addin:"7edcf7ba-be8a-471d-ad0b-bcc6c9351430",autoLoad:!0},{widget:!0,esm:!0,id:"apps",requiredFeature:["app_launcher"],addin:"40203927-6651-4c0f-bc82-b25a8fe83505",browserBlacklist:"Mobile",autoLoad:!0,waitFor:!0},{widget:!0,placeholderType:"none",id:"background",addin:"b2583d87-8936-4392-8c10-56226239c391",autoLoad:!0,esm:!0},{widget:!0,esm:!0,placeholderType:"none",id:"base-metrics",waitFor:!0,requiredFeature:"countdown",addin:"7e81b0f8-174d-47e4-891a-db28a21efae6",autoLoad:!0},{widget:!0,id:"bookmarks",label:"Bookmarks",addin:"ace9b8b8-9ae4-4c58-b484-2b177d8830e2",autoLoad:!0,esm:!0,visibleSetting:"bookmarksVisible",browserBlacklist:["Safari","Mobile","PWA"]},{widget:!0,esm:!0,id:"calendar",addin:"296f1fc5-154d-4594-93c3-1a3b08e47be2",autoLoad:!0,waitFor:!0,browserBlacklist:["Mobile"],visibleSetting:"calendarVisible"},{widget:!0,esm:!0,placeholderType:"none",waitFor:!0,autoLoad:!0,id:"center-region",addin:"bdd415e2-b0b7-4cfa-a743-8ad041a99976"},{widget:!0,esm:!0,id:"chat",requiredFeature:["plus"],addin:"dc917ca9-052c-4f29-b9f2-6ed9f4643e3z",autoLoad:!0,waitFor:!0},{widget:!0,esm:!0,placeholderType:"none",id:"colorPicker",addin:"4fc397cd-2ac1-4748-b528-23cdf5b2ee42",autoLoad:!1},{widget:!0,esm:!0,id:"dash-upgrade",precludingFeature:["plus","team"],addin:"607d412c-587e-4810-a287-4961a35ff516",autoLoad:!0},{widget:!0,esm:!0,id:"default-new-tab",addin:"df4af375-d5d7-4908-be27-9c8d71201291",autoLoad:!0,waitFor:!0,browserBlacklist:["Firefox","PWA"]},{widget:!0,esm:!0,placeholderType:"none",id:"flashMessage",addin:"9c27b6da-6e5e-4814-a5d4-fda404ccec4f",autoLoad:!0,immediateLoad:!0},{widget:!0,esm:!0,id:"focus-mode",addin:"748a780b-5a3e-45aa-8d42-8ce7e6e6f167",autoLoad:!0,waitFor:!0,visibleSetting:"focusModeVisible",requiredFeature:"non-legacy",browserBlacklist:["Mobile"]},{widget:!0,esm:!0,id:"full-screen-portals",addin:"5b5bc6d5-be3c-4574-a535-c4dc05623f00",autoLoad:!0},{widget:!0,esm:!0,id:"links",addin:"be5add07-9d85-46e4-be64-fbd686ae51e0",requiredFeature:"non-legacy",autoLoad:!0,waitFor:!0,visibleSetting:"linksVisible"},{widget:!0,esm:!0,placeholderType:"none",id:"modal",addin:"5771dc5c-5496-4c0f-98cc-47938b40a1e0"},{widget:!0,esm:!0,id:"notes",requiredFeature:["notes","notes-degraded"],addin:"dc917ca9-052c-4f29-b9f2-6ed9f4643e0a",visibleSetting:"notesVisible",autoLoad:!0,waitFor:!0},{widget:!0,waitFor:!0,esm:!0,placeholderType:"none",id:"photo-info",addin:"cb39d5ca-eee1-4715-8fd1-62629ade4d59",autoLoad:!0},{widget:!0,esm:!0,id:"plus-status-banner",addin:"c08a28ac-4979-4b38-b2e8-cf02a0c6f528",requiredFeature:["plus","custom-bg-degraded"],autoLoad:!0,waitFor:!0,browserBlacklist:["Safari"]},{widget:!0,esm:!0,id:"quicklinks",precludingFeature:"non-legacy",addin:"ad54d482-248b-4abf-b5b0-a8eaf3e89132",visibleSetting:"linksVisible",autoLoad:!0,waitFor:!0},{widget:!0,esm:!0,placeholderType:"none",id:"region-bottom-center",addin:"3b4f3654-010f-42a3-a1dd-b96efc23a83c",waitFor:!0,autoLoad:!0},{widget:!0,esm:!0,placeholderType:"none",id:"region-center-below",addin:"e0c8a9f8-d0b1-4cb0-b754-48cb02e21cfe",waitFor:!0,autoLoad:!0},{widget:!0,esm:!0,waitFor:!0,autoLoad:!0,id:"search",addin:"162b82d0-f285-427c-8209-924f44ef4d21",visibleSetting:"searchVisible"},{widget:!0,esm:!0,id:"settings",addin:"da18c552-e13d-4a0e-838a-235a28a94869",autoLoad:!0,waitFor:!0},{widget:!0,esm:!0,id:"site-blocker",addin:"e32721d7-6956-43c7-9fe3-3d12469bae29",autoLoad:!0,browserBlacklist:["Mobile","PWA"],requiredFeature:["site-blocker","site-blocker-degraded"],visibleSetting:"siteBlockerVisible"},{widget:!0,esm:!0,id:"sounds",requiredFeature:"plus",addin:"fcae7f16-a0a4-4b5e-a995-926dfff3dcf2",autoLoad:!0,waitFor:!0,visibleSetting:"soundscapesVisible"},{widget:!0,esm:!0,id:"tabs",requiredFeature:["tab-stash","tab-stash-degraded"],addin:"b9735109-3d71-4681-9459-0a9ab5f7122d",autoLoad:!0,waitFor:!0,browserBlacklist:["Mobile","PWA"],visibleSetting:"tabsVisible"},{widget:!0,esm:!0,id:"tasks",addin:"59979b50-da82-453c-8382-69bb8399bb07",visibleSetting:"todoVisible",autoLoad:!0,waitFor:!0},{widget:!0,waitFor:!0,esm:!0,placeholderType:"none",id:"team-logo",addin:"069a6a33-60be-431d-b95b-6e58c9055fb0",autoLoad:!0,requiredFeature:"team_logo"},{widget:!0,esm:!0,id:"topics",requiredFeature:["topics"],addin:"d13fc525-0d8d-4516-910b-063dc88cebd3",browserBlacklist:"Mobile",autoLoad:!0,waitFor:!0},{widget:!0,esm:!0,id:"weather",addin:"d41ec20f-7148-4ef5-89ba-9be0d8141154",autoLoad:!0,waitFor:!0,visibleSetting:"weatherVisible"}]});var X="https://api.momentumdash.com/";m.models.Command=Backbone.Model.extend({defaults:{id:null},getId:function(){return this.id},execute:function(){},canExecute:function(){return!0},beforeExecute:function(){}}),m.CommandManager=m.collect.Manager.extend({model:m.models.Command,initialize:function(){var e=this;this.commandSources=new Backbone.Collection,m.commands&&_.mapObject(m.commands,(function(t){e.registerCommandModel(t,!1)}));for(var t=m.addinManager.getCommands(),i=0;i<t.length;i++)this.registerCommandSource(t[i]);this.listenTo(m.addinManager,"addin:loaded",(function(t){var i=m.addinManager.getAddinCommands(t);i&&_.mapObject(i,(function(t){e.registerCommandModel(t,!1)}))}))},registerCommandModel:function(e,t){var i=new e;if(i&&i.id){if(t||!this.get(i.id)){var n=this.get(i.id);n&&this.remove(n),this.add(i)}this.trigger("command:loaded:"+i.id)}},registerCommandSources:function(e){e&&e.length>0&&_.each(e,this.registerCommandSource,this)},registerCommandSource:function(e){if(!e.id)throw new Error("An id property is required in cmdSrc");if(!e.addin)throw new Error("An addin property is required in cmdSrc");this.commandSources.findWhere({id:e.id})||this.commandSources.add({id:e.id,addin:e.addin})},registerCommand:function(e,t,i,n){var a={defaults:{id:e},execute:t};i&&(a.canExecute=i);var o=m.models.Command.extend(a);this.registerCommandModel(o,n)},getCommand:function(e){return e?this.get(e):null},ensureCommandLoaded:async function(e,t,i,n){var a=this,o=this.get(e);if(o)t&&t(o);else{if(i)try{i()}catch(d){console.error(d)}if(e.startsWith("settings.")&&(await(await g((async()=>{const{loadSettingsAddins:e}=await import("./addins-CR-biuia.js");return{loadSettingsAddins:e}}),__vite__mapDeps([29,8,9]))).loadSettingsAddins(),o=this.get(e)))return t(o);var s=this.commandSources.get(e);if(s){var r=s.get("addin");s.get("loading")||(s.set("loading",!0),this.listenToOnce(this,"command:loaded:"+e,(function(){s.set("loading",!1),s.set("loaded",!0),t&&t()})),m.addinManager.ensureAddinLoaded(r,(function(){}),i,(function(e){s.set("loading",!1),n&&n(e)})))}else{var l=X+"commands/"+encodeURIComponent(e);$.ajax({url:l,success:function(r){r&&(a.registerCommandSource(r),(s=a.commandSources.get(e))?s.get("loading")||(s.set("loading",!0),m.addinManager.ensureAddinLoaded(s.get("addin"),(function(){s.set("loading",!1),s.set("loaded",!0),t&&t(o)}),i,(function(e){s.set("loading",!1),n&&n(e)}))):n&&n("no command with that id is registered"))},error:function(){n&&n("no command with that id is registered")}})}}},execute:function(e){var t=this.getCommand(e);if(t)return t.execute.apply(t,[].slice.call(arguments,1))},executeAsync:function(e){var t=this,i=[].slice.call(arguments,1);return new Promise((function(n,a){t.ensureCommandLoaded(e,(function(){var o=t.getCommand(e);o?n(o.execute.apply(o,i)):a()}))}))},getCommandAsync:function(e){var t=this;return new Promise((function(i,n){t.ensureCommandLoaded(e,(function(){var a=t.getCommand(e);a?i(a):n()}))}))},canExecute:function(e){var t=this.getCommand(e);return!t||t.canExecute.apply(t,[].slice.call(arguments,1))},beforeExecute:function(e){var t=this.getCommand(e);if(t)return t.beforeExecute.apply(t,[].slice.call(arguments,1))},getProperties:function(e){var t=this.getCommand(e);return!t||!t.getProperties||t.getProperties.apply(t,[].slice.call(arguments,1))}}),m.models.CleanupManager=m.models.Manager.extend({initialize:function(){var e=this;this.frequencyDays=10,this.load(),this._registerMigrationCleanup(),m.now()-this.cleanupInfo.lastCleanup>this.frequencyDays*m.utils.mConst("msPerDay")&&this.listenTo(m,"appsReady",(function(){setTimeout((function(){e.cleanup()}),1e3)}))},registerKey:function(e,t){t&&(this.cleanupInfo.cleanupOptions[e]=t),this.cleanupInfo.keys.indexOf(e)<0&&this.cleanupInfo.keys.push(e),this.save()},registerKeyPrefix:function(e,t){t&&(this.cleanupInfo.cleanupOptions[e]=t),this.cleanupInfo.keyPrefixes.indexOf(e)<0&&this.cleanupInfo.keyPrefixes.push(e),this.save()},unregisterKeyPrefix:function(e){e in this.cleanupInfo.cleanupOptions&&delete this.cleanupInfo.cleanupOptions[e];var t=this.cleanupInfo.keyPrefixes.indexOf(e);t>=0&&this.cleanupInfo.keyPrefixes.splice(t,1),this.save()},cleanup:function(){var t,i,n,a=[],o=Object.keys(localStorage);for(t=0;t<o.length;t++)if(n=o[t],this.cleanupInfo.keys.indexOf(n)>=0)a.push({key:n,options:this.cleanupInfo.cleanupOptions[n]});else for(i=0;i<this.cleanupInfo.keyPrefixes.length;i++){var s=this.cleanupInfo.keyPrefixes[i],r=this.cleanupInfo.cleanupOptions[s];if(n.startsWith(s)){if(r&&r.ignoreKeys&&r.ignoreKeys.indexOf(n)>=0)break;if(r&&null!=r.pastDaysToKeep){var l=this.parseLocalDate(n.substring(s.length)),d=m.date();l<new Date(d.getFullYear(),d.getMonth(),d.getDate()-r.pastDaysToKeep)&&a.push({key:n,options:r});break}a.push({key:n,options:r});break}}a.map((function(e){e.options&&e.options.callbackWidget?m.widgetManager.getWidgetAsync(e.options.callbackWidget).then((function(t){t[e.options.callbackMethod](e.key)})):localStorage.removeItem(e.key)})),this.cleanupInfo.lastCleanup=m.now(),this.save(),!m.isLoggedIn()&&localStorage.getItem("email")&&localStorage.removeItem("email"),navigator.storage.estimate().then((function(t){var i=navigator.appVersion.match(/.*Chrome\/([0-9\.]+)/);if(i&&i.length){var n=Number(i[1].split(".")[0]),a="brokenQuota:flashMessage:dismissed";if(t.usage>=Math.pow(2,64)&&n<117){if(localStorage.getItem(a)&&Number(localStorage.getItem(a))+6048e5>Date.now())return;e.$emit("flashMessage",{error:!0,contact:!1,button:{text:"How-to",action:function(){window.open("https://support.google.com/chrome/answer/95414")}},message:"Please update your browser. Momentum may not work as intended with your current version of Chrome.",onDismiss:function(){localStorage.setItem(a,Date.now())}}),m.Analytics.capture("show storage estimate error flash",t)}}})).catch(console.error)},save:function(){localStorage.setItem("cleanup-info",JSON.stringify(this.cleanupInfo))},load:function(){this.cleanupInfo=localStorage.getItem("cleanup-info"),this.cleanupInfo?this.cleanupInfo=JSON.parse(this.cleanupInfo):this.cleanupInfo={keyPrefixes:[],keys:[],cleanupOptions:{},lastCleanup:0}},parseLocalDate:function(e){var t=e.split(/\D/);return new Date(t[0],t[1]-1,t[2])},_registerMigrationCleanup(){var e=localStorage.getObject("syncedData:migration:successful")||[];[{lsName:"pomodorosCompleted",migrationName:"pomodorosCompleted"},{lsName:"quicklinks",migrationName:"links"}].forEach((t=>{this[e.includes(t.migrationName)?"registerKeyPrefix":"unregisterKeyPrefix"](t.lsName)}))}});const ee=()=>m.models.customization.get("lowPerformance");m.models.ThemeManager=Backbone.Model.extend({initialize:function(){},$head:$("head"),$body:$("body"),initializeThemes:function(){this.listenTo(m.models.customization,"change:themeColour",this.setThemeColor),this.listenTo(m.models.customization,"change:lowPerformance",this.setThemeColor),this.listenTo(m.models.customization,"change:themeFont",this.updateFont),this.listenTo(m,"user:successfulLogin user:successfulLogout",this.onLoginEvent),this.listenTo(m,"background:loadSuccessful",this.setThemeColor),this.listenTo(m,"legacybackgrounds:ready",this.setThemeColor),this.loadAllThemeValues()},loadAllThemeValues:function(){this.loadThemeColor(),this.setThemeColor(),this.updateFont()},setColorValues:function(e,t){this.colors=t,this.setThemeColor()},loadThemeColor:function(){try{if(m.models.customization.has("themeColourCustom")){var e=m.models.customization.get("themeColourCustom");e&&(this.colors=new Colors({color:e}).colors)}}catch(t){console.error(t)}},setThemeColor:function(){this.clearTheme();var e=m.models.customization.get("themeColour");switch(e){case"dark":this.setDarkTheme();break;case"light":this.setLightTheme();break;case"system":this.setSystemTheme();break;case"photo":this.setPhotoTheme();break;case"custom":this.setCustomTheme()}this.setAccentColor(e)},setDarkTheme:function(){this.$body.addClass("dark dark-full")},setLightTheme:function(){this.$body.addClass("light light-full")},setSystemTheme:function(){this.systemMediaQueryLight=window.matchMedia("(prefers-color-scheme: light)"),this.systemMediaQueryLight.addEventListener("change",this.systemMediaQueryListener.bind(this)),this.systemMediaQueryLight.matches?this.setLightTheme():this.setDarkTheme()},systemMediaQueryListener:function(e){"system"===m.models.customization.get("themeColour")&&(this.clearTheme(),e.matches?this.setLightTheme():this.setDarkTheme())},setPhotoTheme:function(){this.isPlus()&&m.models.activeBackground?this.$body.addClass("photo-match"):this.setDefaultTheme()},setCustomTheme:function(){this.isPlus()&&this.colors?this.$body.addClass("custom"):this.setDefaultTheme()},setDefaultTheme:function(){this.clearTheme(),this.setSystemTheme()},setAccentColor:function(e){var t=null;if("custom"!==e&&m.models.activeBackground){var i=m.models.activeBackground.getWidgetColor();i?t=new Colors({color:i.hsla}).colors:"photo"===e&&this.setDefaultTheme()}if("custom"===e&&this.colors&&(t=this.colors),t){var n=t.RND.hsl;n.a=t.alpha;var a=t.RGBLuminance,o=a>.5,s="custom"===e||"photo"===e?this.getHighlightColor(t,o):"",r="custom"===e||"photo"===e?"var(--color-text)":this.getSafeContrastColor(n,o,a);"custom"!==e&&"photo"!==e||(this.$body.toggleClass("light",o),this.$body.toggleClass("dark",!o));var l=":root { --color-hue: "+n.h+"; --color-sat: "+n.s+"%; --color-lit: "+n.l+"%; --color-alpha: "+Math.min(n.a,ee()?.95:.85)+"; "+(s&&"--color-accent-highlight: "+s)+";--color-accent-safe: "+r+";}";this.setThemeCss(l),this.setSafariOrPwaTabTheme(n)}},getHighlightColor:function(e,t){var i,n,a,o=t?0:1,s=.2;i=.8*e.rgb.r+s*o,n=.8*e.rgb.g+s*o,a=.8*e.rgb.b+s*o;var r=new Colors({color:"rgb("+Math.round(255*i)+","+Math.round(255*n)+","+Math.round(255*a)+")"}).colors.RND.hsl;return"hsla("+r.h+" "+r.s+"% "+r.l+"% / "+(ee()?"100%":"85%")+")"},getSafeContrastColor:function(e,t,i){var n=this.toHsla(e);return t?i<.5?n:"var(--color-light-text)":i>.1?n:"var(--color-dark-text)"},toHsla:function(e){return e.a||(e.a=1),"hsla("+e.h+" "+e.s+"% "+e.l+"% / "+e.a+")"},toRgba:function(e){return"rgba("+Math.round(255*e.rgb.r)+", "+Math.round(255*e.rgb.g)+", "+Math.round(255*e.rgb.b)+", "+e.alpha+")"},setThemeCss:function(e){this.$head.append('<style type="text/css" id="themeCss">'+e+"</style>"),m.trigger("theme:set")},setSafariOrPwaTabTheme:function(e){this.$head.append('<meta id="safariOrPwaTabTheme" name="theme-color" content="'+this.toHsla(e)+'">')},clearTheme:function(){this.$body.removeClass("dark dark-full light light-full custom photo-match no-hue"),this.$head.find("#themeCss").remove(),this.$head.find("#safariOrPwaTabTheme").remove(),this.systemMediaQueryLight&&this.systemMediaQueryLight.removeEventListener("change",this.systemMediaQueryListener.bind(this))},isPlus:function(){return m.conditionalFeatures.featureEnabled("plus")},fonts:{default:{label:"Classic",value:"default",path:"/font/Pretendard-Variable.woff2",stack:'-apple-system, BlinkMacSystemFont, Pretendard, "Helvetica Neue", Helvetica, Arial, sans-serif',family:"Pretendard"},startup:{label:"Neutral",value:"startup",path:"/font/Geist-Variable.woff2",family:"Geist",stack:"Geist, sans-serif"},modern:{label:"Modern",value:"modern",path:"/font/Outfit-Variable.woff2",family:"Outfit",stack:"Outfit, sans-serif"},warehouse:{label:"Future",value:"warehouse",path:"/font/SpaceGrotesk-Variable.woff2",family:"Space Grotesk",stack:"Space Grotesk, sans-serif",breakafter:!0},retro:{label:"Code",value:"retro",path:"/font/GeistMono-Variable.woff2",family:"Geist Mono",stack:"Geist Mono, monospace"},quirky:{label:"Quirky",value:"quirky",path:"/font/BricolageGrotesque-Variable.woff2",family:"Bricolage Grotesque",stack:"Bricolage Grotesque, sans-serif"},writer:{label:"Writer",value:"writer",path:"/font/Bitter-Variable.woff2",family:"Bitter",stack:"Bitter, serif"},cute:{label:"Cute",value:"cute",path:"/font/Fredoka-Variable.woff2",family:"Fredoka",stack:"Fredoka, sans-serif"}},updateFont:function(){let e=m.models.customization.get("themeFont")||"default";this.isPlus()||(e="default"),this.fonts[e]||(console.warn("Invalid font configuration:",e),e="default");const t=this.fonts[e];return this._loadFont(t),this},_loadFont:function(e){e&&e.path&&e.family||(console.warn("Invalid font configuration, using default font"),e=this.fonts.default);(o()||s())&&"default"===e.value||(this._createFontPreload(e.path),this._createFontStyle(e.family,e.path)),this._applyFontToUI(e.stack,e.value)},_createFontPreload:function(e){var t;null==(t=document.head.querySelector("#font-preload"))||t.remove();const i=document.createElement("link");i.id="font-preload",i.rel="preload",i.as="font",i.type="font/woff2",i.href=e,i.crossOrigin="anonymous",document.head.appendChild(i)},_createFontStyle:function(e,t){var i;null==(i=document.head.querySelector("#font-face-style"))||i.remove();const n=document.createElement("style");n.id="font-face-style",n.textContent=`\n\t\t\t@font-face {\n\t\t\t\tfont-family: '${e}';\n\t\t\t\tsrc: url('${t}') format('woff2-variations');\n\t\t\t\tfont-weight: 100 900;\n\t\t\t\tfont-display: swap;\n\t\t\t}\n\t\t`,document.head.appendChild(n)},_applyFontToUI:function(e,t){var i;Object.keys(this.fonts).forEach((e=>{this.$body.removeClass("f--"+e)})),this.$body.addClass("f--"+t),null==(i=document.head.querySelector("#font-override"))||i.remove();const n=document.createElement("style");n.id="font-override",n.textContent=`:root { --font-family: ${e} !important; }`,document.head.appendChild(n)},onLoginEvent:function(){this.listenToOnce(m,"sync:settings:complete",this.loadAllThemeValues)}});var te="https://api.momentumdash.com/";m.models.SyncCoordinator=Backbone.Model.extend({initialize:function(){p(),this.downloading={},this.retryAfterKey="feed-retry-after",this.syncSettingsInProgress=!1,this.listenTo(m,"sync:download",this.doDownload),this.listenTo(m,"skip:download",this.doDownloadAfterSkip),this.listenTo(m,"user:successfulLogin",this.onUserLogin),this.listenTo(m,"user:successfulLogout",this.syncSettings),this.listenTo(m,"sync:downloadIfNeeded",this.doDownloadIfNeeded),this.listenTo(m.models.customization,"change",this.customizationChange),this.listenTo(m,"sync:customization",this.customizationChange),m.models.customization.get("etag")||this.customizationChange(),this.reportFeedItems()},onUserLogin:function(e){localStorage.removeItem("ts_quotes"),localStorage.removeItem("ts_backgrounds"),localStorage.removeItem("ts_mantras"),this.doDownload(),this.syncSettings(e)},reportFeedItems:function(){var e=this;this.canCallServer()&&["quote","mantra","bg"].map((function(t){var i="report-"+t,n=localStorage.getItem(i);n&&$.ajax({type:"post",contentType:"application/json",url:te+"feed/report",data:n}).done((function(t){e.checkForBackOff(t.retryAfter),t.success&&localStorage.removeItem(i)}))}))},checkForReportTasks:function(e,t){e.map((function(e){if(e.reportUsage){var i="report-"+t,n=localStorage.getItem(i);(n=n?JSON.parse(n):[]).push({id:e._id,type:t,forDate:e.forDate}),localStorage.setItem(i,JSON.stringify(n))}}))},canCallServer:function(){var e=localStorage.getItem(this.retryAfterKey);if(e){if(m.date().getTime()<parseInt(e))return!1;localStorage.removeItem(e)}return!0},checkForBackOff:function(e){e&&(e=parseInt(e),localStorage.setItem(this.retryAfterKey,m.date().getTime()+1e3*e))},doDownloadAfterSkip:function(e){this.doDownload(e,!0)},doDownload:function(e,t){if(this.canCallServer()){var i=this;if(e){if("string"==typeof e){var n={};e.split(/[\s,;]+/).forEach((function(e){n[e]=!0})),e=n}if(["quote","background","mantra"].map((function(t){i.downloading[t]&&e[t]&&delete e[t]})),0===Object.keys(e).length)return}var a=m.collect.mantras.get("pinned");this.downloading={};try{var o=this,s="";if(m.collect.backgrounds&&m.collect.backgrounds.get(m.utils.getDateString())&&(s+="b"),m.collect.quotes&&m.collect.quotes.get(m.utils.getDateString())&&(s+="q"),(m.collect.mantras&&m.collect.mantras.get(m.utils.getDateString())||a)&&(s+="m"),!localStorage.client_uuid)return;var r=te+"feed/bulk?syncTypes=";if(e){var l=[];if(e.quote&&m.models.customization.get("quoteVisible")&&(l[l.length]="quote",localStorage.removeItem(o.ddlQuoteString()),this.downloading.quote=!0),e.mantra&&m.models.customization.get("mantraVisible")&&!a&&(l[l.length]="mantra",localStorage.removeItem(o.ddlMantraString()),this.downloading.mantra=!0),e.background&&(this.downloading.background=!0,l[l.length]="background",localStorage.removeItem(o.ddlBackgroundString())),!(l.length>0))return;r+=l.join(",")}else this.downloading.background=!0,this.downloading.quote=!0,a||(this.downloading.mantra=!0),r+="all",localStorage.removeItem(o.ddlBackgroundString()),localStorage.removeItem(o.ddlQuoteString()),localStorage.removeItem(o.ddlMantraString());r=r+"&localDate="+m.utils.getDateString(),s.length>0&&(r+="&has="+s);var d=m.models.activeBackground.activeBackgroundUuid();if(!d){var c=m.collect.legacyBackgrounds.getCurrentLocalBackground();c&&(d=c.backgroundUuid())}d&&!t&&(r=r+"&legacyBackground="+d),$.ajax({type:"GET",contentType:"application/json",url:r}).done((function(e){["Quote","Background","Mantra"].map((function(t){e["useCurrent"+t]&&localStorage.setItem(o["ddl"+t+"String"](),m.now())})),e.quotes&&(e.quotes.length>0&&m.collect.quotes&&(m.collect.quotes.reset(e.quotes),i.checkForReportTasks(e.quotes,"quote"),m.collect.quotes.invoke("save"),localStorage.shortquote&&localStorage.removeItem("shortquote")),e.ts_quotes&&localStorage.setItem("ts_quotes",JSON.stringify(e.ts_quotes)),localStorage.setItem(o.ddlQuoteString(),m.now())),e.mantras&&e.mantras.length>0&&m.collect.mantras&&(m.collect.mantras.reset(e.mantras),i.checkForReportTasks(e.mantras,"mantra"),m.collect.mantras.invoke("save"),localStorage.setItem(o.ddlMantraString(),Date.now()),e.ts_mantras&&localStorage.setItem("ts_mantras",JSON.stringify(e.ts_mantras))),e.backgrounds&&(e.backgrounds.length>0&&(m.collect.backgrounds.reset(e.backgrounds),i.checkForReportTasks(e.backgrounds,"bg"),m.collect.backgrounds.invoke("save"),localStorage.background&&(localStorage.removeItem("background"),localStorage.removeItem("backgrounds"))),e.ts_backgrounds&&localStorage.setItem("ts_backgrounds",JSON.stringify(e.ts_backgrounds)),localStorage.setItem(o.ddlBackgroundString(),m.now())),i.downloading={},i.checkForBackOff(e.retryAfter),localStorage.setItem("firstSynchronized",m.now())})).fail((function(e){if(i.downloading={},e.status>0){503===e.status&&i.checkForBackOff(e.getResponseHeader("retry-after"));var t=m.models.backgroundManager&&m.models.backgroundManager.latestItemDate();t&&t>Date.parse(m.utils.getDateString())&&localStorage.setItem(o.ddlBackgroundString(),m.now());var n=m.models.quoteManager&&m.models.quoteManager.latestItemDate();n&&n>Date.parse(m.utils.getDateString())&&localStorage.setItem(o.ddlQuoteString(),m.now());var a=m.models.mantraManager&&m.models.mantraManager.latestItemDate();a&&a>Date.parse(m.utils.getDateString())&&localStorage.setItem(o.ddlMantraString(),Date.now())}else m.trigger("sync:error")}))}catch(u){console.error(u),i.downloading={}}}},doDownloadIfNeeded:function(e){if(localStorage.client_uuid&&!localStorage.getItem("registrationStatePending")){var t=!1,i=!1,n=!1;if(e){if(e.ts_backgrounds){var a=localStorage.getItem("ts_backgrounds");a?e.ts_backgrounds>JSON.parse(a)&&(t=!0):t=!0}if(e.ts_quotes){var o=localStorage.getItem("ts_quotes");o?e.ts_quotes>JSON.parse(o)&&(i=!0):i=!0}if(e.ts_mantras){var s=localStorage.getItem("ts_mantras");s?e.ts_mantras>JSON.parse(s)&&(n=!0):n=!0}}t||localStorage[this.ddlBackgroundString()]||(t=!0),i||localStorage[this.ddlQuoteString()]||(i=!0),n||localStorage[this.ddlMantraString()]||(n=!0),this.downloading.quote&&(i=!1),this.downloading.background&&(t=!1),this.downloading.mantra&&(n=!1),m.models.customization.get("quoteVisible")||(i=!1),m.models.customization.get("mantraVisible")||(n=!1);var r={};t&&(r.background=!0),i&&(r.quote=!0),n&&(r.mantra=!0),Object.keys(r).length>0&&this.doDownload(r)}},pingApi:function(e,t){$.ajax({type:"GET",contentType:"application/json",url:te}).done((function(){e&&e()})).fail((function(){t&&t()}))},ddlBackgroundString:function(){return"ddl-bg-"+m.utils.getDateString()},ddlQuoteString:function(){return"ddl-qt-"+m.utils.getDateString()},ddlMantraString:function(){return"ddl-mantra-"+m.utils.getDateString()},setSyncSettingsHeaders:function(e){m.helper.auth.setMomentumAuthHeader(e);var t=m.models.customization.get("etag");void 0===m.models.customization.get("displayname")&&(t=m.utils.uuidv4()),t&&e.setRequestHeader("X-Momentum-Settings-ETag",t)},customizationChange:function(e,t){if(!(t&&t.fromStorage||this.syncSettingsInProgress||m.models.customization.fetching)&&localStorage.getItem("token")&&m.conditionalFeatures.featureEnabled("serversettings")){if(e){var i=e.changedAttributes();if(1===Object.keys(i).length&&_.contains(Object.keys(i),"etag"))return}else if(m.models.customization.get("etag"))return;$.ajax({type:"POST",contentType:"application/json",data:JSON.stringify(m.models.customization.getPersistentSettings()),url:te+"settings"}).done((function(e){e.etag&&m.models.customization.save({etag:e.etag})})).fail((function(){})).always((function(){}))}},submitFeatureAccessRequest:function(e,t,i){var n={feature:e};$.ajax({type:"POST",contentType:"application/json",data:JSON.stringify(n),url:te+"user/featurerequest"}).done((function(){t&&t()})).fail((function(){i&&i()}))},syncSettings:function(e,t){if((localStorage.getItem("client_uuid")||localStorage.getItem("token"))&&!localStorage.getItem("registrationStatePending")&&!m.migratingLegacyUser){this.syncSettingsInProgress=!0;var i=this,n=!1;$.ajax({type:"GET",contentType:"application/json",beforeSend:this.setSyncSettingsHeaders,url:te+"settings",allowDeferral:t}).done((function(e){i.loadSettings(e)&&(n=!0),localStorage.setItem(r,Date.now().toString())})).fail((function(){})).always((function(){n||(i.syncSettingsInProgress=!1,l.syncSettingsComplete=!0,m.trigger("sync:settings:complete"),e&&e())}))}},loadSettings:function(e){if(e){if(e.user_id&&(localStorage.setItem("userId",e.user_id.toLowerCase()),m.user.uuid=e.user_id),e.token_invalid)return e.token_invalid_reason?m.commandManager.execute("logout",e,!0):m.commandManager.execute("logout",null,!0),!0;e.createTime&&localStorage.setItem("user:createTime",e.createTime),e.greetings&&(localStorage.greetings=e.greetings),e.customization&&m.models.customization.save(e.customization),e.features&&m.conditionalFeatures.updateFeatures(e.features,!0),e.team&&m.models.teamInfo.save("team",e.team),e.experimentEnrollments&&v(e.experimentEnrollments),m.commandManager.execute("addins.load",e.addIns),m.commandManager.registerCommandSources(e.cmd),e.download&&m.trigger("sync:download",e.download),e.ts_notifications&&m.trigger("notifications:timestamp",e.ts_notifications);var i=null;if(e.ts_backgrounds&&((i=i||{}).ts_backgrounds=e.ts_backgrounds),e.ts_quotes&&((i=i||{}).ts_quotes=e.ts_quotes),e.mantras&&((i=i||{}).ts_mantras=e.ts_mantras),i&&m.trigger("sync:downloadIfNeeded",i),m.trigger("sync:settings",e),e.timestamps&&t.saveServerTimestamps(e.timestamps).catch(console.error),e.outdatedToken){var n="settings:outdatedToken:lastAttempt",a=localStorage.getItem(n),o="settings:outdatedToken:429Until",s=localStorage.getItem(o);if(a>=Date.now()-2e4)return;if(s>=Date.now()-2e3)return;localStorage.setItem(n,Date.now()),$.ajax({type:"get",url:te+"settings/token"}).done((function(e){e.token&&localStorage.setItem("token",e.token),e.token_uuid&&localStorage.setItem("token_uuid",e.token_uuid)})).fail((function(e){429===e.status&&localStorage.setItem(o,Date.now()+1e3*Number(e.response.headers["retry-after"]))}))}}}});var ie="https://api.momentumdash.com/";m.collect.Feed=Backbone.Collection.extend({initialize:function(e,t){this.model=e,this.itemType=t,this.localStorage=new Backbone.LocalStorage("momentum-"+t)},getActiveItem:function(){if(this.length>0){var e=m.utils.getDateString();return this.get(e)}},empty:function(){return 0===this.models.length}}),m.models.FeedManager=Backbone.Model.extend({initialize:function(e,t){this.itemType=t,m.collect[t+"s"]=this.itemCollection=new m.collect.Feed(e,t)},firstFetch:function(){this.itemCollection.fetch({reset:!0})},getActiveItem:function(){var e=this;if(!this.itemCollection)return null;var t=this.itemCollection.getActiveItem();return t?(this.currentItem&&this.equals(this.currentItem,t)||(this.currentItem=t,setTimeout((function(){m.trigger(e.itemType+":active_changed",e.currentItem.get("_id"))}),50)),t):null},equals:function(e,t){var i={},n={};return Object.assign(i,e.attributes),Object.assign(n,t.attributes),delete i.forDate,delete n.forDate,JSON.stringify(i)===JSON.stringify(n)},skipItem:function(e){e=!!e;var t=this,i=this.getActiveItem(),n=i.get("_id")||i.get("id"),a=ie+this.itemType+"s/"+n+"/skip",o={is_custom:i.get("is_custom"),hard:e};return new Promise((function(i,n){try{if(!(m.isLoggedIn()&&m.conditionalFeatures.featureEnabled("plus")||e))throw"showSkipUpsell";$.ajax({type:"PATCH",contentType:"application/json",data:JSON.stringify(o),url:a}).done((function(e){if(e&&e.success&&m.trigger("skip:download",t.itemType),e&&e.notification){if("max_skips"===e.notification.type||0===e.notification.message.indexOf("Skip ")){var n="max"+m.utils.capitalizeFirstLetter(t.itemType)+"Skips";if(localStorage.getItem(n))return;localStorage.setItem(n,!0),e.notification.display_time||(e.notification.display_time=5e3),e.notification.viewLimit||(e.notification.viewLimit=1)}m.commandManager.execute("notification.show.enhanced",e.notification)}i(e)})).fail((function(){m.commandManager.execute("notification.show.enhanced",t.skipErrorMessage()),n()}))}catch(r){if("showSkipUpsell"==r){if("mantra"==t.itemType){var s={cta_text:"Learn more",cta_cmd:"upsell.upgrade",title:"Skip Mantra",message:"Upgrade to skip through mantras and add your own mantras."};m.commandManager.execute("notification.show.enhanced",s)}}else m.commandManager.execute("notification.show.enhanced",t.skipErrorMessage());n()}}))},toggleFavorite:function(e,t){var i=this,n=t||this.getActiveItem(),a=n.get("_id")||n.get("id"),o=ie+this.itemType+"s/"+a+"/favorite",s={is_favorite:e,is_custom:n.get("is_custom")};return new Promise((function(e,t){try{$.ajax({type:"PATCH",contentType:"application/json",data:JSON.stringify(s),url:o}).done((function(t){t&&t.success&&m.trigger(i.itemType+":favorite",{id:a,is_favorite:s.is_favorite}),e(t)})).fail((function(e){m.commandManager.execute("notification.show.enhanced",i.favouriteErrorMessage),t(e)}))}catch(n){m.commandManager.execute("notification.show.enhanced",i.favouriteErrorMessage),t(n)}}))},latestItemDate:function(){var e=null;return this.itemCollection.models.forEach((function(t){var i=Date.parse(t.id);(!e||i>e)&&(e=i)})),e},skipErrorMessage:function(){return{message:"Oops! We weren't able to get a new "+this.itemType+". Please check your connection and try again.",viewLimit:1}},favouriteErrorMessage:{message:"Oops! We weren't able to save the favorite. Please check your connection and try again.",viewLimit:1},registerErrorMessage:{message:"Please log in or register to enable skipping.",display_time:2500}});var ne="https://api.momentumdash.com/";m.models.ConditionalFeatures=Backbone.Model.extend({defaults:{featureList:[]},initialize:function(e){this.customization=e.customization||m.models.customization;try{localStorage.f3t6b23d&&(this.setFeatures(JSON.parse(atob(localStorage.f3t6b23d))),this.checkUnregisteredFlag())}catch(t){console.error(t),this.setFeatures([])}},featureEnabled:function(e){if("offlineDataOnly"===e&&!m.isLoggedIn())return!0;var t=!0;return"!"===e[0]&&(e=e.substr(1),t=!1),t===_.contains(this.get("featureList"),e)},setFeatures:function(e){m.utils.userIsLegacyUnregistered()||e.push("non-legacy"),y().alwaysShowLogo&&e.push("team_logo"),this.set("featureList",e)},updateFeatures:function(e){localStorage.f3t6b23d=e,this.setFeatures(JSON.parse(atob(e))),this.checkUnregisteredFlag(),window.Cypress&&$("body").attr("data-test-ready-for-tests",""),m.trigger("feature:changed")},checkUnregisteredFlag:function(){var e=this.get("featureList");e.length&&!_.contains(e,"nosync")&&localStorage.removeItem("unregistered")},clearFeatures:function(){this.set({featureList:[]}),localStorage.removeItem("f3t6b23d")},checkFeatureAndMigrateData:function(e,t,i,n,a,o){var s=null,r=this;if(this.featureEnabled(e)){for(var l=!1,d=0;d<localStorage.length;d++){var c=localStorage.key(d);if(0===c.indexOf(i+"-")){l=!0;break}}if(l)try{var u=m.date(),g=u.getFullYear().toString()+"-"+m.utils.twoDigit(u.getMonth()+1)+"-"+m.utils.twoDigit(u.getDate())+"-"+m.utils.twoDigit(u.getHours())+":"+m.utils.twoDigit(u.getMinutes())+":"+m.utils.twoDigit(u.getSeconds()),h="migrated-"+i+"-"+g,f=[],p=[];for(d=0;d<localStorage.length;d++)if(0===(c=localStorage.key(d)).indexOf(i+"-")){p.push(c);var v=localStorage.getItem(c);if(v){var y=JSON.parse(v);y.id||(y.id=y.csid),f.push(y)}}var b={items:f},w=JSON.stringify(b);$.ajax({type:"POST",contentType:"application/json",data:w,url:ne+"migrate/"+i}).done((function(){for(var e in localStorage.setItem(h,w),p)localStorage.removeItem(p[e]);localStorage.removeItem(i),m.trigger("sync:customization"),t&&!r.customization.getComputedSetting(t)||n()})).fail((function(){t&&!r.customization.getComputedSetting(t)||a()}))}catch(k){console.error(k)}else s=n}else s=a;s&&(!t||this.customization.getComputedSetting(t)?s():o?o(s):this.setPreferenceChangeListener(t,s))},setPreferenceChangeListener:function(e,t){var i=this;m.listenToOnce(this.customization,"change:"+e,(function(){i.customization.getComputedSetting(e)?t():i.setPreferenceChangeListener(e,t)}))},checkPreferenceForRender:function(e,t,i){t&&(!e||this.customization.getComputedSetting(e)?t():i&&i(t))}}),m.models.Widget=Backbone.Model.extend({shouldShowPane:function(){var e=!0;if(this.has("keepOpenSetting")&&(e=m.models.customization.get(this.get("keepOpenSetting"))&&!m.utils.isTouchDevice()),this.has("openState")){var t=localStorage[this.get("openState")];if(t)return JSON.parse(t)&&e}return!1}}),m.collect.Widgets=Backbone.Collection.extend({model:m.models.Widget}),m.views.BasePlaceholder=Backbone.View.extend({initialize:function(){this.render()},render:function(){var e=this.model.get("region"),t=(this.model.get("order")||"append")+"To";return this.$el[t]("."+e).mFadeIn().html(this.template(this.model.toJSON())),this},attributes:function(){return{id:this.model.get("elementId")||this.model.get("id"),class:this.model.get("class")}},detach:function(){this.unbind(),this.stopListening(),this.undelegateEvents()}}),m.views.PanePlaceholder=m.views.BasePlaceholder.extend({template:m.templates.widgetmanager.pane,open:!1,events:{"click .toggle":"toggleShow","click .touch-overlay":"hidePane"},initialize:function(){var e=this;this.open=!1,this.region=this.model.get("region"),this.openStateKey=this.model.get("openState"),this.render(),this.model.get("toggleEvent")&&this.listenTo(m,this.model.get("toggleEvent"),this.toggleShow),this.model.get("hideEvents")&&_.each(this.model.get("hideEvents"),(function(t){e.listenTo(m,t,e.onHideEvent)}));var t=this.model.get("visibleSetting");t&&this.listenTo(m.models.customization,"change:"+t,this.visibleChanged),this.model.shouldShowPane()&&this.showPane()},attributes:function(){return{id:this.model.get("id"),class:"app-container "+this.model.get("id"),"data-test":this.model.get("data-test")}},render:function(){var e=this.model.get("label"),t=(this.model.get("order")||"append")+"To";if(!this.renderedOnce){var i=this.model.get("width")+"px",n="70px";if(this.model.has("height"))n=this.model.get("height")+"px";else{var a=this.storedPaneHeight();a&&(n=a+"px")}this.$el.html(this.template({label:e,appClass:this.model.get("appClass")||"",isTodo:"todo"===this.model.get("id"),height:n,width:i})),this.$app=this.$(".app"),this.$dash=this.$(".app-dash"),this.$el.addClass(this.model.get("class")||""),0===this.region.indexOf("top")&&(this.$dash.remove(),s&&s.length?s.after(this.$el):this.$el.prepend(this.$dash)),this.$(".app-wrapper").addClass("nipple-"+this.region);var o=this.model.get("after"),s=o&&$(o),r=this;setTimeout((function(){s&&s.length?s.after(r.$el):r.$el[t]("."+r.region),r.$el.mFadeIn(),r.renderedOnce=!0}))}return this},storedPaneHeight:function(){if(this.model.has("storedHeight")){var e=this.model.get("storedHeight"),t=localStorage[e];if(t)return JSON.parse(t)}return null},toggleShow:function(e){if(this.realView&&this.realView.toggleHandler)return this.open=this.realView.toggleHandler(e),!0;e&&e.stopPropagation&&e.stopPropagation(),e&&e.preventDefault&&e.preventDefault(),this.open?this.hidePane():(m.Analytics.capture("app show",{feature:this.model.get("feature")||this.model.get("id"),method:e instanceof MouseEvent?"click":"hotkey",is_paid_event:!!this.model.get("isPlus")}),this.showPane())},showPane:function(){if(!this.open){if(this.open=!0,localStorage.setItem(this.openStateKey,this.open),this.$el.addClass("show").width(),this.$el.addClass("show-fade-in"),this.realView)this.realView.onShowPane&&this.realView.onShowPane();else{if(this.loading)return;if(!this.model.has("addin"))return;this.loading=!0,m.addinManager.ensureAddinLoaded(this.model.get("addin"))}m.trigger("globalEvent:toggle:"+this.region,this),m.trigger("globalEvent:toggle",this),this.triggerLoaded()}},hidePane:function(){var e=this;this.open&&(this.open=!1,localStorage.setItem(this.openStateKey,this.open),this.$el.removeClass("show-fade-in"),setTimeout((function(){e.$el.hasClass("show-fade-in")||e.$el.removeClass("show")}),300),this.realView&&this.realView.onHidePane&&this.realView.onHidePane())},triggerLoaded:function(){this.loadTriggered||(m.widgetManager.appReady(this.model.get("id")),this.loadTriggered=!0)},addRealView:function(e){this.realView=e,this.open&&this.realView.onShowPane&&this.realView.onShowPane()},onHideEvent:function(e){e!=this&&this.hidePane()},visibleChanged:function(){var e=this.model.get("visibleSetting"),t=m.models.customization.getComputedSetting(e),i=this;t?this.renderedOnce?(this.$el.addClass("app-container"),setTimeout((function(){i.$el.mFadeIn()}),1)):this.render():(this.realView&&this.realView.tearDown&&this.realView.tearDown(),setTimeout((function(){i.$el.mFadeOut(null,null,(function(){i.$el.removeClass("app-container")}))}),1))}}),m.views.MetricPlaceholder=m.views.BasePlaceholder.extend({template:m.templates.widgetmanager.metric,initialize:function(){var e=this;this.render(),setTimeout((function(){m.addinManager.ensureAddinLoaded(e.model.get("addin"))}),25),this.model.get("toggleEvent")&&this.listenTo(m,this.model.get("toggleEvent"),this.toggleShow)},render:function(){if(!this.renderedOnce){this.renderedOnce=!0;var e={},t=this.model.get("cachedKey");t&&(e=JSON.parse(localStorage.getItem(t)));var i=this.model.get("after"),n=i&&$(i),a=this.model.get("region"),o=(this.model.get("order")||"append")+"To";n&&n.length?n.after(this.$el):a&&this.$el[o]("."+a),this.$el.html(this.template(e)),m.appsLoaded&&this.$el.mFadeIn()}return this},toggleShow:function(e){if(this.realView&&this.realView.toggleHandler)return this.open=this.realView.toggleHandler(e),!0},addRealView:function(e){this.realView=e}});var ae="Chrome";m.models.WidgetManager=m.models.Manager.extend({skippedWidgets:[],topCenterHasContent:!1,initialize:function(){this.regions={},this.regions.logo={widgets:[],overlappingRegion:"teamlinks"},this.regions["top-left"]={widgets:[{el:"links-app",view:"teamlinks"}],overlappingRegion:"bottom-left"},this.regions["top-right"]={widgets:[{el:"base-metric",view:"metric"},{el:"weather-app",view:"weather"}],overlappingRegion:"bottom-right"},this.regions["bottom-right"]={widgets:[{el:"todo-app",view:"todoPane"},{el:"notes-app",view:"notes"}],overlappingRegion:"top-right"},this.regions.bottom={widgets:[{el:"quote",view:"quote"}],overlappingRegion:"top-right"},this.regions["bottom-left"]={widgets:[{el:"settings",view:"settings"}],overlappingRegion:"top-left"},this.waitingFor=["background"],m.console.log(m.elapsed()+": initialized widgetManager")},setupWhenReady:function(){var e=this;m.models.customization.initialized?e.setup():this.listenToOnce(m.models.customization,"initialized",(function(){e.setup()}))},setup:function(){this.widgets&&this.widgets.each((function(e){e.placeholder&&e.placeholder.remove()})),this.widgets=m.collect.widgets=new m.collect.Widgets,this.listenTo(this.widgets,"add",this.onAdd),this.listenTo(m,"readyForWidgets",this.onSuccessfulLogin),this.listenTo(m,"feature:changed",this.onSuccessfulLogin),this.populateWidgets()},checkWidgetTimeout:function(){if(!m.reactive.appsReady){var t=m.elapsed(),i=this;t<1500?setTimeout((function(){i.checkWidgetTimeout()}),1500-t):(this.firstShow(!0),console.warn("Widget Timeout Exceeded: Ensure all waited on apps are calling widgetManager.appReady(). Waiting for: ",this.waitingFor),e.$emit("widgets:timeoutExceeded"))}},populateWidgets:function(){m.console.log(m.elapsed()+": populating widgets");var e=this;_.forEach(m.addinManager.getWidgets(),(function(t){e.widgets.add(t)}))},onAdd:function(e){this.addWidget(e)},onSuccessfulLogin:function(){var e=this,t=this.skippedWidgets;this.destroyWidgetsWithPrecludingFeatures(),this.skippedWidgets=[],_.each(t,(function(t){e.addWidget(t)}))},destroyWidgetsWithPrecludingFeatures:function(){var e=this;this.widgets.forEach((function(t){t.has("precludingFeature")&&!e.skippedWidgets.includes(t)&&e.someFeaturesEnabled(t.get("precludingFeature"))&&m.trigger("destroyWidget:"+t.get("id"))}))},someFeaturesEnabled:function(e){var t=!1;Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++)if(m.conditionalFeatures.featureEnabled(e[i])){t=!0;break}return t},addWidget:function(e,t){var i=this;t=t||!1;var n=e.get("browserBlacklist");if(!n||!(n.includes(ae)||n.includes("Mobile")&&m.utils.isTouchDevice()))if(l.readyForWidgets||e.get("immediateLoad")){var a=!0;if(e.has("requiredFeature")&&(a=this.someFeaturesEnabled(e.get("requiredFeature"))),a&&e.has("precludingFeature")&&(a=!this.someFeaturesEnabled(e.get("precludingFeature"))),a){var o=m.models.teamInfo.get("team");if(!e.has("emptyFlag")||!o||o.userIsAdmin||!o[e.get("emptyFlag")]){if(!t&&e.has("visibleSetting")){var s=e.get("visibleSetting");if(!m.models.customization.getComputedSetting(s)){let t=function(){var n=!!m.models.customization.getComputedSetting(s);i.addWidget(e,n),m.models.customization.off("change:"+s,t),m.models.customization.off("visibilityOverride:"+s,t)};return m.models.customization.once("change:"+s,t),void m.models.customization.once("visibilityOverride:"+s,t)}}if("metric"===e.get("placeholderType")?(e.placeholder=new m.views.MetricPlaceholder({model:e}),this.waitFor(e)):"pane"===e.get("placeholderType")?(e.shouldShowPane()&&this.waitFor(e),e.placeholder=new m.views.PanePlaceholder({model:e})):(e.get("autoLoad")||e.shouldShowPane())&&(e.get("waitFor")&&this.waitFor(e),m.addinManager.ensureAddinLoaded(e.get("addin"))),e.placeholder&&m.once("destroyWidget:"+e.get("id"),(function(){e.placeholder&&(e.placeholder.undelegateEvents(),e.placeholder.remove(),Backbone.View.prototype.remove.call(e.placeholder))})),!this.topCenterHasContent)"top-center"===(m.models.customization.get("appRegionOverrides")[e.get("id")]||e.get("region"))&&(this.topCenterHasContent=!0,$(".top-row").addClass("has-center"))}}else this.skippedWidgets.push(e)}else this.skippedWidgets.push(e)},waitFor:function(e){this.waitingFor.push(e.id)},loadWidget:function(e){var t=this.widgets.find({id:e});return t?new Promise((function(e,i){m.addinManager.ensureAddinLoaded(t.get("addin"),(function(t){e(t)}),null,(function(e){i(e)}))})):Promise.resolve()},getWidget:function(e){return this.widgets.find({id:e}).realview},getWidgetAsync:function(e){var t=this;return new Promise((function(i){var n=t.widgets.find({id:e});n.realview?i(n.realview):t.loadWidget(e).then((function(){i(n.realview)}))}))},registerWidget:function(e,t){this.widgets.add({id:e},{silent:!0}),this.widgets.find({id:e}).realview=t},handover:function(e,t,i){i=i||{};var n=this.widgets.find({id:e});if(n){var a=n.placeholder;if(a){var o=n.get("placeholderType");"pane"===o?i.el=a.$app:("metric"===o||"dashIcon"===o)&&(i.el=a.el)}var s,r=this;if(t)return s=new t(i),n.realview=s,n.shouldRender&&s.render(),r.updatePlaceHolder(n.placeholder,s,i.el),s;i.bootstrap&&(n.bootstrap=i.bootstrap,n.bootstrap&&l.readyForWidgets&&n.bootstrap(i.el,(function(e){n.realview=e,n.shouldRender&&e.render(),r.updatePlaceHolder(n.placeholder,e,i.el)})))}},updatePlaceHolder:function(e,t,i){$(i&&i[0]).closest(".app-placeholder").removeClass("app-placeholder"),e&&e.addRealView(t)},refocusOverlap:function(e){$("."+this.regions[e].overlappingRegion).removeClass("unfocus")},unfocusOverlap:function(e,t){var i=this;setTimeout((function(){var n=i.regions[e].overlappingRegion,a=i.regions[n],o=$("."+n);if(t){var s=[];a.widgets.forEach((function(e){var t=0,i=m.views[e.view];if(!i&&window.addin&&(i=addin.views[e.view]),i&&i.getCurrentHeight)t=i.getCurrentHeight();else{var n=$("."+e.el);t=n.length>0&&n.is(":visible")?n.height():0}s.push(t)}));var r=$("."+e).height()+o.height()+Math.max.apply(null,s),l=$(".bookmarks-wrapper"),d=0;l.css("transform")&&(d=parseInt(l.css("height"))-parseInt(l.css("transform").split(",")[5])),$("body").height()-(r+d+4)<t&&o.addClass("unfocus")}else o.addClass("unfocus")}),1)},hideApps:function(e){var t=(e=e||{}).exemptionSelectors,i=e.immediate,n=$(".app-container"),a=$(".apps");this.timeout&&clearTimeout(this.timeout),n.each((function(){$(this).css({opacity:""})})),e.layer&&e.layer!==m.hideAppExemptionLayerStack.getLayer().key&&(this.removeAppExemption(".apps .show-anyway","_"),m.hideAppExemptionLayerStack.addLayer(e.layer),this._applyExemptionsForTopLayer()),t&&this.addAppExemption(t,e.layer),i&&a.addClass("u--no-transition"),a.addClass("hide-apps"),i&&setTimeout((function(){a.removeClass("u--no-transition")}),10)},addAppExemption:function(e,t){this._toggleAppException(e,!0,t)},addVueAppExemption:function(e,t){e.forEach((function(e){m.showAnyway.show(e),m.hideAppExemptionLayerStack.addAppExemptionToLayer(e,t,!0)}))},removeAppExemption:function(e,t){this._toggleAppException(e,!1,t)},removeVueAppExemption:function(e,t){e.forEach((function(e){m.showAnyway.hide(e),m.hideAppExemptionLayerStack.removeAppExemptionFromLayer(e,t,!0)}))},_toggleAppException:function(e,t,i){$(e).each((function(){var e=$(this);if(!i||t||m.hideAppExemptionLayerStack.getLayer(i)||"_"===i){var n=e.data("show-anyway"),a=!0;if(n&&m.showAnyway[t?"show":"hide"](n),!n){e[t?"addClass":"removeClass"]("show-anyway");var o=e.attr("data-show-anyway-backbone");o?n=o:(n=m.utils.uuidv4(),e.attr("data-show-anyway-backbone",n)),a=!1}t?m.hideAppExemptionLayerStack.addAppExemptionToLayer(n,i,a):m.hideAppExemptionLayerStack.removeAppExemptionFromLayer(n,i,a)}}))},_applyExemptionsForTopLayer:function(){var e=m.hideAppExemptionLayerStack.getLayer();e.vueExemptions.size&&this.addVueAppExemption(Array.from(e.vueExemptions)),e.backboneExemptions.size&&this.addAppExemption(Array.from(e.backboneExemptions).map((function(e){return'[data-show-anyway-backbone="'+e+'"]'})).join(", "))},showApps:function(e){var t=(e=e||{}).hideFirst;if(t||this.backgroundIsReady){this.timeout&&clearTimeout(this.timeout);var i=$(".apps");if(t&&(i.addClass("u--no-transition"),i.removeClass("show-apps"),setTimeout((function(){i.removeClass("u--no-transition"),i.removeClass("hide-apps")}),10)),i.removeClass("hide-apps"),this.removeAppExemption(".apps .show-anyway",e.layer),e.layer)m.hideAppExemptionLayerStack.removeLayer(e.layer)&&m.hideAppExemptionLayerStack.getLayer().key&&(this.hideApps(),this._applyExemptionsForTopLayer(e.layer))}},appReady:function(e,t){m.console.log(m.elapsed()+": "+e+" is ready"),this[e+"IsReady"]=!0;var i=this.waitingFor.indexOf(e);i>=0&&(this.waitingFor.splice(i,1),t||this.firstShow())},showDashboard:function(){document.getElementById("main-view").style.visibility="visible"},firstShow:function(e){var t=this;m.reactive.appsReady||0!==this.waitingFor.length&&l.readyForWidgets&&!e||(this.showDashboard(),$("body").removeClass("blur show-otl"),setTimeout((function(){m.reactive.appsReady||(t.setBottomSideWidth(),l.introductionActive||""!==m.hideAppExemptionLayerStack.getLayer().key||t.showApps(),m.reactive.appsReady=!0,m.appsReadyAt=m.now(),m.trigger("appsReady"))}),1),setTimeout((function(){m.appsLoaded=!0,t.loadImages(),setTimeout((function(){m.models.activeBackground.preCacheFutureBackgroundImages(),window.chrome&&chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener((function(e){"hot-reload"===e.type&&window.location.reload()}))}),50)}),500))},loadImages:function(){for(var e=document.getElementsByTagName("img"),t=0;t<e.length;t++)e[t].getAttribute("data-src")&&e[t].setAttribute("src",e[t].getAttribute("data-src"))},setBottomSideWidth:function(){document.documentElement.style.setProperty("--bottom-side-width","auto");var e=$(".bottom-left").width();document.documentElement.style.setProperty("--bottom-side-width",Math.round(e)+"px")}}),m.models.Image=Backbone.Model.extend({loading:!1,success:!1,failed:!1,timeoutId:null,initialize:function(){},load:function(e,t){if(this.loading)return;var i=this,n=this.get("url"),a=this.get("uuid");if(null===n)n="backgrounds/"+a+".jpg";else if(!n)return void l("imageUrl is missing");var o=this.get("variant");if(this.success)return void m.trigger("image:loaded",a,n,o,t);this.loading=!0;var s=new Image;s.onload=function(){i.success=!0,i.cleanup();var e=!1,s=i.get("height"),r=i.get("width");if(s&&r)this.height==s&&this.width==r||(e=!0);else{i.get("skip_check")||(this.height<750||this.width<1e3)&&(e=!0)}if(e){return i.failed=!0,localStorage.setItem("failed:"+n,"true"),o&&({errorType:"loadError",itemUuid:a,errorMessage:"size mismatch"}.variant=o),void m.trigger("image:error",a)}i.loading=!1,m.trigger("image:loaded",a,n,o,t)},s.onerror=l,e&&(this.timeoutId=setTimeout((function(){i.success||m.trigger("image:timeout")}),e));if(!(n&&n.startsWith("data:image/")&&n.includes(";base64,")))if(m.utils.isChromium())n&&n.lastIndexOf("momo_cache_bg_uuid")<0&&(n=n+"?momo_cache_bg_uuid="+a);else if(n&&n.lastIndexOf("momo_cache_bg_uuid")>0){var r=n.split("?");r.pop(),n=r.join("?")}function l(e){i.failed=!0,i.loading=!1,i.cleanup(),e&&JSON.stringify(e),m.trigger("image:error",a)}s.setAttribute("src",n)},cleanup:function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}}),m.models.ImageManager=Backbone.Model.extend({images:{},initialize:function(){},loadImage:function(e,t,i){try{var n,a=e.uuid;return Object.prototype.hasOwnProperty.call(this.images,a)?n=this.images[a]:(n=new m.models.Image(e),this.images[a]=n),n.load(t,i),!0}catch(o){console.error(o)}return!1},preCacheFutureBackgroundImages:function(e){var t=this;if(e&&e.length>0){var i=e.findWhere({cached:!1});i&&(this.listenToOnce(m,"image:loaded",(function(){t.preCacheFutureBackgroundImages(e)})),t.preCacheBackgroundImage(i))}},preCacheBackgroundImage:function(e){if(e){var t=e.backgroundUuid(),i=e.get("filename"),n={uuid:t,url:i};n.height=e.get("height"),n.width=e.get("width"),n.skip_check=!!e.get("skip_check"),n.variant=e.get("variant"),i&&this.loadImage(n,null,!0)}}}),m.models.BackgroundBase=Backbone.Model.extend({defaults:{cached:!1},backgroundUuid:function(){var e=this.get("_id");if(e)return e;var t=this.get("filename");if(0===t.indexOf("http"))return null;var i=t.split("/");return 2==i.length&&2==(i=i[1].split(".")).length?i[0]:null}}),m.models.Background=m.models.BackgroundBase.extend({idAttribute:"forDate"}),m.models.ActiveBackground=Backbone.Model.extend({initialize:function(e,t){this.displayLogged=!1,this.backgrounds=t.backgrounds,this.legacyBackgrounds=t.legacyBackgrounds,this.listenTo(this.backgrounds,"reset",this.collectionReady),this.listenTo(this.legacyBackgrounds,"reset",this.legacyCollectionReady),this.listenTo(m,"newDay",this.handleNewDay,this),this.listenTo(m,"waitForPhotoActivation",this.waitForPhotoActivation,this),this.listenTo(this,"background:fallback",this.handleFallback,this)},handleNewDay:function(){var e=this;e.intervalId=setInterval((function(){e.backgrounds.length>0&&(e.checkActiveBackground(),clearInterval(e.intervalId))}),50)},handleFallback:function(){var e=this.fallbackKey(),t=localStorage.getItem(e),i=null;this.legacyBackgrounds.initialized?t?((i=this.legacyBackgrounds.getBackground(t))||(i=this.legacyBackgrounds.getCurrentLocalBackground())&&localStorage.setItem(e,i.backgroundUuid()),i&&(this.usingFallback=!0,this.setActiveBackground(i,!0))):i||(i=this.legacyBackgrounds.getCurrentLocalBackground())&&(localStorage.setItem(e,i.backgroundUuid()),this.usingFallback=!0,this.setActiveBackground(i,!0)):this.legacyBackgrounds.waitingForFallback=!0},waitForPhotoActivation:function(e){this.isWaitingForPhotoActivation=e},collectionReady:function(){this.checkActiveBackground(),this.isWaitingForPhotoActivation=!1},fallbackKey:function(){return"fallback-"+m.utils.getDateString()},legacyCollectionReady:function(){this.backgrounds.length>0?this.backgrounds.get(m.utils.getDateString())||this.checkActiveBackground():this.checkActiveBackground();m.trigger("legacybackgrounds:ready")},getWidgetColor:function(){if(!this.backgroundItem)return null;var e=this.backgroundItem.get("widgetColor");if(!this.isCustom()&&!e&&this.backgroundItem.get("isBuiltIn")&&this.legacyBackgrounds.length>0)return this.legacyBackgrounds.getBackground(this.activeBackgroundUuid()).get("widgetColor");var t=this.backgroundItem.get("filename");if(void 0===e&&t){var i=this;m.colorService.getAccentColor(t).then((function(e){i.backgroundItem.save({widgetColor:e}),m.models.themeManager.setAccentColor(m.models.customization.get("themeColour"))}))}return e},activeBackgroundUuid:function(){return this.backgroundItem?this.backgroundItem.backgroundUuid():null},checkActiveBackground:function(){var e=null;this.backgrounds&&this.backgrounds.length>0&&(e=this.backgrounds.getActiveItem())?this.setActiveBackground(e):this.trigger("background:fallback")},successfullyLoaded:function(e){this.backgroundItem.backgroundUuid()==e&&this.trigger("background:successfullyLoaded",this.backgroundItem)},setActiveBackground:function(e,t){this.legacyBackgrounds.waitingForFallback=!1,e&&(e.has("_id")&&this.lastBgId==e.get("_id")||(this.lastBgId=e.get("_id"),this.backgroundItem&&this.backgroundItem.cid==e.cid||(this.displayLogged=!1,this.backgroundItem=e,this.trigger("background:activeChanged",e,!!t))))},generateUUID:function(){var e=m.date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?i:3&i|8).toString(16)}))},preCacheFutureBackgroundImages:function(){m.models.imageManager.preCacheFutureBackgroundImages(this.backgrounds)},isCustom:function(){if(this.backgroundItem)return this.backgroundItem.get("isCustom")}}),m.models.LegacyBackground=m.models.BackgroundBase.extend({parse:function(e){var t=e.id;if(!t){var i=e.filename.split("/");2==i.length&&2==(i=i[1].split(".")).length&&(t=i[0])}this.set({id:t,filename:e.filename,title:e.title,source:e.source,sourceUrl:e.sourceUrl,widgetColor:e.widgetColor})}}),m.collect.Fallbacks=Backbone.Collection.extend({model:Backbone.Model,beforeDate:function(e){var t=this.filter((function(t){return t.get("fallbackDate")<e}));return new m.collect.Fallbacks(t)}}),m.collect.LegacyBackgrounds=Backbone.Collection.extend({model:m.models.LegacyBackground,url:"backgrounds/backgrounds.json",parse:function(e){return e.backgrounds},initialize:function(){this.initialized=!1,this.listenTo(this,"reset",(function(){this.initialized=!0,this.waitingForFallback&&m.models.activeBackground.trigger("background:fallback")})),localStorage.firstSynchronized||this.listenTo(this,"reset",this.initializeBackground)},initializeBackground:function(){this.getCurrentLocalBackground(),m.trigger("sync:downloadIfNeeded")},getBackground:function(e){return this.get(e)},getCurrentLocalBackground:function(){if(0===this.models.length)return null;var e=null,t=m.models.activeBackground.fallbackKey(),i=localStorage.getItem(t);if(i&&(e=this.get(i)),!e){if(!this.parseRecentFallbacks())return null;var n=Math.floor(.75*this.models.length),a=this.fallbacks.sortBy((function(e){return-e.get("fallbackDate")})),o=_.first(a,n),s=_.map(o,(function(e){return e.get("backgroundGuid")})),r=this.pluck("id");if(m.collect.backgrounds){var l=m.collect.backgrounds.sortBy((function(e){return-Date.parse(e.get("forDate"))}));n=Math.floor(.25*this.models.length);var d=_.first(l,n),c=_.map(d,(function(e){return e.get("_id")}));s=_.union(s,c)}var u=_.difference(r,s);if(u.length>0){var g=_.sample(u);e=this.get(g)}else e=this.sample()}return e},parseRecentFallbacks:function(){if(this.fallbacks)return!0;this.fallbacks=new m.collect.Fallbacks;var e=this;return Object.keys(localStorage).forEach((function(t,i){if(0===t.indexOf("fallback-")){var n=t.slice(9),a=Date.parse(n),o=new Backbone.Model({fallbackDate:a,backgroundGuid:i});e.fallbacks.add(o)}})),!0}}),m.models.BackgroundManager=m.models.FeedManager.extend({initialize:function(){m.models.FeedManager.prototype.initialize.call(this,m.models.Background,"background"),m.models.imageManager=new m.models.ImageManager,m.collect.legacyBackgrounds=new m.collect.LegacyBackgrounds,m.models.activeBackground=new m.models.ActiveBackground({},{backgrounds:m.collect.backgrounds,legacyBackgrounds:m.collect.legacyBackgrounds}),this.listenTo(m,"image:loaded",this.markBackgroundAsCached),m.widgetManager.loadWidget("background")},firstFetch:function(){var e=m.collect.backgrounds,t=m.collect.legacyBackgrounds;m.firstLoadEver&&(e=m.collect.legacyBackgrounds,t=m.collect.backgrounds,m.firstLoadEver=!1),e.fetch({reset:!0}),setTimeout((function(){t.fetch({reset:!0})}),500)},getActiveItem:function(){return m.models.activeBackground.backgroundItem},markBackgroundAsCached:function(e,t,i){var n={_id:e};i&&(n.variant=i);var a=m.collect.backgrounds.where(n);a&&a.forEach((function(e){e&&e.get("testOnly")?e.destroy():e.save("cached",!0)}))}});var oe="https://api.momentumdash.com/";m.collect.SyncedCollection=Backbone.Collection.extend({loadedOnce:!1,initialize:function(e,t){(this.model=t.model,this.version=2,this.rate=0,this.rateLimit=5,this.sameTimeThreshold=100,this.backOffTime=1e4,this.lastCall=0,this.name=t.name,t.isDummy||t.onlineOnly)||(localStorage.getItem("syncedCollectionVersion-"+this.name)||(this.migrate(),localStorage.setItem("syncedCollectionVersion-"+this.name,this.version)));this.offlineOnly=t.offlineOnly,this.readOnly=t.readOnly,t.onlineOnly?(this.onlineOnly=!0,this.idAttribute=this.serverIdAttribute="id"):(this.idAttribute=t.idAttribute||"csid",this.serverIdAttribute=t.serverIdAttribute||"id",t.isDummy||(this.localStorage=new Backbone.LocalStorage(t.name))),this.apiUrl=t.apiUrl||oe+t.name,this.listenTo(this,"add",this.onAdd),this.listenTo(this,"change",this.onChange),this.listenTo(this,"reset",this.onReset),this.includeArchived=!1,this.transientProps=t.transientProps||[],this.transientProps.push("syncing"),this.localProps=t.localProps||[],this.localProps.push("serverSetId",this.serverIdAttribute),this.sorted=t.sorted,this.parent=t.parent},everLoaded:function(){return this.offlineOnly||this.onlineOnly||!!localStorage.getItem(this.name+"-loaded-once")},setLoadedOnce:function(){this.parent&&this.parent.set({loadedOnce:!0},{silent:!0,ignoreRender:!0,ignoreSave:!0});var e=!this.loadedOnce;return e&&this.trigger("loaded-from-server"),localStorage.setItem(this.name+"-loaded-once","true"),this.loadedOnce=!0,this.loading=!1,e},fetch:function(e){var t=this;((e=e||{}).skipLocalFetch||Backbone.Collection.prototype.fetch.call(this,e),this.offlineOnly||e.skipServerFetch||this.isComputed)?this.setLoadedOnce()&&this.trigger("refresh"):!e.skipLocalFetch&&e.reset||this.onlineOnly||this.isDummy||this.fetchFromServer(e.skipLocalFetch?function(){t.trigger("sync",t,t.models,e),e.success&&e.success()}:null,e.skipLocalFetch?e.error:null,e)},create:function(e,t){if(this.onlineOnly)return Backbone.Collection.prototype.create.call(this,e,t);t=t||{},e[this.idAttribute]||(e[this.idAttribute]=m.utils.uuidv4()),e.serverSetId||(e.serverSetId=!1);var i=this.add(e,t);return i.id=i.get(this.idAttribute),i.collection=this,i.save({},{silent:!0,ignoreSave:!0,ignoreRender:!0}),t.success&&t.success(i),i},migrate:function(){var e=this,t=localStorage.getItem(this.name);t&&0!==(t=t.split(",")).length&&t.map((function(t){var i=e.name+"-"+t,n=localStorage.getItem(i);n&&((n=JSON.parse(n))[e.idAttribute]||(n[e.idAttribute]=n.id,n=JSON.stringify(n),localStorage.setItem(i,n)))}))},activeItems:function(){return this.filter((function(e){return!e.get("deleted")}))},onReset:function(e,t){if(!this.onlineOnly&&!this.isDummy){if(this.fetchedOnce=!0,this.offlineOnly)this.setLoadedOnce()&&this.trigger("refresh");var i=this;this.models.forEach((function(e){e.id=e.get(i.idAttribute),i.transientProps&&i.transientProps.forEach((function(t){e.attributes[t]=!1})),e.get("serverSetId")||e.set("serverSetId",!1)})),this.offlineOnly||this.isDummy||this.syncToServer((function(){i.fetchFromServer(null,null,t)}))}},findHavingAttribute:function(e){return this.filter((function(t){return t.has(e)}))},hasAttribute:function(e){return!!this.find((function(t){return t.has(e)}))},onAdd:function(e,t,i,n){if((i=i||{}).ignoreSave||e.get("unsyncable")||e.get("syncing")&&e.get("syncing")>m.now()||e.get("serverSetId")||e.get("deleted")||this.isValidModel&&!this.isValidModel(e)||this.readOnly||this.offlineOnly||this.onlineOnly)n&&n();else if(this.shouldIgnoreSync&&this.shouldIgnoreSync(e))n&&n();else{var a=e.toJSON(),o=e.get(this.idAttribute);this.transientProps=this.transientProps||[],this.transientProps.push("syncing"),this.transientProps.forEach((function(e){delete a[e]})),this.localProps&&this.localProps.forEach((function(e){delete a[e]})),e.set({syncing:m.now()+1e4},{silent:!0});var s=this;this.syncInProgress=!0,s.idAttribute!==s.serverIdAttribute&&delete a[s.idAttribute];var r={};Object.assign(r,a,i.additionalData);var l=e.get("changed_props")&&e.get("changed_props").toString();r.csid=o,$.ajax({url:e.apiUrl||this.apiUrl,contentType:"application/json",type:"POST",data:JSON.stringify(r)}).done((function(t){t&&t[s.serverIdAttribute]&&(a=e.toJSON(),e.get("changed_props")&&e.get("changed_props").toString()===l&&(a.changed_props=null),a.serverSetId=!0,a.syncing=0,delete a[s.idAttribute],a[s.serverIdAttribute]=t[s.serverIdAttribute],(e=s.getModel(e,o))&&(e.save(a,{silent:!0}),e.saveHandler&&e.saveHandler(t))),i.serverSuccess&&i.serverSuccess(e)})).fail((function(t,i,n){if("Bad Request"===n){if(!(e=s.getModel(e,o)))return;e.id=e.get(e.idAttribute),e.destroy({silent:!0})}})).always((function(){(e=s.getModel(e,o))&&e.set({syncing:0},{silent:!0}),s.syncInProgress=!1,s.missedSync&&(s.missedSync=!1,s.syncToServer()),n&&n()}))}},getModel:function(e,t){var i={};i[this.idAttribute]=t;var n=this.findWhere(i);return n||((i={})[this.serverIdAttribute]=t,n=this.findWhere(i)),!n&&e&&e.mainContent&&(n=this.findWhere(e.mainContent())),n},onChange:function(e,t){if(!(this.readOnly||this.offlineOnly||this.onlineOnly||t&&t.skipServerSync)){var i=this;if(!(t=t||{}).ignoreSave){var n=e.changedAttributes();if(n&&!n[this.idAttribute]&&!t.createdNow){var a,o=null,s=!1;for(a in this.transientProps&&this.transientProps.forEach((function(e){delete n[e]})),this.localProps&&this.localProps.forEach((function(e){delete n[e]})),n)Object.prototype.hasOwnProperty.call(n,a)&&"changed_props"!==a&&(o||(o=e.get("changed_props")||[]),_.contains(o,a)||(a!==i.idAttribute&&o.push(a),s=!0));var r=!1;if(!e.get(this.serverIdAttribute)&&Object.keys(n).length){if(!(e.get("syncing")&&e.get("syncing")>m.now()))return void this.onAdd(e,this,t);r=!0,i.syncScheduled=!0,setTimeout((function(){i.syncToServer(t.serverSuccess)}),1e3)}s&&o&&o.length>0&&e.save({changed_props:o},{silent:!0,ignoreSave:!0,ignoreRender:!0,success:function(){t.postponeSync||r||i.syncToServer(t.serverSuccess)}})}}}},syncToServer:function(e){if(this.readOnly||this.offlineOnly||this.onlineOnly)e&&e();else if(this.syncInProgress)this.missedSync=!0;else{var t=this;this.syncInProgress=!0;var i=0,n=this.findHavingAttribute("changed_props"),a=this.where({serverSetId:!1});if(a?Array.isArray(a)||(a=[a]):a=[],a.forEach((function(e){t.onAdd(e,null,null,(function(){s()}))})),n&&0!==n.length){var o=!1;n.forEach((function(i){if(!o&&i.get(t.serverIdAttribute)){var n=i.get("changed_props"),a=n.toString();if(t.transientProps&&t.transientProps.forEach((function(e){var t=n.indexOf(e);t>=0&&n.splice(t,1)})),t.localProps&&t.localProps.forEach((function(e){var t=n.indexOf(e);t>=0&&n.splice(t,1)})),!n||0===n.length)return i.save({changed_props:null},{silent:!0}),void s();i.syncing=!0;var r={};if(_.each(n,(function(e){"changed_props"!==e&&e!==t.idAttribute&&(r[e]=i.get(e))})),!t.isWithinRateLimit()&&!t.syncScheduled)return t.syncScheduled=!0,setTimeout((function(){t.syncScheduled=!1,t.syncToServer(e)}),t.backOffTime),t.syncInProgress=!1,void(o=!0);if(!t.syncScheduled){i.getSupplementaryData&&Object.assign(r,i.getSupplementaryData());var l=i.get(t.serverIdAttribute),d=(i.apiUrl||t.apiUrl)+"/"+encodeURIComponent(l),c=i.get(t.idAttribute);$.ajax({url:d,contentType:"application/json",type:"PATCH",data:JSON.stringify(r)}).done((function(e,n){(i=t.getModel(i,c))&&(e&&e.success||"success"===n)&&(i.collection&&i.get("deleted")?i.destroy({silent:!0}):i.get("changed_props")&&i.get("changed_props").toString()===a&&i.collection&&i.save({changed_props:null},{silent:!0}),"T"===l[0]&&t.fetch({reset:!0,skipLocalFetch:!0}))})).always((function(){s()}))}}}))}else 0===a.length&&(this.syncInProgress=!1,e&&e())}function s(){++i===n.length+a.length&&(t.syncInProgress=!1,i=0,t.missedSync&&(t.missedSync=!1,t.syncToServer()),e?e():t.fetchFromServer(null,null,t.lastFetchOptions))}},isWithinRateLimit:function(){var e=m.now();if(e<this.lastCall+this.sameTimeThreshold){if(this.lastCall=e,this.rate++,this.rate>this.rateLimit)return!1}else this.rate=0;return this.lastCall=e,!0},fetchFromServer:function(t,i,n){if(this.lastFetchOptions=n,!this.syncScheduled){n=n||{};var a=m.now()-this.lastFetch<500;if(this.offlineOnly||n.skipServerFetch||a)t&&t();else{this.lastFetch=m.now();var o=n.data,s=this;$.ajax({url:this.apiUrl+(this.includeArchived?"?includeArchived=true":""),contentType:"application/json",type:"GET",data:o}).done((function(e){var t=!1;if(e)if("authRequired"===e.status&&s.handleAuthRequired)s.handleAuthRequired(e);else{if(s.parse&&(e=s.parse(e)),!Array.isArray(e))for(var i in e)Array.isArray(e[i])&&(e=e[i]);var a=[];_.each(e,(function(e){if(e){a.push(e[s.serverIdAttribute]);var i={};i[s.serverIdAttribute]=e[s.serverIdAttribute]+"";var n=s.findWhere(i);if(e.serverSetId=!0,n){e[s.idAttribute]||(e[s.idAttribute]=n.get(s.idAttribute));var o=Math.max(n.get("modifiedServer")&&Date.parse(n.get("modifiedServer"))||0,n.get("modified")||0);(s.readOnly||!e.modifiedServer||Date.parse(e.modifiedServer)>o)&&n.save(e,{ignoreSave:!0,ignoreRender:!0})}else e[s.idAttribute]||(e[s.idAttribute]=e[s.serverIdAttribute]),s.create(e,{ignoreSave:!0,ignoreRender:!0}),e.archived||(t=!0)}}));var o=s.models.slice();if(!1!==n.remove&&o.forEach((function(e){if(e.get("serverSetId")&&a.indexOf(e.get(s.serverIdAttribute))<0&&!e.get("isDummy")&&!e.get("unsyncable")){var i={};i[s.idAttribute]=e.get([s.idAttribute])+"";var n=s.findWhere(i);n.id=n.get(n.idAttribute),n.destroy({silent:!0}),t=!0}})),s.readOnly)return s.set(e,{silent:!0,remove:!0}),s.trigger("refresh"),void s.setLoadedOnce();s.trigger("change",null,{ignoreSave:!0}),(t=s.setLoadedOnce()||t)&&s.trigger("refresh"),s.trigger("server-sync"),s.handleOrdering&&s.handleOrdering(e)}})).fail((function(t){t.responseJSON&&"authRequired"===t.responseJSON.status&&s.handleAuthRequired?s.handleAuthRequired(t.responseJSON):t.responseJSON&&"Microsoft Todo is not enabled for this account."===t.responseJSON.message.detail?e.$emit("flashMessage",{icon:"data:image/svg+xml,%3Csvg viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M64 32C64 49.6731 49.6731 64 32 64C14.3269 64 0 49.6731 0 32C0 14.3269 14.3269 0 32 0C49.6731 0 64 14.3269 64 32ZM28 46C28 43.7909 29.7909 42 32 42C34.2091 42 36 43.7909 36 46C36 48.2091 34.2091 50 32 50C29.7909 50 28 48.2091 28 46ZM32 15C29.7909 15 28 16.7909 28 19V33C28 35.2091 29.7909 37 32 37C34.2091 37 36 35.2091 36 33V19C36 16.7909 34.2091 15 32 15Z' /%3E%3C/svg%3E",contact:!1,message:"Oops, your Microsoft account does not support tasks",button:{text:"Learn more",action:function(){m.utils.getBrowser().tabs.create({url:"https://go.microsoft.com/fwlink/?linkid=2153209"})}}}):i?i():!s.fetchedOnce&&n.error&&n.error(t)})).always((function(){t&&t()}))}}}}),m.models.TeamInfo=Backbone.Model.extend({localStorage:new Backbone.LocalStorage("team-info"),defaults:{team:null,id:1},initialize:function(){this.fetch()}}),m.models.Message=Backbone.Model.extend({defaults:function(){return{title:null,message:"",recurringInterval:null,priority:5,views:0,viewLimit:3,deleted:!1,createdDate:m.now(),visible:!1,loginOnClick:!1,targetArea:null,important:!1,fromServer:!1,image_url:""}},showMessage:function(e,t,i,n){m.commandManager.execute("notification.show.enhanced",{title:e,message:t,views:0,viewLimit:i,visible:!0,loginOnClick:n})},isTeamNotification:function(){return"team"===this.get("notification_type")},dismissMessage:function(){m.commandManager.execute("notification.dismiss")},save:function(e,t){if(t||(t={}),e||(e=_.clone(this.attributes)),Object.prototype.hasOwnProperty.call(e,"dismissed")&&e.dismissed&&(e.deleted=!0),!t.download_save&&this.get("fromServer"))try{var i=null;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&"changed_props"!=n&&"sync_success"!=n&&(i||(i=this.get("changed_props")||[]),_.contains(i,n)||i.push(n));i&&(e.changed_props=i,e.sync_success=!1,t.silent=!1)}catch(a){console.error(a)}return Backbone.Model.prototype.save.call(this,e,t)}}),m.collect.Messages=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage("momentum-messages"),model:m.models.Message,cleaned:!1,initialize:function(){this.listenTo(this,"reset",this.cleanupMessagesIfRequired)},cleanupMessagesIfRequired:function(){if(!this.cleaned){this.cleaned=!0;var e=[];this.each((function(t){if(t.get("deleted")||t.get("expiry")&&!(Date.parse(t.get("expiry"))>m.now()))t.get("fromServer")&&t.get("sync_success")&&!t.get("changed_props")&&e.push(t);else{var i=t.get("filter");i&&m.conditionalFeatures.featureEnabled(i)?t.save({deleted:!0,filtered:!0}):5==t.get("priority")?t.get("fromServer")?t.save({deleted:!0}):e.push(t):t.get("visible")||t.save({deleted:!0})}})),e.length>0&&_.each(e,(function(e){e.destroy()}))}}});m.models.NotificationSync=Backbone.Model.extend({baseUrl:"https://api.momentumdash.com/notifications",initialize:function(e){this.collection=e.collection,this.listenTo(this.collection,"change:changed_props",this.onChange),this.listenTo(this.collection,"reset",this.onReset)},findHavingAttribute:function(e,t){return e.filter((function(e){return e.has(t)}))},hasAttribute:function(e,t){return!!e.find((function(e){return e.has(t)}))},onReset:function(){this.syncToServer()},onChange:function(e,t){if(!t.ignoreSave){var i=e.changedAttributes();i&&Object.prototype.hasOwnProperty.call(i,"changed_props")&&i.changed_props&&this.syncToServer()}},syncToServer:function(e){var t=this,i=this.findHavingAttribute(this.collection,"changed_props");Promise.all(i.map((function(e){if(e.get("fromServer")){var i=e.get("changed_props");if(!i||0==i.length)return Promise.resolve();var n={};if(_.each(i,(function(t){"changed_props"!=t&&"sync_success"!=t&&(n[t]=e.get(t))})),1==Object.keys(n).length&&Object.prototype.hasOwnProperty.call(n,"views"))return Promise.resolve();var a=t.baseUrl+"/"+encodeURIComponent(e.id);return new Promise((function(t){$.ajax({url:a,contentType:"application/json",type:"PATCH",data:JSON.stringify(n)}).done((function(t){t&&t.success&&e.save({changed_props:null,sync_success:!0},{silent:!0})})).fail((function(){e.save({sync_success:!1},{silent:!0})})).always(t)}))}}))).then((function(){e&&e()}))}});var se="https://api.momentumdash.com/";m.models.NotificationManager=Backbone.Model.extend({backgroundLoaded:!1,_notificationView:null,settingsVisible:!1,initialize:function(){this.displayed=[],this.collection=new m.collect.Messages,m.models.message=new m.models.Message,this.listenTo(this.collection,"add reset",this.displayPendingMessages),this.listenToOnce(m,"background:loadSuccessful",this.onBackgroundLoaded),this.listenTo(m,"settings:hidden",this.settingsHidden),this.listenTo(m,"settings:visible",this.onSettingsVisible),this.listenTo(m,"notifications:timestamp",this.onAvailableTimestamp),this.listenTo(m,"appsReady",this.displayPendingMessages),m.conditionalFeatures.featureEnabled("notifySyncOff")||(this.notifySync=new m.models.NotificationSync({collection:this.collection})),this.collection.fetch({reset:!0})},onBackgroundLoaded:function(){this.backgroundLoaded||(this.backgroundLoaded=!0,this.displayPendingMessages(),m.commandManager.execute("clean.localstorage"))},displayPendingMessages:function(){var e=this;if(this.collection.cleanupMessagesIfRequired(),l.appsReady&&!l.introductionActive&&!this.settingsVisible){var t=this.notificationView();if(t&&!(t.notifying||m.modal.locked||m.reactive.onboardingRefreshing)){var i=this.collection.where({deleted:!1,visible:!0}).filter((function(t){var i=t.get("filter"),n=t.get("recurringInterval"),a=t.get("lastDismissed");if((!i||!m.conditionalFeatures.featureEnabled(i))&&!(n&&a+n>(new Date).getTime())&&!(t.get("expiry")&&Date.parse(t.get("expiry"))<m.now())&&(!t.get("fromServer")||t.get("group_notification_id")))return!e.displayed.includes(t)})).sort((function(e,t){return e.get("priority")>t.get("priority")?1:e.get("priority")<t.get("priority")?-1:t.get("createdDate")-e.get("createdDate")}));if(i&&0!==i.length){var n=i[0];this.displayed.push(n),t.showMessage(n)}}}},onAvailableTimestamp:function(e){if(e){var t=localStorage.getItem("ts_notifications");(!t||e>t)&&this.downloadNotifications()}},downloadNotifications:function(){var e=this,t=localStorage.getItem("ts_notifications"),i=se+"notifications";t&&(t=parseInt(t,10),Number.isInteger(t)&&(i=i+"?ts="+t));try{$.ajax({type:"GET",contentType:"application/json",url:i}).done((function(t){t&&t.timestamp&&(t.notifications&&t.notifications.length>0&&(e.collection.reset(t.notifications),e.collection.invoke("save",null,{download_save:!0})),localStorage.setItem("ts_notifications",t.timestamp))}))}catch(n){console.error(n)}},showMessage:function(e,t,i,n){var a={title:e,message:t,visible:!0};void 0!==i&&(a.viewLimit=i),void 0!==n&&(a.loginOnClick=n),this.collection.create(a)},showMessageEnhanced:function(e,t,i){Object.prototype.hasOwnProperty.call(e,"visible")||(e.visible=!0);var n={};t&&(n.success=t),i&&(n.silent=!0),this.collection.create(e,n)},dismissMessage:function(){this._notificationView&&this.notificationView().hideNotification()},settingsHidden:function(){this.settingsVisible=!1,this.displayPendingMessages()},onSettingsVisible:function(){this.settingsVisible=!0},notificationView:function(){return this._notificationView||(this._notificationView=new m.views.Notification),this._notificationView}}),m.views.Notification=Backbone.View.extend({attributes:{class:"notification"},notifying:!1,timeoutId:null,analytics:new d({feature:"notifications"}),areaMap:{settings:{selector:".app-container.settings .app-dash",targetDistance:15,position:"top"},teamLogo:{position:"bottom",targetDistance:10,selector:"#team-logo"},addWidget:{selector:'[data-ob="add-metric"]',targetDistance:5,position:"bottom",alignment:"right",customCss:'[data-ob="add-metric"] { opacity: 1 !important; }'},notes:{selector:".app-container.notes",position:"top",alignment:"right"},askAi:{selector:".app-container.chat",position:"top",alignment:"right"},searchCenter:{selector:".app-container.big.search .search-icon-container .icon-search",targetDistance:25,position:"top"},tabStash:{selector:".app-container.tabs",position:"bottom"},links:{selector:".app-container.links",position:"bottom"}},initialize:function(){this.renderedOnce=!1,this.listenTo(m,"notification:hide",this.hideNotification),this.listenTo(m,"notification:dismiss",this.dismissNotification)},showMessage:function(e){if(!this.model||this.model.cid!=e.cid){this.model=e;var t=this;["cta_cmd","secondary_cmd"].forEach((function(e){var i=t.model.get(e);i&&m.commandManager.beforeExecute(i)})),this.render()}},render:function(){var e=this;this.notifying=!0,this.incrementViews();var t=this.model.get("targetArea"),i=this.model.get("notification_type");t||(t=i&&"momentum"!==i?"teamLogo":"settings");var n=this.areaMap[t],a=b({id:this.model.get("id"),component:()=>g((()=>import("./Popup-3lZ9av7x.js")),__vite__mapDeps([30,13,14,15,8,9,31,32,33,34,35,36,37,38,39])),componentProps:{headerText:this.model.get("title"),bodyText:this.model.get("message"),position:n.position,region:n.region,targetDistance:n.targetDistance,targetElementSelector:n.selector,ctaText:this.model.get("cta_text"),ctaCallback:this.model.get("cta_cmd")?this.ctaButtonClicked.bind(this):void 0,secondaryText:this.model.get("secondary_text"),secondaryCallback:this.model.get("secondary_text")?this.secondaryTextClicked.bind(this):void 0,secondaryClasses:"button-tertiary",hideCallback:this.hideNotificationClicked.bind(this),pulseAnimation:this.model.get("important"),imageUrl:this.model.get("image_url"),notificationStyling:{image_has_white_background:this.model.get("image_has_white_background")}},customCss:n.customCss,onLeave:function(){m.models.notificationManager.displayPendingMessages()}});m.cmd("modal.open",a),this.showNotification();var o=this.model.get("display_time");!o||o<=0||(this.timeoutId=setTimeout((function(){e.hideNotification()}),o))},incrementViews:function(){var e=this.model.get("views")+1;this.setModelCollection(),null!==this.model.get("viewLimit")&&(e>=this.model.get("viewLimit")?this.model.save({visible:!1,views:e}):this.model.save({views:e},{silent:!0}))},dismissNotification:function(){this.model&&(this.saveDismissal(),this.hideNotification())},showNotification:function(){this.analytics.deferredCapture("notification show",this.getIdsForAnalytics(this.model))},hideNotification:function(){clearTimeout(this.timeoutId),this.notifying&&(m.trigger("modal:close"),this.notifying=!1)},hideNotificationClicked:function(e){e&&e.stopPropagation(),this.hideNotification(),this.setModelCollection(),this.saveDismissal(),this.analytics.capture("notification dismiss",this.getIdsForAnalytics(this.model))},ctaButtonClicked:function(e){e&&e.stopPropagation();var t=this.model.get("cta_cmd"),i=this.model.get("cta_options");t&&t.length>0&&(this.setModelCollection(),this.hideNotification(),this.saveDismissal(!0),m.commandManager.execute(t,i),this.analytics.capture("primary cta click",this.getIdsForAnalytics(this.model)))},saveDismissal:function(e){var t=this.model.get("recurringInterval")?{lastDismissed:(new Date).getTime()}:{state:"dismissed",visible:!1};e&&(t.ctaClicked=m.now()),this.model.save(t,{silent:!0})},secondaryTextClicked:function(e){e&&e.stopPropagation();var t=this.model.get("secondary_cmd"),i=this.model.get("secondary_options");t&&t.length>0&&(this.setModelCollection(),this.model.save({secondaryClicked:m.now()},{silent:!0}),m.commandManager.execute(t,i),this.analytics.capture("secondary cta click",this.getIdsForAnalytics(this.model))),this.model.get("secondary_hide")&&this.hideNotification()},setModelCollection:function(){this.model.collection||(this.model.collection=m.models.notificationManager.collection)},getIdsForAnalytics:function(e){var t=e.get("group_notification_id"),i=e.get("title")?Array.from(e.get("title")).slice(0,19).join(""):"";return{title:e.isTeamNotification()?"[Redacted]":i,notification_id:t,group_id:e.get("campaign_group_id"),labels:(e.get("labels")||[]).join(", "),group_name:e.get("campaign_group_name")}}}),m.commands.NotificationShow=m.models.Command.extend({defaults:{id:"notification.show"},execute:function(e,t){m.models.notificationManager&&m.models.notificationManager.showMessage(e,t)}}),m.commands.NotificationShowEnhanced=m.models.Command.extend({defaults:{id:"notification.show.enhanced"},execute:function(e,t,i){m.models.notificationManager&&m.models.notificationManager.showMessageEnhanced(e,t,i)}}),m.commands.NotificationDismiss=m.models.Command.extend({defaults:{id:"notification.dismiss"},execute:function(){m.models.notificationManager&&m.models.notificationManager.dismissMessage()}}),m.commands.EnableSearchInCenter=m.models.Command.extend({defaults:{id:"notification.searchInCenter.enable"},execute:function(){function e(){m.trigger("modal:show",Object.assign({},m.modals.definitions.searchInCenterNotification,{bodyText:"If you prefer to see your daily goal here, switch back using this button."}))}m.models.customization.get("centerBelowApp")!==k.Search?m.once("centerBelow:afterEnter",e):e(),m.models.customization.save({centerBelowApp:k.Search})}});var re={flashInputLengthError:function(e){m.utils.toggleClassTwice(e,m.utils.mConst("classInputLengthError"))},checkForInputMaxLengthError:function(e){e.is("input")&&e.val().length>=e.attr("maxlength")&&m.settingsUtils.flashInputLengthError(e)},updateCharCount:function(e,t,i,n){var a=$(e.delegatedTarget.form);n=n||a.find("input");var o=a.find(".char-count"),s=n.val().length,r=t.inputLengthMaxDatabase-s;o.text(r).removeClass("warn over"),o.mToggle("inline",s>=t.inputLengthShow),n.removeClass("over"),s>t.inputLengthMaxDatabase?(o.addClass("over"),n.addClass("over")):s>=t.inputLengthWarn&&o.addClass("warn"),i&&i(a,s,r)},moveCursorToEndOfInput:function(e){var t=e[0];t.selectionStart=t.selectionEnd=t.value.length},scrollToEndOfInput:function(e){var t=e[0];t.scrollWidth>t.clientWidth&&(0!==e.scrollLeft()&&e.scrollLeft(0),e.scrollLeft(t.scrollWidth-t.clientWidth))},toggleAdvanced:function(e){var t=e.$(".wrapper-advanced"),i=e.$(".smooth-height-content");e.resizeSensorSet||(this.initializeResizeSensor(e,i,e.$(".smooth-height-wrapper")),e.resizeSensorSet=!0),i.toggleClass("active"),!e.wrapperAdvancedIsInFlow&&i.hasClass("active")&&(e.wrapperAdvancedIsInFlow=!0,t.css("display","block"))},initializeResizeSensor:function(e,t,i){e.resizeSensor&&e.resizeSensor.detach(),i.css("height",t.height()),e.resizeSensor=new ResizeSensor(t,(function(){t.hasClass("active")?i.css("height",t.height()):i.css("height",0)}))},getInitialFeedSettings:function(e){var t=!0,i=!1;return"false"===localStorage.getItem(e.feedMomentumName)&&(t=!1),"true"===localStorage.getItem(e.feedCustomName)&&(i=!0),{feedMomentumClass:t?"on":"",feedCustomClass:i?"on":""}},setFeedVars:function(e){e.$feedMomentumSlider=e.$("#feed-momentum-slider .toggle-switch"),e.$feedCustomSlider=e.$("#feed-custom-slider .toggle-switch")},updateFeedSettings:function(e){var t=e.settings.get(e.manager.feedMomentumName),i=e.settings.get(e.manager.feedCustomName);e.$("#feed-momentum-slider .toggle-switch").toggleClass("on",t),e.$("#feed-custom-slider .toggle-switch").toggleClass("on",i),localStorage.setItem(e.manager.feedMomentumName,t),localStorage.setItem(e.manager.feedCustomName,i)},subnavAddAll:function(e,t,i,n,a){_.each(e.subViews,(function(e){e.destroy()})),e.subViews=[],e.collection.each((function(i){e.addOne(i,t)})),e.$empty.removeClass("loading"),e.handleCollectionUpdate(),void 0!==n&&n(e),i.removeClass("hidden"),void 0!==a&&a()},subnavAddOne:function(e,t,i,n,a){var o=t.render().$el;e.subViews.push(t),n?i.prepend(o):i.append(o),a&&o.addClass("animate-item"),setTimeout((function(){o.removeClass("animate-item")}),300)},renderSubnav:function(e,t,i){e.$(".list-body").hide(),t.render(),e.$(".subnav-titles").find("h4").removeClass("active").siblings("."+i).addClass("active"),t.$el.css("display","block"),e.subnav=i},updateEmptyState:function(e){e.$empty.mToggle("block",0===e.collection.length)},subnavHistoryLoadMore:function(e,t,i){e.stopPropagation(),i.LoadMoreHistory(),m.settingsUtils.subnavHistoryUpdateLoadMore(t)},subnavHistoryUpdateLoadMore:function(e){void 0===e&&(e=this),e.$(".load-more").mToggle("inline-block",!!e.collection.load_more)},handleCollectionUpdateCustom:function(e,t,i){e.deletingFinalItem?setTimeout((function(){e.deletingFinalItem=!1,e.cancelAdd(),m.settingsUtils.displayEmptyStateAndAddForm(e,t,i)}),m.utils.mConst("timeContentItemAnimation")):m.settingsUtils.displayEmptyStateAndAddForm(e,t,i)},displayEmptyStateAndAddForm:function(e,t,i){t.mToggle("block",i),m.settingsUtils.updateAddFormBorder(e.$addForm,i)},updateAddFormBorder:function(e,t){e.toggleClass("no-top-border",t)},cancelAddGeneral:function(e,t){t&&t.preventDefault(),e.$addForm.is(":visible")&&(e.resetAdd(!0),e.toggleAddForm())},changeToEditMode:function(e,t){m.settingsUtils.triggerItemEditing(e),e.$el.addClass("editing"),t.trigger("focus"),m.settingsUtils.moveCursorToEndOfInput(t),m.settingsUtils.scrollToEndOfInput(t)},handleKeypressEnter:function(e,t,i){13===e.keyCode?(e.preventDefault(),e.shiftKey||e.ctrlKey||e.metaKey||e.altKey||t()):void 0!==i&&m.settingsUtils.checkForInputMaxLengthError(i)},handleKeyupEsc:function(e,t){27===e.keyCode&&(e.stopPropagation(),t())},triggerItemEditing:function(e){e.main.itemEditingId=e.model.id,e.manager.trigger("item-editing")},preventMultipleEdits:function(e){void 0===e&&(e=this),e.model.id!==e.main.itemEditingId&&m.settingsUtils.returnToViewMode(e)},getOutOfEditMode:function(e){e.$el.removeClass("editing"),e.updateTooltip&&e.updateTooltip()},returnToViewMode:function(e){void 0===e&&(e=this),e.$el.hasClass("editing")&&e.processEditForm(),e.$(".delete-group").is(":visible")&&e.toggleDeleteConf()},onDestroyModel:function(){if(1===this.main.collection.length)this.main.deletingFinalItem=!0,_.bind(this.destroy,this)();else{this.$el.addClass("animate-item reverse");var e=this;setTimeout((function(){_.bind(e.destroy,e)(),e.main.syncHelper&&e.main.syncHelper()}),300)}},toggleDeleteConf:function(e){var t=e.$(".controls"),i=e.$(".controls > .control"),n=e.$(".delete-group");n.css("display",n.is(":visible")?"none":"flex"),n.is(":visible")&&m.settingsUtils.triggerItemEditing(e),t.toggleClass("delete-clicked"),i.mToggle("inline-flex")},processEditFormBasic:function(e,t){var i=t?"set":"save",n=e.$input.val().trim();return m.utils.betweenInclusive(n.length,1,e.main.inputLengthMaxDatabase)?(e.model[i]({body:n},{wait:!0,patch:!0,success:function(){m.settingsUtils.getOutOfEditMode(e),e.manager.handleItemEdit(e.model)},error:function(){console.error("edit content item error for view:",e)}}),!0):(m.settingsUtils.flashInputLengthError(e.$input),!1)},abortEditBasic:function(e){e.$input.val(e.model.get("body")),m.settingsUtils.getOutOfEditMode(e)}};for(var le in re)m.settingsUtils[le]=re[le];m.models.PersistentSettings=Backbone.Model.extend({localStorage:new Backbone.LocalStorage("momentum-customization"),defaultForTeamIfNotSet:{themeColour:"photo"},defaultForPlusIfNotSet:{themeColour:"photo"},defaultIfNotSet:{mantraVisible:!1,greetingVisible:!0,quoteVisible:!0,bookmarksVisible:!1,linksVisible:!0,todoVisible:!0,metricVisible:!0,weatherVisible:!0,searchVisible:!1,requestSync:!1,keepTodoState:!0,countdownVisible:!0,notesVisible:!0,notesFullscreen:!1,percentClock:!1,multiClockVisible:!0,soundscapesVisible:!0,askAiVisible:!0,linksKeepOpen:!1,lowPerformance:!1,themeColour:"system",themeFont:"default",autoFocus:!1,balanceModeStr:JSON.stringify({enabled:!1,balanceClock:!1,balanceTodo:!1,balancePercentClock:!1,balanceFocus:!0,balanceNotes:!1,balanceGreeting:!1,customTime:!1,customDays:!1,start:{hour:9,minute:"00",noon:"AM"},end:{hour:5,minute:"00",noon:"PM"},startCustom:{hour:9,minute:"00",noon:"AM"},endCustom:{hour:5,minute:"00",noon:"PM"},days:[!1,!0,!0,!0,!0,!0,!1],daysCustom:[!1,!0,!0,!0,!0,!0,!1]}),mantraSettingsStr:JSON.stringify({pinnedMantra:null,firstMantraActivated:!1,frequency:2}),bookmarksSettingsStr:JSON.stringify({guided:!1,iconsOnly:!1,openInNewTab:!1,includeBookmarks:!1,includeOtherBookmarks:!1,defaultMostVisited:!1,includeMostVisited:!0,chromeTabLocation:"links"}),weatherDetail:!0,weatherHourly:!0,searchProvider:a()||!("chrome"in window)?"google":"browser",appRegionOverrides:{},hour12clock:"M"===(new Date).toLocaleString(window.navigator.userLanguage||window.navigator.language||"en-US").substr(-1),pomodoroSettingsStr:JSON.stringify({autoplay:!0,hideSeconds:!1,focusDuration:25,restDuration:5,sounds:!0,browserNotifications:!1,mode:"timer"}),clockVisible:!0,centerBelowVisible:!0,centerBelowApp:k.Focus,launchpadVisible:!1,linksMode:"list",tabsVisible:!0,tabsDefaultStashSetting:"all",focusModeVisible:!0,focusModeSettingsStr:JSON.stringify({apps:{siteBlocker:{enabled:!0},tabStash:{enabled:!0},soundscapes:{enabled:!0}},blurBackground:!1,linksVisible:!0,searchVisible:!1,focusInsightVisible:!0,metricsVisible:!1,countdownsVisible:!1,worldClocksVisible:!1,mantrasVisible:!0,askAiVisible:!1,notesVisible:!1,todoVisible:!0,calendarVisible:!0,goalMinutes:60,goalDays:[1,2,3,4,5],goalEnabled:!0,pomodoroTimerMode:"timer",insightsGraphTimeframe:S.Last7Days}),siteBlockerVisible:!1,siteBlockerSettingsStr:JSON.stringify({activeDuringPomodoroBreak:!1,unstoppableModeDurationMinutes:60}),focusInsightVisible:!0,dashAppTextLabels:C.Always,calendarVisible:!1,excludedCalendars:"[]",photoInfoShowLocation:void 0},initialize:function(){var e=this;e.fetching=!1,window.addEventListener("storage",(function(t){t.key&&0===t.key.indexOf("momentum-customization-1")&&(e.fetching=!0,e.fetch({success:function(){e.fetching=!1},error:function(){e.fetching=!1},reset:!0,fromStorage:!0}))})),this.on("change:hour12clock",(function(){m.models.date.set("date",m.date())}))},get:function(e){var t=this.constructor.__super__.get.apply(this,arguments);const i=null==t||e.endsWith("Str")&&""===t;if(i){var n=m.conditionalFeatures.featureEnabled("team"),a=m.conditionalFeatures.featureEnabled("plus"),o=Object.prototype.hasOwnProperty.call(this.defaultIfNotSet,e),s=n&&Object.prototype.hasOwnProperty.call(this.defaultForTeamIfNotSet,e),r=a&&Object.prototype.hasOwnProperty.call(this.defaultForPlusIfNotSet,e);if(!o&&!s&&!r)return t;s?t=this.defaultForTeamIfNotSet[e]instanceof Function?this.defaultForTeamIfNotSet[e]():this.defaultForTeamIfNotSet[e]:r&&(t=this.defaultForPlusIfNotSet[e]instanceof Function?this.defaultForPlusIfNotSet[e]():this.defaultForPlusIfNotSet[e]),i&&o&&(t=this.defaultIfNotSet[e]instanceof Function?this.defaultIfNotSet[e]():this.defaultIfNotSet[e])}return t},save:function(){for(var e=!1,t=0;t<arguments.length;t++){var i=arguments[t];i&&i.fromStorage&&(e=!0)}e||Backbone.Model.prototype.save.apply(this,arguments)}});var de="https://api.momentumdash.com/";m.models.MantraManager=m.models.FeedManager.extend({activatingFirstMantra:!1,dateInitialized:null,defaults:{momo:!0,custom:!1},durationGreetingFirstTabOfDay:4e3,frequencyData:{durationGreeting:6e4,durationMantra:3e4,tabFrequency:2},frequencyLevels:[{level:0,label:"Rarely",durationGreeting:18e4,durationMantra:2e4,tabFrequency:8},{level:2,label:"Often",durationGreeting:45e3,durationMantra:3e4,tabFrequency:2},{level:3,label:"Always",durationGreeting:null,durationMantra:null,tabFrequency:null}],frequencyVariation:.25,keyHasSeenGreetingPrefix:"momentum-mantra-has-seen-greeting-",keyTabCountLegacy:"momentum-mantra-tab-count",keyTabCountPrefix:"momentum-mantra-tab-count-",showNameFrequency:.3,stringsThatPrecludeNames:[" I "," ME "," MINE "," MY ",". ",", ","; "],initialize:function(){m.models.FeedManager.prototype.initialize.call(this,m.models.Mantra,"mantra"),this.firstFetch(),this.settings=m.models.mantraSettings=new m.models.MantraSettings({id:1}),this.initializeMantraDailyData(),this.randomizeFrequency(),this.listenTo(this.itemCollection,"reset",this.onItemCollectionReset),this.listenTo(this,"mantra:deleted",this.handleMantraDelete),this.listenTo(m,"readyForWidgets",this.onSuccessfulLogin),this.listenTo(m,"newDay",this.onNewDayMantras),this.listenTo(m.models.mantraSettings,"change:frequency",this.onChangeFrequency),this.listenTo(m.models.customization,"change:mantraVisible",this.onChangeMantraVisible)},onItemCollectionReset:function(){this.trigger("mantra-active-change")},isEnabled:function(){return m.models.customization.getComputedSetting("mantraVisible")},toggleEnabled:function(){m.models.customization.toggle("mantraVisible")},hasSeenGreetingToday:function(){return JSON.parse(localStorage.getItem(this.keyHasSeenGreetingToday))},markGreetingAsSeenToday:function(){localStorage.setItem(this.keyHasSeenGreetingToday,"true")},isInAlternatingMode:function(){return!this.isFrequencyAlways()&&!this.isMantraPinned()},isFrequencyAlways:function(){return this.settings.getFrequency()===this.settings.frequencies.always},isMantraPinned:function(){return!!this.getPinnedMantra()},activeFeedsEmpty:function(){return this.itemCollection.empty()},updateInFeed:function(e){var t=this.itemCollection.findWhere({_id:e.get("_id")||e.get("id")});t&&(t.save({is_favorite:e.get("is_favorite"),body:e.get("body")}),t.get("_id")===this.getActiveItem().get("_id")&&(this.getActiveItem().isPinned()&&this.savePinnedVars(t),this.trigger("mantra-active-edit")))},setActive:function(e){this.unpinMantra();var t=de+"settings/mantra/active",i=e.get("_id")||e.get("id"),n=this;return new Promise((function(a,o){$.ajax({type:"POST",contentType:"application/json",data:JSON.stringify({mantra_id:i}),url:t}).done((function(t){t&&t.success?(n.getActiveItem().set({body:e.get("body"),_id:i,is_custom:e.get("is_custom"),is_favorite:e.get("is_favorite")}),m.trigger("sync:download","mantra"),a(e)):o(e)})).fail((function(){o(e)}))}))},onChangeMantraVisible:function(){if(this.activeFeedsEmpty())return this.trigger("wait-for-mantra"),void this.getActiveItem();if(this.isEnabled())this.randomizeFrequency();else{if(!0===this.mantraDisablingInProgress)return;this.mantraDisablingInProgress=!0,this.unpinMantra(),this.mantraDisablingInProgress=!1,this.trigger("mantra-active-change")}},getDuration:function(e){return"greeting"===e?this.frequencyData.durationGreeting:"mantra"===e?this.frequencyData.durationMantra:void 0},getDurationTotal:function(){return this.frequencyData.durationGreeting+this.frequencyData.durationMantra},checkIfMantraShouldBeShown:function(){return!!localStorage.getItem("mantra:force")||!localStorage.getItem("greeting:force")&&(!(!this.mantrasEnabledAndAvailable()||!this.hasSeenGreetingToday())&&(this.activatingFirstMantra?(this.activatingFirstMantra=!1,!0):!this.isInAlternatingMode()||this.checkMantraTabFrequency()))},shouldShowMantraAfterGreetingFirstTabOfDay:function(){return this.mantrasEnabledAndAvailable()&&!this.hasSeenGreetingToday()&&!this.isInAlternatingMode()},mantrasEnabledAndAvailable:function(){return this.getActiveItem()&&this.isEnabled()},checkMantraTabFrequency:function(){var e=localStorage.getItem(this.keyTabCountToday)>=this.frequencyData.tabFrequency;return e&&this.resetTabCount(),e},onChangeFrequency:function(){this.resetAndRandomize(),this.isMantraPinned()&&this.unpinMantra(!0)},randomizeFrequency:function(){var e=this.lookupFrequencyBaseline();if(this.isFrequencyAlways())this.frequencyData.tabFrequency=e.tabFrequency,this.frequencyData.durationGreeting=e.durationGreeting,this.frequencyData.durationMantra=e.durationMantra;else{var t=1-this.frequencyVariation,i=1+this.frequencyVariation;this.frequencyData.tabFrequency=this.randomizeTabFrequency(e.tabFrequency),this.frequencyData.durationGreeting=m.utils.getRandomIntBetween(t*e.durationGreeting,i*e.durationGreeting),this.frequencyData.durationMantra=m.utils.getRandomIntBetween(t*e.durationMantra,i*e.durationMantra)}},lookupFrequencyBaseline:function(){return _.where(this.frequencyLevels,{level:this.settings.getFrequency()})[0]},randomizeTabFrequency:function(e){var t=e*(1-this.frequencyVariation),i=e*(1+this.frequencyVariation);return i-t<2&&(t=2===e?2:e-1,i=e+1),m.utils.getRandomIntBetween(t,i)},initializeMantraDailyData:function(){m.models.cleanupManager.registerKey(this.keyTabCountLegacy),m.models.cleanupManager.registerKeyPrefix(this.keyTabCountPrefix,{pastDaysToKeep:0}),m.models.cleanupManager.registerKeyPrefix(this.keyHasSeenGreetingPrefix,{pastDaysToKeep:0});var e=m.utils.getDateString();this.dateInitialized=e,this.keyTabCountToday=this.keyTabCountPrefix+e,this.keyHasSeenGreetingToday=this.keyHasSeenGreetingPrefix+e;var t,i=parseInt(localStorage.getItem(this.keyTabCountToday));isNaN(i)?(t=1,localStorage.setItem(this.keyHasSeenGreetingToday,"false")):t=i+1,localStorage.setItem(this.keyTabCountToday,t)},resetTabCount:function(){localStorage.setItem(this.keyTabCountToday,"0")},resetAndRandomize:function(){this.resetTabCount(),this.randomizeFrequency()},onNewDayMantras:function(){this.tabWasLeftOvernight()&&(this.initializeMantraDailyData(),this.trigger("show-greeting"))},tabWasLeftOvernight:function(){return this.dateInitialized!==m.utils.getDateString()},getActiveItem:function(){var e,t=this,i=this.getPinnedMantra();if(i)return(e=this.itemCollection.findWhere({forDate:"pinned"}))&&e.get("_id")===i.id?e:this.itemCollection.create({forDate:"pinned",_id:i.id,body:i.body,is_custom:i.isCustom,is_favorite:i.isFavorite});if(m.collect.mantras&&this.isEnabled()){if(!(e=m.collect.mantras.getActiveItem()))return m.trigger("sync:download","mantra"),null;if(e.get("hardSkip"))return this.noMantra=!0,null;var n=!1;return this.currentMantra&&this.currentMantra.get("_id")===e.get("_id")?this.currentMantra.get("body")!==e.get("body")&&(this.currentMantra=e,n=!0):(this.currentMantra=e,n=!0),n&&setTimeout((function(){m.trigger("mantra:active_changed",t.currentMantra.get("_id"))}),50),e}return null},activateFirstMantra:function(){m.models.customization.save("mantraVisible",!0),this.settings.save({firstMantraActivated:!0}),this.getActiveItem(),this.activatingFirstMantra=!0,this.trigger("wait-for-mantra")},getPinnedMantra:function(){return this.settings?this.settings.get("pinnedMantra"):null},pinMantra:function(e,t){var i=this.getPinnedMantra(),n=e.get("_id")||e.get("id");return i&&n===i.id?(this.unpinMantra(!0),this.resetAndRandomize(),!1):(this.savePinnedVars(e,t),this.trigger("mantra-pin"),!0)},unpinMantra:function(e){this.isMantraPinned()&&this.settings.save({pinnedMantra:null});var t=m.collect.mantras.get("pinned");t&&t.destroy(),e&&this.trigger("mantra-un-pin")},savePinnedVars:function(e,t){var i=this.settings.get("pinnedMantra");i&&(t=t||i.showName),this.settings.save({pinnedMantra:{id:e.get("_id")||e.get("id"),body:e.get("body"),isFavorite:e.get("is_favorite"),isCustom:e.get("is_custom"),showName:t}})},toggleFav:function(e){var t=e.get("id")||e.get("_id");return this.feedContains(t)?this.toggleFavFeedItem(t):this.toggleFavorite(e.get("is_favorite"),e)},toggleFavFeedItem:function(e){var t=this,i=this.itemCollection.where({_id:e}),n=i[0].get("is_favorite"),a=!n,o=this.getPinnedMantra(),s=this.getActiveItem();return i.map((function(e){e.save({is_favorite:a})})),o&&e===o.id&&this.setPinnedProperty("isFavorite",a),s&&e===s.get("_id")&&this.trigger("mantra-active-fav"),new Promise((function(r,l){t.toggleFavorite(a,i[0]).then((function(){r()})).catch((function(){i.map((function(e){e.save({is_favorite:n})})),o&&e===o.id&&t.setPinnedProperty("isFavorite",n),s&&e===s.get("_id")&&t.trigger("mantra-active-fav"),l()}))}))},setPinnedProperty:function(e,t){var i=Object.assign({},this.settings.get("pinnedMantra"));i[e]=t,this.settings.save({pinnedMantra:i})},feedContains:function(e){return!!this.itemCollection.findWhere({_id:e})},handleMantraDelete:function(e){var t=this.getActiveItem();t&&t.get("_id")===e&&(t.isPinned()&&this.unpinMantra(),this.trigger("showGreeting"),m.trigger("sync:download","mantra"))},getMantraForDisplay:function(e,t){return e?(void 0!==this.showName&&t||(this.isMantraPinned()?this.showName=this.getPinnedMantra().showName:this.showName=m.utils.getRandomBoolByFrequency(this.showNameFrequency)),localStorage.getItem("mantra:forceName")&&(this.showName="true"===localStorage.getItem("mantra:forceName")),this.formatMantraForDisplay(e.get("body"),this.showName)):null},formatMantraForDisplay:function(e,t){e=e.trim();var i=m.utils.getEndPunctuationString(e),n=e.slice(0,e.length-i.length),a="";return t&&this.mantraWorksWithName(n)&&m.models.customization.get("displayname")&&(n+=", ",a=m.models.customization.get("displayname"),m.utils.endsWithEndPunctuation(a)&&(i="")),{bodyFormatted:n+a+i,start:n,name:a,end:i}},mantraWorksWithName:function(e){var t,i=!0,n=m.models.customization.get("displayname").toUpperCase();if(!n)return!1;e=e.toUpperCase();for(var a=0;a<this.stringsThatPrecludeNames.length;a++)if(t=this.stringsThatPrecludeNames[a],-1!==e.indexOf(n)||-1!==e.indexOf(t)||e.startsWith(t.trim()+" ")||e.endsWith(" "+t.trim())){i=!1;break}return i},skipItem:function(e){return e&&!m.conditionalFeatures.featureEnabled("plus")&&(this.noMantra=!0),this.isMantraPinned()&&this.unpinMantra(),m.models.FeedManager.prototype.skipItem.apply(this,arguments)}}),m.models.MantraSettings=Backbone.Model.extend({defaults:{pinnedMantra:null,firstMantraActivated:!1,frequency:2},frequencies:{low:0,medium:2,high:2,always:3},initialize:function(){this.listenTo(m.models.customization,"change:mantraSettingsStr",this.customizationChanged),m.models.customization.initialized?this.customizationChanged():this.listenTo(m.models.customization,"initialized",this.customizationChanged)},customizationChanged:function(e,t){if(!t||!t.savingMantraSettings){var i=m.models.customization.get("mantraSettingsStr");i&&i!==this.mantraSettingsStr&&i.length>0&&this.reset()}},getFrequency:function(){var e,t=this.get("frequency");return e="string"==typeof t&&isNaN(1*t)?this.frequencies[t]:"string"!=typeof t||isNaN(1*t)?t:parseInt(t),void 0===_.find(this.frequencies,(function(t){return t===e}))&&(e=this.defaults.frequency),e},reset:function(){this.mantraSettingsStr=m.models.customization.get("mantraSettingsStr");if(this.mantraSettingsStr&&this.mantraSettingsStr.length>0){var e=JSON.parse(this.mantraSettingsStr),t=this;["pinnedMantra","firstMantraActivated","frequency"].forEach((function(i){t.set(i,void 0===e[i]?t.defaults[i]:e[i])}))}},save:function(){Backbone.Model.prototype.set.apply(this,arguments),m.models.customization.initialized&&m.models.customization.save({mantraSettingsStr:JSON.stringify(this.attributes)},{savingMantraSettings:!0})},getFrequencyName:function(){var e=this.getFrequency(),t=this.frequencies;return Object.keys(t).find((function(i){return t[i]===e}))}});var ce="https://api.momentumdash.com/";m.models.Settings=Backbone.Model.extend({defaults:{},initialize:function(){}}),m.models.GenericSettings=Backbone.Model.extend({initialize:function(e){this.feedType=e,this.urlPath="settings/"+e,this.url=ce+this.urlPath;var t=localStorage.getItem("cached-"+this.urlPath);t&&this.set(JSON.parse(t)),this.listenTo(this,"sync",this.saveLocal)},saveLocal:function(){localStorage.setItem("cached-"+this.urlPath,JSON.stringify(this.attributes))},save:function(e,t){(t=t||{}).patch=!0;var i=this,n=t.success;t.success=function(e,t,a){i.saveLocal(),n&&n(e,t,a)},m.isLoggedIn()?Backbone.Model.prototype.save.call(this,e,t):Backbone.Model.prototype.set.call(this,e,t),i.saveLocal()},toggle:function(e){var t={};this.has(e)?t[e]=!this.get(e):t[e]=!0;var i={},n=this;e.indexOf("feed")>=0&&(i.success=function(){m.trigger("sync:download",n.feedType)}),this.save(t,i)}}),m.models.BookmarksSettings=Backbone.Model.extend({defaults:{guided:!1,iconsOnly:!1,openInNewTab:!1,includeBookmarks:!1,includeOtherBookmarks:!1,defaultMostVisited:!1,includeMostVisited:!0,chromeTabLocation:"links"},initialize:function(){this.listenTo(m.models.customization,"change:bookmarksSettingsStr",this.customizationChanged),this.permissions={permissions:["bookmarks","topSites"]},m.utils.isChrome()&&this.permissions.permissions.push("favicon")},customizationChanged:function(){var e=m.models.customization.get("bookmarksSettingsStr");e&&e!=this.bookmarksSettingsStr&&e.length>0&&this.reset()},reset:function(){this.bookmarksSettingsStr=m.models.customization.get("bookmarksSettingsStr");if(this.bookmarksSettingsStr&&this.bookmarksSettingsStr.length>0){var e=JSON.parse(this.bookmarksSettingsStr),t=this;["iconsOnly","openInNewTab","includeBookmarks","includeOtherBookmarks","defaultMostVisited","includeMostVisited","chromeTabLocation","guided"].forEach((function(i){t.set(i,null==e[i]?t.defaults[i]:e[i])})),localStorage.setItem("bookmarksEnabled",m.models.customization.get("bookmarksVisible"))}},optionsChanged:function(e,t){var i=m.models.customization;i.save({bookmarksSettingsStr:JSON.stringify(this.attributes)}),e&&i.save(e,t)}});function me(e,t){(t=t||{}).source&&t.url&&(t.url+="&utm_campaign="+encodeURIComponent(t.source));var i=localStorage.getItem("offered-plan");t.url&&i&&m.conditionalFeatures.featureEnabled("notes-degraded")&&(t.url+="&resubscribe="+i)}m.models.ComputedSettings=Backbone.Model.extend({layers:[],initializeSettings:function(){var t=this;this.persistentSettings=new m.models.PersistentSettings({id:1}),this.listenTo(this.persistentSettings,"change",this.computeProperties),this.listenTo(this.persistentSettings,"sync",(async function(){t.initialized||(t.initialized=!0,t.updateSearchSettings(),t.layers=await Promise.all([T(),M(),new I("focusMode",(()=>A.currentValue),(()=>{var e;const t=x().focusModeSettings;return{notesVisible:t.notesVisible,todoVisible:t.todoVisible,quoteVisible:!1,siteBlockerVisible:(null==(e=t.apps.siteBlocker)?void 0:e.enabled)??!0,soundscapesVisible:t.apps.soundscapes.enabled,tabsVisible:t.apps.tabStash.enabled,searchVisible:!1,launchpadVisible:!1,focusModeVisible:!0,askAiVisible:t.askAiVisible,linksVisible:t.linksVisible,metricVisible:t.metricsVisible,countdownVisible:t.countdownsVisible,multiClockVisible:t.worldClocksVisible,focusInsightVisible:t.focusInsightVisible,weatherVisible:!1,calendarVisible:t.calendarVisible,dashAppTextLabels:C.Hover}})),new I("siteBlockerUnstoppableMode",(()=>F()),(()=>({siteBlockerVisible:!0})))]),t.layers.push({id:"visibilityOverride",overrides:m.reactive.visibilityOverride}),t.computeProperties(),t.trigger("initialized"),e.$emit("customization:initialized"))})),m.conditionalFeatures=new m.models.ConditionalFeatures({},{customization:this}),m.models.bookmarksSettings=new m.models.BookmarksSettings({id:1}),this.persistentSettings.fetch({error:function(e,t){"Record Not Found"===t&&e.save()}})},updateSearchSettings:function(){if(!m.isLoggedIn()){var e=localStorage.getItem("client_uuid");if(e&&0!==e.length&&("0"===(e=e.toLowerCase())[0]||"1"===e[0])){if(this.persistentSettings.get("searchUpdated"))return;var t={searchUpdated:!0,searchVisible:null},i=this.persistentSettings.get("searchProvider");"google"!==i&&"bing"!==i&&(t.searchProvider=null),this.persistentSettings.save(t)}}},getNewAttributesOverrides:function(){return this.layers.reduce(((e,t)=>(Object.entries(t.overrides).forEach((([i,n])=>{e.attributes[i]=n,e.overrides[i]=t.id})),e)),{attributes:{},overrides:{}})},computeProperties:function(t,i,n){const a=this.getNewAttributesOverrides(),o={...this.attributes,...a.attributes},s=Object.keys(o).reduce(((e,t)=>((this.attributes[t]!==a.attributes[t]||this.overrides[t]!==a.overrides[t])&&e.push(t),e)),Object.keys(this.persistentSettings.changedAttributes()||{}));this.attributes=a.attributes,this.overrides=a.overrides,this.trigger("change",t,i,n,s),s.forEach((e=>{this.trigger("visibilityOverride:"+e),this.trigger("change:"+e)})),e.$emit("customization:update",s)},get:function(e){return this.persistentSettings.get(e)},getPersistentSettings:function(){return this.persistentSettings},getComputedSetting:function(e){var t=Backbone.Model.prototype.get.call(this,e);return void 0!==t?t:this.persistentSettings.get(e)},set:function(){arguments[0].id?Backbone.Model.prototype.set.apply(this,arguments):this.persistentSettings.set.apply(this.persistentSettings,arguments)},save:function(){this.persistentSettings.save.apply(this.persistentSettings,arguments)},clear:function(){this.persistentSettings.clear.apply(this.persistentSettings,arguments)},fetch:function(){this.persistentSettings.fetch.apply(this.persistentSettings,arguments)},toggle:function(e){if(e){var t=!this.get(e),i={};i[e]=t,this.save(i)}}}),m.collect.Mantras=Backbone.Collection.extend({loadedOnce:!1,initialize:function(){this.model=m.models.Mantra,this.collectionName="momentum-mantra",this.localStorage=new Backbone.LocalStorage(this.collectionName),this.listenToOnce(this,"reset",this.onReset)},getActiveItem:function(){if(this.length>0){var e=m.utils.getDateString();return this.get(e)}},onReset:function(){this.loadedOnce=!0},empty:function(){return 0===this.models.length}}),m.collect.Settings=Backbone.Collection.extend({saveOptions:{patch:!0},initialize:function(){this.model=m.models.Settings}}),m.commands.UpsellMessage=m.models.Command.extend({defaults:{id:"upsell.message"},execute:function(e){return m.widgetManager.getWidget(e.targetRegion).showUpsell(e)}}),m.commands.UpsellWebsite=m.models.Command.extend({defaults:{id:"upsell.website"},execute:function(e,t){t||(t=e&&e.source?e:{}),t.url="https://momentumdash.com/plus?utm_source=extension&utm_medium=organic",me(0,t),c(t.url)}}),m.commands.UpsellModal=m.models.Command.extend({defaults:{id:"upsell.modal"},execute:function(e,t){me(0,t),O()}}),m.commands.UpsellUpgrade=m.models.Command.extend({defaults:{id:"upsell.upgrade"},execute:function(e){const t=(null==e?void 0:e.location)??null;e&&"location"in e&&delete e.location,m.commandManager.execute("upsell.modal",null,e),m.Analytics.capture("upsell click",{feature:"settings",location:t})}}),m.models.Mantra=Backbone.Model.extend({idAttribute:"forDate",defaults:function(){return{body:"New Mantra",type:"mantra",is_favorite:!1}},save:function(e,t){(t=t||{}).update=!0,Backbone.Model.prototype.save.call(this,e,t)},isPinned:function(){var e=m.models.mantraManager.getPinnedMantra();return!!e&&this.get("_id")===e.id}});var ue="https://api.momentumdash.com/";m.commands.AuthConnect=m.models.Command.extend({defaults:{id:"auth.connect"},execute:function(e){m.commandManager.execute("auth.connect.provider",e.actionParameter,(function(){m.trigger("todoListManager:fetch")}))}}),m.commands.AuthConnectProvider=m.models.Command.extend({defaults:{id:"auth.connect.provider"},execute:function(e,t,i){if(e&&e.status&&"authRequired"===e.status&&e.authorizationUrl){var n=e.winWidth?e.winWidth:600,a=e.winHeight?e.winHeight:510,o=e.windowFeatures?e.windowFeatures:"titlebar,resizable,status",s=window.screen.width/2-n/2,r=window.screen.height/2-a/2,l=window.open(e.authorizationUrl,"MomentumAuthWindow",o+",left="+s+",top="+r+",width="+n+",height="+a),d=function(){l.closed||setTimeout((function(){l.closed||l.close()}),1e3),t&&t()},c=e.authorizationUrl.split("/"),m="";c.length>1&&(m=c[c.length-1]);var u=ue+"user/auth/status/"+m,g=0,h=1e3,f=function(){l.closed?d():++g>100||(g%30&&(h+=1e3),$.ajax({type:"GET",contentType:"application/json",url:u}).done((function(e){e&&e.token_obtained?d():setTimeout((function(){f()}),h)})).fail((function(){setTimeout((function(){f()}),h)})))};f()}else i&&i()}}),m.commands.ToggleAutoFocus=m.models.Command.extend({defaults:{id:"todo.toggle.autofocus"},execute:function(e,t){if(m.conditionalFeatures.featureEnabled("pinfocus")){m.Analytics.capture(m.models.customization.get("autoFocus")?"autofocus disable":"autofocus enable",{feature:"focus",location:t.sourceApp.toLowerCase(),is_paid_event:!0});const e=!m.models.customization.get("autoFocus"),i={autoFocus:e};if(!A.currentValue&&"true"!==localStorage.getItem("pomodoro-showing")&&e){const e=m.models.customization.get("centerBelowVisible"),t=m.models.customization.get("centerBelowApp");e||(i.centerBelowVisible=!0),t!==k.Focus&&(i.centerBelowApp=k.Focus)}return m.models.customization.save(i),!1}L(P.AUTOFOCUS,(null==t?void 0:t.eventSource)||"")}}),m.commands.CleanLocalStorage=m.models.Command.extend({defaults:{id:"clean.localstorage"},initialize:function(){this.twoDaysAgo=m.now()-1728e5},execute:function(){var e=this;if(!(localStorage.getItem("last_cleanup")>this.twoDaysAgo))var t=setTimeout((function(){try{if(!m||!m.collect||!m.collect.backgrounds)return;clearTimeout(t);for(var i=[],n=!1,a=null,o=0;o<localStorage.length;o++)n=!1,"archived-"==(a=localStorage.key(o)).substring(0,9)&&(n=!0),"fallback-"==a.substring(0,9)&&(n=!0),"image_displayed-"==a.substring(0,16)&&(n=!0),"weather-loc-"==a.substring(0,12)?n=!0:"ddl-bg-"==a.substring(0,7)?localStorage.getItem(a)<e.twoDaysAgo&&(n=!0):"ddl-qt-"==a.substring(0,7)&&localStorage.getItem(a)<e.twoDaysAgo&&(n=!0),n&&i.push(a);for(o=0;o<i.length;o++)localStorage.removeItem(i[o]);m.commandManager.execute("clean.localstorage.addin"),localStorage.setItem("last_cleanup",m.now())}catch(s){console.error(s)}}),500)},collectionCleaner:function(e,t){var i=this;if(e){t=t||"forDate";var n=[];e.each((function(e){var a=e.get(t);Date.parse(a)<i.twoDaysAgo&&n.push(a)}));for(var a=0;a<n.length;a++){e.get(n[a]).destroy()}return n.length}return 0}}),m.commands.CleanupUserData=m.models.Command.extend({defaults:{id:"user.cleanup"},execute:function(e,t){e&&e.type&&("notifications"==e.type?this.cleanNotifications():"all"==e.type&&(this.cleanUserData(),this.managerCleanup(m),this.managerCleanup(m.models))),t&&t()},managerCleanup:function(e){var t=Object.keys(e);for(var i in t){var n=t[i];if(Object.prototype.hasOwnProperty.call(m,n)){var a=m[n];(a instanceof m.models.Manager||a instanceof m.collect.Manager)&&a.cleanup&&a.cleanup()}}},cleanNotifications:function(){for(var e=[],t=!1,i=null,n=0;n<localStorage.length;n++)t=!1,((i=localStorage.key(n)).startsWith("momentum-messages")||"ts_notifications"==i)&&(t=!0),t&&e.push(i);for(n=0;n<e.length;n++)localStorage.removeItem(e[n])},cleanUserData:function(){for(var e=[],t=!1,i=null,n=0;n<localStorage.length;n++)t=!1,("notes"==(i=localStorage.key(n))||i.endsWith("-loaded-once")||i.startsWith("teamFocus")||i.startsWith("team-info")||i.startsWith("cached-steam")||i.startsWith("no-background")||i.startsWith("no-quote")||i.startsWith("no-mantra")||i.startsWith("quicklinks")||i.startsWith("teamlinks")||i.startsWith("todo")||i.startsWith("focus")||i.startsWith("countdown")||i.startsWith("clock")||i.startsWith("metrics")||i.startsWith("momentum-messages")||i.startsWith("momentum-mantra")||i.startsWith("momentum-quote")||i.startsWith("momentum-background")||i.startsWith("momentum-pinned")||i.startsWith("ddl-")||i.startsWith("cached-settings")||i.startsWith("activeTodo")||i.startsWith("cached-team")||i.startsWith("listCache")||"notes-"==i.substring(0,6)||"cachedTodoProviders"==i||"cachedFocus"==i||"f3t6b23d"==i||"current-countdown"==i||"loginParams"==i||"pendingLoginState"==i||"clocks"==i||"clocks-"==i.substring(0,7)||"activeTodoProvider"==i||"activeTodoListId-"==i.substring(0,17)||"font-"==i.substring(0,5)||"listCache-"==i.substring(0,10)||"projectCache-"==i.substring(0,13)||"tsCachedTodoProviders"==i||"ts_notifications"==i||"todos-updated"==i||i.includes("activeTodo")||"showTodoList"===i)&&(t=!0),t&&e.push(i);var a=JSON.parse(localStorage.getItem("momentum-customization-1"));delete a.etag,localStorage.setItem("momentum-customization-1",JSON.stringify(a));for(n=0;n<e.length;n++)localStorage.removeItem(e[n])}}),m.commands.LoadAddins=m.models.Command.extend({defaults:{id:"addins.load"},execute:function(e){if(e){if(!this.addInsLoaded){this.addInsLoaded=!0;for(var t=0;t<e.length;t++){var i=e[t];i&&m.addinManager.loadAddin(i)}}m.trigger("processAddIns")}}}),m.commands.AccountLogin=m.models.Command.extend({defaults:{id:"account.login"},execute:function(){m.isLoggedIn()?m.commandManager.execute("notification.show.enhanced",{message:"You are already logged in.",display_time:5e3,viewLimit:1,priority:2}):(m.commandManager.execute("user.cleanup",{type:"notifications"}),localStorage.doLoginOnNextLoad=!0,window.location.reload())}});var ge="https://api.momentumdash.com/";m.commands.Logout=m.models.Command.extend({defaults:{id:"logout"},execute:function(t){var i={token:localStorage.token,token_uuid:localStorage.token_uuid};function n(){m.user.uuid=null,t&&t.keepData?(localStorage.removeItem("token"),localStorage.removeItem("token_uuid"),localStorage.removeItem("userId"),localStorage.removeItem("user_uuid"),m.conditionalFeatures.clearFeatures(),function(e){localStorage.setItem("loggedOut",m.now());var t=e||"You have been logged out.";m.commandManager.execute("notification.show.enhanced",{message:t,display_time:5e3,viewLimit:1,priority:2},(function(){window.location.reload()}),!0)}(t&&t.token_invalid_reason)):m.utils.clearStorage().finally((function(){e.sendCrossTabMessage("reload"),window.location.reload()}))}$.ajax({type:"POST",contentType:"application/json",data:JSON.stringify(i),url:ge+"user/logout"}).always((function(){m.utils.isSafari()&&window.browser&&window.browser.runtime?browser.runtime.sendNativeMessage("com.momentumdash.momentum.safari",{eventName:"removeUserTokenInfo"}).then((function(){n()})):n()}))}}),m.commands.openModal=m.models.Command.extend({defaults:{id:"modal.open"},execute:function(e,t){void 0===t&&(t={});var i=t.subStepIndex,n=t.force,a=t.addExperimentDefinitions;function o(){const o={...m.modals.definitions,...a?m.modals.getAllocatedDefinitions():{}};var s="object"==typeof e?e:e in D?o[m.modals.stepsEnum[e]]:o[e];s?(Object.assign(s,t),"componentProps"in s||(s.componentProps={}),Object.assign(s.componentProps,t),(s.id.startsWith("upsell")||["plusGate","permissionRequest","upgrade","freeTrial","freeTrialCard"].includes(s.id))&&(n=!0,m.modal.hidden=!1),m.trigger("modal:show",s,{subStepIndex:i,force:n})):console.warn("No step: "+e+" found in onboarding definitions")}delete t.subStepIndex,delete t.force,delete t.addExperimentDefinitions,m.modals?o():m.on("modalContainer:created",o)}}),m.commands.openModalFromNotification=m.models.Command.extend({defaults:{id:"modal.openFromNotification"},execute:function(e){void 0===e&&(e={}),void 0===e.options&&(e.options={}),e.options.force=!0,m.cmd("modal.open",e.step,e.options)}}),m.commands.SyncEnable=m.models.Command.extend({defaults:{id:"sync.enable"},execute:function(){m.conditionalFeatures.featureEnabled("serverfocus")||m.conditionalFeatures.featureEnabled("servertodos")||m.conditionalFeatures.featureEnabled("serverlinks")||m.isLoggedIn()&&m.syncCoordinator.submitFeatureAccessRequest("sync-early-access",(function(){window.location.reload()}),(function(){m.commandManager.execute("notification.show.enhanced",{message:"Unable to enable account sync. Reload the tab and try again, or check our help site.",viewLimit:1,priority:2})}))}});var he="https://api.momentumdash.com/";m.commands.ThirdPartyAuthConnect=m.models.Command.extend({defaults:{id:"auth.thirdparty"},execute:function(e,t){this.initiateThirdPartyLogin(e,t)},initiateThirdPartyLogin:function(e,t){var i,n=m.utils.getPlatformName(),a="chrome-extension";"Chrome"===n&&(i=chrome.runtime.getURL("/login.html")),"Firefox"===n&&(a="firefox-extension",i=browser.runtime.getURL("/login.html")),this.loading||(this.loading=!0,$.ajax({type:"POST",contentType:"application/json",data:JSON.stringify({email:e,medium:a,mediumURL:i}),url:he+"login/sso"}).done((function(e){if(e){if(localStorage.setItem("pendingLoginState",JSON.stringify(e)),e.redirectUrl)return void(window.location.href=e.redirectUrl)}else t&&t()})).fail((function(){t&&t()})))}});var fe="https://api.momentumdash.com/",pe="https://account.momentumdash.com/";function ve(e){if(!e)return null;var t=null;return"string"==typeof e?t=e:"object"==typeof e&&e.path&&(t=e.path),t?(t.startsWith("/")&&(t=t.substring(1)),t):null}m.commands.WindowNavigate=m.models.Command.extend({defaults:{id:"window.navigate"},execute:function(e){if(e){var t=null;e.url&&(t=e.url),t&&(window.location.href=t)}}}),m.commands.WindowOpen=m.models.Command.extend({defaults:{id:"window.open"},execute:function(e,t){if(e){var i=null;t&&"object"==typeof t&&"urlField"in t?i=e.get(t.urlField):e.url&&(i=e.url),i&&c(i)}}}),m.commands.WindowAccountOpen=m.models.Command.extend({defaults:{id:"window.account.open"},execute:function(e){var t=ve(e);null!=t&&c(pe+t)}}),m.commands.WindowAccountOpenLogin=m.models.Command.extend({defaults:{id:"window.account.open.login"},execute:function(e){var t=ve(e);if(null!=t){var i=m.utils.getUserUuid(),n="Safari"===m.utils.getPlatformName()?c("loading.html"):null;if(!i)return a();m.miscDb.get("authState").then((function(o){if(o&&o.account===i)return a();var s=localStorage.getItem("unregistered");$.ajax({type:"POST",beforeSend:m.helpers.auth.setMomentumAuthHeader,data:JSON.stringify({medium:"account"}),url:fe+"login/onetime"}).done((function(e){var a;a=e&&e.otp?pe+(s?"onetime?uuid="+i:"onetime?email="+encodeURIComponent(e.email))+"&otp="+encodeURIComponent(e.otp)+"&auto=true&redirect="+t:pe,n?n.location=a:c(a)})).fail((function(){a()})).always(e&&e.callback)}))}function a(){c(pe+t)}}});var ye="https://api.momentumdash.com/",be="2.25.1",we=0;m.models.Date=Backbone.Model.extend({defaults:function(){var e=m.date();return{date:e,seconds:e,hour:e}},initialize:function(){this.listenTo(this,"change:date",this.updateTime,this),this.listenTo(m,"globalEvent:pageShown",this.onPageShown)},setDateUpdateTimer:function(){var e=this,t=6e4,i=m.date();t=t-1e3*i.getSeconds()-i.getMilliseconds(),setTimeout((function(){e.set("date",m.date()),e.setDateUpdateTimer()}),t)},setHourUpdateTimer:function(){var e=this,t=36e5,i=m.date();t=t-60*i.getMinutes()*1e3-1e3*i.getSeconds()-i.getMilliseconds(),setTimeout((function(){e.set("hour",m.date()),e.setHourUpdateTimer()}),t)},setSecondsUpdateTimer:function(){const e=()=>{const t=Date.now(),i=1e3*Math.floor(t/1e3);this.set("seconds",new Date(i));setTimeout(e,i-t+1e3)};e()},getTimeString:function(e){var t=m.models.customization.get("hour12clock"),i=(e=e||this.get("date")).getHours(),n=e.getMinutes();return 1==t&&(i=(i+11)%12+1),i<10&&!t&&(i="0"+i),n<10&&(n="0"+n),i+":"+n},getTimePeriod:function(){return this.get("date").getHours()>=12?"PM":"AM"},updateTime:function(){var e=this.getTimeString();this.get("time")!==e&&this.set("time",e)},onPageShown:function(){var e=this.get("time"),t=this.getTimeString(new Date);void 0!==e&&e!==t&&this.set("date",m.date())}}),m.views.Dashboard=Backbone.View.extend({initialize:function(){var e;this.$loading=$('<span class="message-fill"><i class="loading-icon"></i> Loading...</span>'),m.console.log(m.elapsed()+": Dashboard Init"),m.models.themeManager=new m.models.ThemeManager,m.models.customization.fetch({error:function(){m.models.customization.save(),m.models.themeManager.initializeThemes()},success:function(){m.models.themeManager.initializeThemes()}}),this.listenTo(m,"processAddIns",this.processAddIns),m.models.backgroundManager=new m.models.BackgroundManager,m.conditionalFeatures.featureEnabled("team")&&$("body").addClass("has-team"),m.models.backgroundManager.firstFetch(),m.models.notificationManager=new m.models.NotificationManager,m.models.date&&(m.models.date.setDateUpdateTimer(),m.models.date.setSecondsUpdateTimer(),m.models.date.setHourUpdateTimer()),this.trackPageVisibility(),this.newDayIntervalId=setInterval((function(){if(window.Cypress&&document.body.setAttribute("data-test-new-day-interval-check-has-run",""),localStorage.activeDate){if(localStorage.activeDate!==m.utils.getDateString()){var e=9e3*Math.random()+1e3;setTimeout((function(){localStorage.activeDate!==m.utils.getDateString()&&(localStorage.activeDate=m.utils.getDateString(),m.trigger("newDay"))}),e)}}else localStorage.activeDate=m.utils.getDateString()}),1e4);var t=this.getOneTimeLoginParams();t.otpUuid&&t.otp?(m.widgetManager.loadWidget("modal"),m.widgetManager.showDashboard(),l.oneTimeLoginActive=!0,m.cmd("modal.open",D.ONE_TIME_LOGIN,{componentProps:{otlParams:t}})):"convertUnregistered"===t.ssoOutcome?(i.resolveDeferral(),this.loadWidgets()):m.utils.shouldShowIntroduction()?w().then((e=>{m.widgetManager.loadWidget("modal"),m.widgetManager.showDashboard(),l.introductionActive=!0,e?m.cmd("modal.open",D.SETUP_UNREGISTERED_DASHBOARD):"email"===localStorage.getItem("doLoginOnNextLoad")?m.cmd("modal.open",D.LOGIN,{subStepIndex:B.EMAIL}):localStorage.getItem("doLoginOnNextLoad")?m.cmd("modal.open",D.LOGIN,{subStepIndex:B.PROVIDER}):m.cmd("modal.open",D.LOGIN)})):m.utils.userIsLegacyUnregistered()||localStorage.getItem(m.constants.LEGACY_USER_MIGRATION_KEYS.TIME)?m.legacyUserMigration.migrateIfEligible().then(this.loadWidgets.bind(this)):this.loadWidgets(),m.versionDeprecationWarningCheck(),(()=>{const e=localStorage.getObject("momentum-customization-1");if(e){const t=[...e.migrations||[]],i={};t.includes("calendarUpdate")||(t.push("calendarUpdate"),!1!==e.focusVisible||!1!==e.centerBelowNavVisible&&"centerBelowNavVisible"in e?e.focusVisible?Object.assign(i,{centerBelowVisible:!0,centerBelowApp:k.Focus}):e.searchVisible&&e.centerBelowNavVisible&&Object.assign(i,{centerBelowVisible:!0,centerBelowApp:k.Search,searchVisible:!1}):Object.assign(i,{centerBelowVisible:!1})),Object.assign(i,{migrations:t}),m.once("appsReady",(()=>{g((async()=>{const{setMultiple:e}=await import("./reactiveCustomization-B8WwDagp.js");return{setMultiple:e}}),__vite__mapDeps([40,14,15,8,9,13])).then((({setMultiple:e})=>{e(i)}))}))}})();const n=(null==(e=u[we])?void 0:e.class)||"";var a=$("body"),o=m.utils.getPlatformName().toLowerCase(),s=m.utils.getRenderingEngine().toLowerCase();a.addClass(`engine--${s} platform--${o} ${n}`),m.utils.isTouchDevice()&&a.addClass("touch"),this.initializeCompleted=!0},loadWidgets:function(){l.readyForWidgets=!0,m.trigger("readyForWidgets")},trackPageVisibility:function(){var e,t;void 0!==document.hidden?(e="hidden",t="visibilitychange"):void 0!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),void 0!==e&&this.addEventHandler(document,t,(function(){m.trigger(document[e]?"globalEvent:pageHidden":"globalEvent:pageShown")}))},addEventHandler:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},processAddIns:function(){var e=this;e.processAddInsIntervalId=setInterval((function(){e.initializeCompleted&&(clearInterval(e.processAddInsIntervalId),m.addinManager.processPending())}),50)},getViewById:function(e){var t=null;return _.each(m.widgets,(function(i){i.el.id===e&&(t=i)})),t},removeView:function(e){_.each(m.widgets,(function(t){t.el.id===e&&t.$el.mFadeOut(500,!1,(function(){t.remove(),m.widgets.splice(m.widgets.indexOf(t),1)}))}))},removeAllViews:function(e){_.each(m.widgets,(function(e){e&&e.$el.mFadeOut(500,!1,(function(){e.remove()}))})),m.widgets=[],_.delay(e,475)},getOneTimeLoginParams:function(){return m.utils.getAndRemoveParamsFromUrl("otp","otpUuid","email","legacy","ssoOutcome")}});var ke=function(){if(setTimeout((function(){try{var e="";for(o=0;o<100;o++)e+="aaaaaaaaaa";localStorage.setItem("capacityTest",e),localStorage.removeItem("capacityTest")}catch(s){try{localStorage.removeItem("capacityTest");for(var t=m.now()-1728e5,i=[],n=!1,a=null,o=0;o<localStorage.length;o++)n=!1,"no-mantra"==(a=localStorage.key(o)).substring(0,9)&&(n=!0),"no-quote"==a.substring(0,8)&&(n=!0),"no-background"==a.substring(0,13)&&(n=!0),"last_cleanup"==a.substring(0,12)&&(n=!0),"archived-"==a.substring(0,9)&&(n=!0),"fallback-"==a.substring(0,9)&&(n=!0),"listCache-"==a.substring(0,10)&&(n=!0),"font-"==a.substring(0,5)&&(n=!0),"image_displayed-"==a.substring(0,16)&&(n=!0),"weather"==a.substring(0,7)&&(n=!0),"bookmarks"==a.substring(0,9)?n=!0:"ddl-bg-"==a.substring(0,7)?localStorage.getItem(a)<t&&(n=!0):"ddl-qt-"==a.substring(0,7)&&localStorage.getItem(a)<t&&(n=!0),n&&i.push(a);for(o=0;o<i.length;o++)localStorage.removeItem(i[o])}catch(r){console.error(r)}}}),3e3),m.isLoggedIn()){if(!m.utils.getUserUuid()){var e=localStorage.getItem("token"),t=m.utils.parseJwt(e);if(t){var i=t.user_uuid||t.user_guid;i&&(localStorage.setItem("user_uuid",i.toLowerCase()),m.user.uuid=i)}}localStorage.removeItem("pendingLoginState")}m.models.date=new m.models.Date,m.models.customization=new m.models.ComputedSettings({id:1}),m.listenToOnce(m.models.customization,"initialized",m.onSettingsInitialized),m.console.log(m.elapsed()+": Settings requested"),m.models.teamInfo=new m.models.TeamInfo,m.models.customization.initializeSettings(),E()};try{window.chrome&&window.chrome.extension&&window.chrome.extension.inIncognitoContext&&!m.utils.isSafari()?$("body").html(""):m.utils.domReady(ke)}catch(Me){m.utils.domReady(ke)}function Se(){null===localStorage.getItem("analytics:batchEventNames")&&m.Analytics.capture("tab load",{count:0}),m.Analytics.sendBatchEventsIfNeeded(),m.Analytics.batchCapture("tab load")}function Ce(){document.getElementById("introduction")||document.body.classList.remove("hide-overlay")}function Ie(){m.listenersRegistered||(e.addCrossTabMessageListener("reload",(function(){location.reload()})),window.addEventListener("storage",(function(e){if("activeDate"==e.key&&e.oldValue!=e.newValue){var t=9e3*Math.random()+1e3;setTimeout((function(){m.trigger("newDay")}),t)}})),$(window).on("resize",(function(){m.trigger("globalEvent:window:resize"),e.$emit("globalEvent:window:resize")})),window.onblur=function(){m.trigger("globalEvent:windowBlur")},$(document).on("click",(function(e){m.trigger("globalEvent:click",e)})),$(document).on("keyup",(function(e){m.trigger("globalEvent:keyup"),m.tourActive||m.reactive.dashboardOverlayActive||(27==e.keyCode&&m.trigger("globalEvent:esc",e),"Alt"==e.key&&m.trigger("globalEvent:altUp",e))})),$(document).on("keydown",(function(e){if(m.trigger("globalEvent:keydown"),!m.tourActive&&!m.reactive.dashboardOverlayActive){if(9===e.keyCode&&(m.trigger("globalEvent:key:tab"),"BODY"===document.activeElement.tagName)){e.preventDefault();var t=$("#search-input");if(t.length)t.trigger("focus");else{var i=$("#focuses").find("input");i.length?i.trigger("focus"):$("a").filter(":visible").first().trigger("focus")}}if(8==e.keyCode&&e.shiftKey&&e.metaKey&&m.trigger("globalEvent:metaBackspace",e),13==e.keyCode&&e.metaKey&&m.trigger("globalEvent:metaEnter",e),78==e.keyCode&&e.ctrlKey&&m.trigger("globalEvent:ctrlN",e),70==e.keyCode&&e.altKey&&m.trigger("globalEvent:altF",e),76==e.keyCode&&e.altKey&&m.trigger("globalEvent:altL",e),e.altKey&&38==e.keyCode&&m.trigger("globalEvent:altArrowUp",e),e.altKey&&40==e.keyCode&&m.trigger("globalEvent:altArrowDown",e),!e.metaKey||e.shiftKey||e.ctrlKey||e.altKey||("["===e.key&&m.trigger("globalEvent:metaBracketLeft",e),"]"===e.key&&m.trigger("globalEvent:metaBracketRight",e),"/"===e.key&&m.trigger("globalEvent:metaForwardSlash",e),"\\"===e.key&&m.trigger("globalEvent:metaBackSlash",e),"k"===e.key&&m.trigger("globalEvent:metaK",e)),"n"===e.key&&e.metaKey&&e.ctrlKey&&m.trigger("globalEvent:metaCtrlN",e),["`","~"].includes(e.key)&&e.ctrlKey&&e.shiftKey&&m.trigger("globalEvent:ctrlShiftBacktick",e),!e.ctrlKey&&!e.metaKey&&!(e.altKey&&78!=e.keyCode||m.utils.isInputOrTextAreaActive())){var n;if(76==e.keyCode)m.trigger("globalEvent:key:L",e);else if(70==e.keyCode)n="Focus";else if(84==e.keyCode)m.trigger("globalEvent:key:T",e);else if(83==e.keyCode)m.trigger("globalEvent:key:S",e);else if(188==e.keyCode){if(e.metaKey)return;m.trigger("globalEvent:key:,",e)}else{if(67==e.keyCode&&m.utils.isChromium()&&!l.introductionActive&&!l.oneTimeLoginActive)return void m.utils.getBrowser().tabs.update({url:m.utils.getChromeNewTabPageUrl()});if(8==e.keyCode)m.trigger("globalEvent:key:backspace",e);else if(13==e.keyCode)m.trigger("globalEvent:key:enter",e);else if(32==e.keyCode)m.trigger("globalEvent:spacebar",e);else if(38==e.keyCode)m.trigger("globalEvent:arrowUp",e);else if(40==e.keyCode)m.trigger("globalEvent:arrowDown",e);else if(37==e.keyCode)m.trigger("globalEvent:arrowLeft",e);else if(39==e.keyCode)m.trigger("globalEvent:arrowRight",e);else if(65==e.keyCode)m.trigger("globalEvent:key:A",e);else if(71==e.keyCode)m.trigger("globalEvent:key:G",e);else if(73==e.keyCode)m.trigger("globalEvent:key:I",e);else if(78==e.keyCode&&e.shiftKey)m.trigger("globalEvent:key:shiftN",e);else if(78!=e.keyCode||e.shiftKey)if(80==e.keyCode)m.trigger("globalEvent:key:P",e);else if(86==e.keyCode)m.trigger("globalEvent:key:V",e);else if(87==e.keyCode)m.trigger("globalEvent:key:W",e);else if(66==e.keyCode){if(m.utils.bookmarksNotSupported())return;if(void 0===m.utils.getBrowser().bookmarks||void 0===m.utils.getBrowser().topSites)return;m.widgetManager.loadWidget("bookmarks");var a=!m.models.customization.get("bookmarksVisible");m.models.customization.save("bookmarksVisible",a),m.Analytics.capture("feature "+(a?"enable":"disable"),{feature:"bookmarks",location:"hotkey"})}else e.shiftKey&&191==e.keyCode?m.commandManager.execute("settings.toggle",null,{section:"help"}):"/"===e.key&&m.trigger("globalEvent:key:/",e);else m.trigger("globalEvent:key:N",e)}n&&(m.trigger("globalEvent:toggle"+n.replace(/\s+/g,"")),e.preventDefault())}}})),m.utils.isSafari()&&$("a").on("click",(function(){safari.self.tab.dispatchMessage("sendClick",{link:this.href,time:(new Date).getTime()})})),m.listenTo(m,"user:successfulLogout",(function(){m.appView.removeAllViews((function(){m.appView=new m.views.Dashboard}))})),m.listenersRegistered=!0)}function Te(){if(!m.customBackgroundListenersRegistered){var t=$("body");!m.utils.isTouchDevice()&&m.conditionalFeatures.featureEnabled("custom-bg")&&(m.appView.addEventHandler(document.body,"dragover",(function(e){e.stopPropagation(),e.preventDefault(),_.contains(e.dataTransfer.types,"Files")?e.dataTransfer.dropEffect="copy":e.dataTransfer.dropEffect="none"})),window.addEventListener("dragenter",(function(e){var i;const n=null==(i=m.modal.activeStep)?void 0:i.id;_.contains(e.dataTransfer.types,"Files")&&![D.SURVEY_BUG_REPORT].includes(n)&&(m.appView.lastTarget=e.target,t.addClass("blur show-drop"))})),window.addEventListener("dragleave",(function(e){e.preventDefault(),e.target!==document&&e.target!==m.appView.lastTarget||t.removeClass("blur show-drop")}),!1),window.addEventListener("dragover",(function(e){e.preventDefault()})),m.appView.addEventHandler(document.body,"drop",(function(i){if(i&&i.dataTransfer.files.length&&Array.prototype.some.call(i.dataTransfer.files,(function(e){return e&&e.name.match(/\.(gif|jpg|jpeg|tiff|png)$/i)}))){if(i.stopPropagation(),i.preventDefault(),t.removeClass("blur show-drop"),!_.contains(i.dataTransfer.types,"Files"))return;if(!m.conditionalFeatures.featureEnabled("custom-bg"))return void L(P.PHOTOS,"dash");var n=i.dataTransfer.files;n&&n.length>0&&(m.commandManager.getCommand("settings.background.custom.uploadfiles")?(e.$emit("settings:open",N.Photos),m.commandManager.execute("settings.background.custom.uploadfiles",n)):(m.once("settings:background:ready",(()=>{m.commandManager.execute("settings.background.custom.uploadfiles",n)})),e.$emit("settings:open",N.Photos)))}else t.removeClass("blur show-drop")})),m.customBackgroundListenersRegistered=!0)}}m.onSettingsInitialized=function(){m.console.log(m.elapsed()+": Settings initialized");var e="installed-"+be;if(localStorage.getItem(e)||localStorage.setItem(e,Date.now()),m.models.cleanupManager=new m.models.CleanupManager,m.addinManager=new m.models.AddinManager,m.commandManager=new m.CommandManager,m.cmd=m.commandManager.execute.bind(m.commandManager),m.models.mantraManager=new m.models.MantraManager,m.widgetManager=new m.models.WidgetManager,m.widgetManager.setupWhenReady(),m.appView=new m.views.Dashboard,!localStorage.getItem("offered-plan")&&m.conditionalFeatures.featureEnabled("notes-degraded")&&$.ajax({type:"GET",contentType:"application/json",url:ye+"account/history"}).done((function(e){e.offeredPlan&&localStorage.setItem("offered-plan",e.offeredPlan)})),localStorage.client_uuid?window.Cypress&&$("body").attr("data-test-ready-for-tests",""):$.ajax({type:"POST",contentType:"application/json",data:JSON.stringify({action:"registerClient"}),url:ye+"user/client"}).done((function(e){e.client_uuid&&localStorage.client_uuid!==e.client_uuid&&(localStorage.getItem("token")||localStorage.setItem("registrationStatePending",!0),localStorage.client_uuid=e.client_uuid,window.Cypress&&$("body").attr("data-test-ready-for-tests",""))})).fail(console.error),m.syncCoordinator=new m.models.SyncCoordinator,localStorage.firstSynchronized&&m.trigger("sync:downloadIfNeeded"),!z()){if(new URL(window.location).searchParams.get("sync")&&i.resolveDeferral(),m.syncCoordinator.syncSettings(null,!0),localStorage.getItem("token")){const e=t.getTimestamps().then().catch(console.error);m.appView.listenTo(m,"appsReady",(async()=>{await e,V()}))}else m.appView.listenToOnce(m,"appsReady",(async()=>{m.widgetManager.loadWidget("modal")}))}m.appView.listenToOnce(m,"appsReady",Ie),m.appView.listenTo(m,"appsReady",Te),m.appView.listenTo(m,"appsReady",Ce),m.appView.listenToOnce(m,"appsReady",Se)};