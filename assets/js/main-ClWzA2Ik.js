const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/WeatherApp-D2Aat05_.js","assets/js/style-cpFB66wV.js","assets/css/style-CrTXrpPu.css","assets/js/BaseIcon-Bb2ZVMd4.js","assets/js/dynamic-import-helper-DIl3ayLm.js","assets/js/index-DY0DW88M.js","assets/js/Logger-CErMjlBd.js","assets/js/_plugin-vue2_normalizer-DeUNqxFl.js","assets/css/BaseIcon-Bkqy2Cka.css","assets/js/SmoothReflow-Cnw3bIxd.js","assets/js/ResizeSensor-ZXOsDHeC.js","assets/js/useAllComponentsMounted-RTvHVD2I.js","assets/js/DataSyncService-BnTv72BN.js","assets/css/SmoothReflow-C80bIkgz.css","assets/js/reactiveCustomization-B8WwDagp.js","assets/js/AppPopup-whOF9ytj.js","assets/js/globalKeyEventManager-Dw4DvSNm.js","assets/css/AppPopup-BXpiIkq_.css","assets/js/AppHeader-DINik7Wl.js","assets/js/AppHeaderControl-CYSrwe76.js","assets/css/AppHeaderControl-B2WuFnb1.css","assets/js/constants-KuzCZNtH.js","assets/js/icon-close-DRlspKs3.js","assets/css/AppHeader-CM5L_Lkb.css","assets/js/BaseDropdown-CJtlJqHX.js","assets/js/BaseDropdownContent-Nf5O_5Ty.js","assets/js/constants-CALDQiUE.js","assets/js/index-CV0q_XsJ.js","assets/css/BaseDropdownContent-BVfvvT0B.css","assets/js/portal-vue.esm-BDTnR1AQ.js","assets/js/icon-ellipsis-D7nTOXaQ.js","assets/css/BaseDropdown-CwtM7hMN.css","assets/js/BaseDropdownOption-Bn6J2nm1.js","assets/css/BaseDropdownOption-DaYMTb1b.css","assets/js/ToggleSwitch-DSwcb4Go.js","assets/css/ToggleSwitch-CJxlu7QV.css","assets/js/AppViewSwitchDynamic-Dtsc-8t8.js","assets/js/appViewSwitchMixin-BsLJ76Hr.js","assets/css/AppViewSwitchDynamic-BvKRKS9r.css","assets/js/AppView-Du2InOAV.js","assets/css/AppView-CsYj23U-.css","assets/js/AppActionBanner-CkVuA87P.js","assets/js/Tooltip-DJa0YW0l.js","assets/css/Tooltip-BXj2EzZt.css","assets/css/AppActionBanner-Cd2jUVM-.css","assets/js/BaseDropdownDivider-Bay0Demn.js","assets/css/BaseDropdownDivider-D_a21TP7.css","assets/js/modal-CXkRDJ21.js","assets/js/enums-C0TfsRui.js","assets/js/VueBase-EULQJZ9I.js","assets/js/_commonjsHelpers-B3K3fdV-.js","assets/js/ClickOutside-DCLvi2fj.js","assets/js/pinia-bvFMkYCE.js","assets/js/AppContainer-Dy_GGrtc.js","assets/js/showAnyway-CR--Ivye.js","assets/css/AppContainer-Okwrv5EP.css","assets/js/AppDash-CNft_R_U.js","assets/css/AppDash-Bgvh0Jie.css","assets/js/hideEventsMixin-C3v17jdv.js","assets/js/useAppToggle-GEGV5YXE.js","assets/js/ViewState-DzCxxm0h.js","assets/js/appZStack-B9FmF8l5.js","assets/css/WeatherApp-Cjo9_q55.css"])))=>i.map(i=>d[i]);
import"./VueBase-EULQJZ9I.js";import{_ as e}from"./style-cpFB66wV.js";import{R as t}from"./ResizeSensor-ZXOsDHeC.js";import{V as i,d as o,A as r,h as n}from"./index-DY0DW88M.js";import{persistent as a,computed as s}from"./reactiveCustomization-B8WwDagp.js";import{a as l}from"./DataSyncService-BnTv72BN.js";import c from"./AppContainer-Dy_GGrtc.js";import{A as d}from"./AppDash-CNft_R_U.js";import{s as u}from"./showAnyway-CR--Ivye.js";import{h as p}from"./hideEventsMixin-C3v17jdv.js";import{u as h}from"./useAppToggle-GEGV5YXE.js";import{u as w}from"./ViewState-DzCxxm0h.js";import{n as g}from"./_plugin-vue2_normalizer-DeUNqxFl.js";const f={tornado:"wind",tropicalStorm:"wind",hurricane:"wind",severeThunderstorm:"cloud-rain-wind",thunderstorm:"cloud-lightning",mixedRainAndSnow:"cloud-hail",drizzle:"cloud-drizzle",rain:"cloud-rain",freezingRain:"cloud-hail",showers:"cloud-rain",sunnyShowers:"cloud-sun-rain",snowFlurries:"cloud-snow",snow:"cloud-snow",hail:"cloud-hail",sleet:"cloud-hail",dust:"cloud-fog",foggy:"cloud-fog",haze:"haze",smoky:"haze",blustery:"wind",windy:"wind",cold:"thermometer-sun",cloudy:"cloudy",mostlyCloudyNight:"cloudy",mostlyCloudyDay:"cloudy",partlyCloudyNight:"cloud-moon",partlyCloudyDay:"cloud-sun",clearNight:"moon",clearDay:"sun-medium",scatteredThunderstorm:"cloud-lightning",scatteredShowers:"cloud-drizzle",heavySnow:"cloud-snow",thundershowers:"cloud-lightning",snowShowers:"cloud-snow",unknown:"not-today"},v={speed:{metricToImperial:.62137,imperialToMetric:1.60934},pressure:{metricToImperial:.02953,imperialToMetric:33.86309},shortLength:{metricToImperial:.03937,imperialToMetric:25.4},longLength:{metricToImperial:.62137,imperialToMetric:1.60934}};function y(e,t){return t?Math.round(5*(e-32)/9):e}function b(e,t,i){const o=i?{pressure:"kPa",speed:"km/h",shortLength:"mm",longLength:"km"}:{pressure:"inHg",speed:"mph",shortLength:"in",longLength:"mi"};return i?Math.round(t*v[e].imperialToMetric)+" "+o[e]:Math.round(t)+" "+o[e]}function S(e){return`icon/weather/${f[e]}`}function T(e){return e=parseInt(e.substr(e.indexOf("T")+1,2)),a.hour12clock?(e>12?e-12:0===e?12:e)+(e<12?"AM":"PM"):e+""}function L(e){let t={rain:e.rainProbability,ice:e.iceProbability,snow:e.snowProbability},i="rain",o=0;return Object.entries(t).forEach((([e,t])=>{t>o&&(i=e,o=t)})),{type:m.utils.capitalizeWords(i),chance:o}}class A{constructor(e,t){e&&e.now&&(this.metric="f"!==t,this.location=e.location,this.now=Object.assign({},e.now,{temperature:y(e.now.temperature,this.metric),icon:S(e.now.code),apparentTemperature:y(e.now.apparentTemperature,this.metric),windGust:b("speed",e.now.windGust,this.metric),windSpeed:b("speed",e.now.windSpeed,this.metric),precipitationType:e.now.hasPrecipitation?e.now.precipitationType:"Rain",precipAmount6Hours:b("shortLength",e.now.precipAmount6Hours,this.metric)}))}}class j extends A{constructor(e,t){super(e,t),e&&e.now&&(this.now=Object.assign({},e.now,this.now,{precipAmount:b("shortLength",e.now.precipAmount,this.metric),temperature:y(e.now.temperature,this.metric),visibility:b("longLength",e.now.visibility,this.metric),sunrise:e.now.sunrise?m.utils.getHoursMinsStr(new Date(e.now.sunrise)):"AM",sunset:e.now.sunset?m.utils.getHoursMinsStr(new Date(e.now.sunset)):"PM",pressure:b("pressure",parseFloat(e.now.pressure),this.metric),pressureChanging:"Steady"!==e.now.pressureTendency,pressureRotation:"Falling"===e.now.pressureTendency?180:0,precipitationChance:L(e.now)}),e.hours&&e.days&&(this.hours=e.hours.map((e=>Object.assign({},e,{apparentTemperature:y(e.apparentTemperature,this.metric),temperature:y(e.temperature,this.metric),windGust:b("speed",e.windGust,this.metric),windSpeed:b("speed",e.windSpeed,this.metric),icon:S(e.code),hour:T(e.hour)}))),this.days=e.days.map((e=>Object.assign({},e,{apparentHigh:y(e.apparentHigh,this.metric),apparentLow:y(e.apparentLow,this.metric),high:y(e.high,this.metric),low:y(e.low,this.metric),windGust:b("speed",e.windGust,this.metric),windSpeed:b("speed",e.windSpeed,this.metric),icon:S(e.code),precipitationChance:L(e)})))))}}const O="weather:forecast",I="weather:location",R="detailLastUpdated",z="baseLastUpdated",M="weather:nextUpdate",N=new(i.extend({name:"WeatherDataService",data:()=>({conditionsRaw:localStorage.getObject(O),manualLocation:localStorage.getObject(I),detailed:!1,noConnection:!1,loading:!1}),unreactive:()=>({refreshTimeoutId:null}),computed:{conditions(){return this.conditionsRaw?new(this.detailed?j:A)(this.conditionsRaw,a.temperatureUnit):null},locationName(){var e,t;return(null==(e=this.manualLocation)?void 0:e.shortName)||(null==(t=this.conditions)?void 0:t.location.locationName)},tabVisible:()=>o.tabVisible},watch:{conditionsRaw(e){e&&localStorage.setObject(O,e),this.setRefreshTimeout()},tabVisible(e){e?this.setRefreshTimeout():clearTimeout(this.refreshTimeoutId)},detailed(e){e&&this.refreshIfOutdated()}},created(){!function(){const e=localStorage.getObject("weather-manual");e&&(localStorage.setObject("weather:location",{latitude:e.latitude,longitude:e.longitude,name:e.locationName,shortName:e.locationName}),localStorage.removeItem("weather-manual")),localStorage.removeItem("weather")}(),window.addEventListener("storage",this.onStorageEvent),this.setRefreshTimeout()},methods:{setLocation(e){JSON.stringify(this.manualLocation)!==JSON.stringify(e)&&(e?localStorage.setObject(I,e):localStorage.removeItem(I),this.manualLocation=e,this.refreshFromServer())},setDetailLevel(e){this.detailed=e},onStorageEvent(e){var t;const i=e=>e&&JSON.parse(e);if((null==e?void 0:e.key)===O&&(null==e?void 0:e.newValue)){const o=i(e.newValue);o[z]>((null==(t=this.conditionsRaw)?void 0:t[z])||0)&&(this.conditionsRaw=o)}else(null==e?void 0:e.key)===I&&(this.manualLocation=i(e.newValue))},getLastUpdated(){const e=localStorage.getObject(O);return e?parseInt(e[this.detailed?R:z]||0):0},getTimeToNextUpdate(){const e=parseInt(localStorage.getItem(M)),t=Date.now(),i=18e5-(t-this.getLastUpdated());return e?Math.max(e-t,i,0):Math.max(i,0)},refreshIfOutdated(){this.getTimeToNextUpdate()<=0&&this.tabVisible&&this.refreshFromServer()},setRefreshTimeout(){clearTimeout(this.refreshTimeoutId),this.refreshTimeoutId=setTimeout(this.refreshIfOutdated,this.getTimeToNextUpdate())},async refreshFromServer(){const e=this.detailed;if(this.loading)return;this.loading=!0;let t="weather/"+(e?"forecast":"current");this.manualLocation&&(t+=`?lat=${this.manualLocation.latitude}&lon=${this.manualLocation.longitude}`);try{const{data:i}=await l.get(t),o=Date.now();i[z]=o,e&&(i[R]=o),localStorage.removeItem(M),this.conditionsRaw=Object.assign({},this.conditionsRaw||{},i),this.noConnection=!1}catch(i){console.error(i);const e=i.response;e&&429===e.status&&e.headers["retry-after"]?(localStorage.setItem(M,Date.now()+1e3*parseInt(e.headers["retry-after"])),this.setRefreshTimeout()):this.noConnection=!0}finally{this.loading=!1}}}})),V=w("weather"),_=new r({feature:"weather"});const x=g({name:"Weather",components:{WeatherApp:()=>e((()=>import("./WeatherApp-D2Aat05_.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62])),AppDash:d,AppContainer:c},directives:{ResizeSensor:t},mixins:[p({appKey:"weather",hideEvents:["globalEvent:toggle:bottom-left","globalEvent:toggle:bottom-right","globalEvent:toggle:top-right"],closeFunctionName:"closePopup",eventTriggerProperty:"popupActive"})],provide(){return{viewStateStore:this.weatherViewStateStore}},setup:()=>({...h(V,{analytics:_}),weatherViewStateStore:V()}),computed:{conditions:()=>N.conditions,location:()=>N.locationName||"Weather",icon(){var e,t;return(null==(t=null==(e=this.conditions)?void 0:e.now)?void 0:t.icon)||"icon/weather/cloud-sun"},weatherVisible:()=>s.weatherVisible,showAnyway:()=>u.includes("weather"),detailedLevelVisible(){return this.$plus&&this.popupActive}},watch:{detailedLevelVisible(){N.setDetailLevel(this.detailedLevelVisible)}},mounted(){m.widgetManager.appReady("weather")},methods:{updateWeatherAppWidth({width:e}){o.weatherDashAppWidth=e}}},(function(){var e=this,t=e._self._c;return t("app-container",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.closePopup,expression:"closePopup"}],attrs:{"visible-setting":"weatherVisible","app-name":"weather",hotkey:"W","data-test":"weather",overlay:e.popupActive,"deep-transition-app-dash":!0},on:{toggle:e.togglePopupAndCaptureIfOpen}},[t("app-dash",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.updateWeatherAppWidth,expression:"updateWeatherAppWidth"}],staticClass:"metric-item",attrs:{icon:e.icon,label:e.location,"app-visible":e.popupActive,"blur-background-hover":!0},on:{click:function(t){return e.togglePopupAndCaptureIfOpen({source:"click"})}},scopedSlots:e._u([{key:"icon-right",fn:function(){return[e.conditions?t("div",{staticClass:"current-temp",attrs:{"data-test":"temperature"}},[e._v(" "+e._s(e.conditions.now.temperature+"°")+" ")]):e._e()]},proxy:!0}])}),t("transition",{attrs:{name:"slide-down-fade-blurred-app"}},[e.popupActive?t("weather-app",{staticClass:"hide-apps-fade",on:{close:e.closePopup}}):e._e()],1)],1)}),[],!1,null,"e98457c9").exports,C=document.querySelector(".region.top-right"),D=document.createElement("div");C.prepend(D),new i({render:()=>n(x)}).$mount(D);const k=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{k as m,N as w};