import{a as e}from"./DataSyncService-BnTv72BN.js";import{a as o}from"./authService-CEyg9tcu.js";const n=new class{constructor(){this.oneTimeLoginInProgress=!1}startOneTimeLogin(){this.oneTimeLoginInProgress=!0;const e=Date.now(),o=Number(localStorage.getItem("oneTimeLoginStarted")??0);if(o&&o>e-1e4)throw new Error("Another login is currently being processed.");localStorage.setItem("oneTimeLoginStarted",String(e))}finalizeOneTimeLogin(){this.oneTimeLoginInProgress=!1}async loginWithOneTimeLoginResponse(e){try{await o.onSuccessfulAuthResponse(e,{keepPreviousUserData:!!e.legacy,migrateLegacy:!!e.legacy})}catch(n){throw await chrome.runtime.sendMessage({type:"oneTimeLogin:response",payload:{success:!1,errorMessage:n}}),n}finally{localStorage.removeItem("oneTimeLoginStarted")}}async redeemOneTimePassword(o){const{otp:n,otpUuid:t,email:i,...a}=o,s={type:"oneTimeLogin",payload:{otp:n,otpUuid:t,email:i},openNewTab:!0,updateSenderTab:!1};return{...(await e.post("user/authenticate",s)).data,...a,email:i}}async sendOneTimeLoginEmail(o){return await e.post("login/onetime/send",{email:o,medium:"extension"})}};export{n as o};