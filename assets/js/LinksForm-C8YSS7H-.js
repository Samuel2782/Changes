import t from"./AppHeader-DINik7Wl.js";import{B as e}from"./BaseForm-BdYxhfcT.js";import{F as a}from"./FormInput-BBZZjhFA.js";import{F as s,a as i}from"./FormFieldWrapper-D2Jnr3WU.js";import r from"./BaseIcon-Bb2ZVMd4.js";import{n}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import{I as o,s as l,ai as p,r as u,n as d,H as c,a as f}from"./index-DY0DW88M.js";import{a as h,S as v}from"./SortableDirective-D49sNxfA.js";import{o as w,c as y,a as b,b as g,v as k,d as I}from"./links-DeE4eF_z.js";import S from"./AppView-Du2InOAV.js";import{F as j}from"./FormToggle-CEe10BOr.js";import{B as _}from"./BaseDropdownOption-Bn6J2nm1.js";import{a as C}from"./compareObjects-R6Hcs7xe.js";import{L as x}from"./constants-Bt_TxKWw.js";import{A as F}from"./AppConfirmCancel-CipvWVDl.js";import{g as L}from"./globalKeyEventManager-Dw4DvSNm.js";import{B}from"./BaseDropdown-CJtlJqHX.js";import{A}from"./AppHeaderControl-CYSrwe76.js";import{F as E}from"./FavIcon-U8dpvQtb.js";import{a as T}from"./modal-CXkRDJ21.js";import{U as V}from"./enums-C0TfsRui.js";import D from"./icon-trash-BSyM-ydR.js";import"./constants-KuzCZNtH.js";import"./icon-close-DRlspKs3.js";import"./BaseMessage-BBabi6Dl.js";import"./SmoothReflow-Cnw3bIxd.js";import"./ResizeSensor-ZXOsDHeC.js";import"./useAllComponentsMounted-RTvHVD2I.js";import"./DataSyncService-BnTv72BN.js";import"./Logger-CErMjlBd.js";import"./ErrorPulseInput-CkNsRuJq.js";import"./SoftFocus-BUhesXB-.js";import"./style-cpFB66wV.js";import"./dynamic-import-helper-DIl3ayLm.js";import"./BaseItemList-OqIOPpWO.js";import"./index-CV0q_XsJ.js";import"./constants-BpVlFj04.js";import"./pinia-bvFMkYCE.js";import"./ToggleSwitch-DSwcb4Go.js";import"./constants-CALDQiUE.js";import"./BaseDropdownContent-Nf5O_5Ty.js";import"./portal-vue.esm-BDTnR1AQ.js";import"./icon-ellipsis-D7nTOXaQ.js";const M=n({name:"LinksForm",components:{FavIcon:E,AppHeaderControl:A,BaseDropdown:B,BaseDropdownOption:_,FormToggle:j,AppView:S,FormRepeatableInput:n(o({name:"FormRepeatableInput",directives:{sortable:h},components:{BaseIcon:r,SortableItemList:v,DragDropHandle:n({name:"DragDropHandle",components:{BaseIcon:r}},(function(){return(0,this._self._c)("base-icon",{staticClass:"drag-drop-handle",attrs:{src:"grip-vertical",size:"16px","data-test":"drag-drop-handle","data-drag-drop-handle":""}})}),[],!1,null,"4832a531").exports,FormFieldWrapper:s},props:{value:{type:Array,required:!0},name:{type:String,default:"repeatable-input"},property:{type:String,required:!0},getNewEntry:{type:Function,required:!0},addButtonText:{type:String,default:"Add"},disableMultipleEntries:{type:Boolean,default:!1},placeholder:{type:String,default:""},...i},emits:["input","addBlocked"],setup(t,{emit:e}){const a=l();return w(a,(t=>{e("input",t.newOrder)})),{sortableType:a,formFields:p("formFields"),inputs:u()}},data:()=>({pulseInputIndex:null,internalValues:[]}),watch:{value:{handler(t){t.length||this.addEntry(),this.internalValues=[...t]},immediate:!0}},mounted(){var t;null==(t=this.formFields)||t.addField(this.name,this.focusInput,(t=>this.pulseAndFocusInput(t)))},destroyed(){var t;null==(t=this.formFields)||t.removeField(this.name)},methods:{addEntry(){this.internalValues.push(this.getNewEntry()),this.$emit("input",this.internalValues)},async addEntryIfLastEntryHasValue(){var t,e,a,s;(null==(e=null==(t=this.value.at(-1))?void 0:t[this.property])?void 0:e.trim())?(this.addEntry(),await d(),await d(),null==(s=null==(a=this.inputs)?void 0:a[this.value.length-1])||s.focus()):await this.pulseAndFocusInput(this.value.length-1)},onAddEntryClick(){this.disableMultipleEntries?this.$emit("addBlocked"):this.addEntryIfLastEntryHasValue()},onEnter(){var t;this.disableMultipleEntries?null==(t=this.formFields)||t.focusNextInputOrSubmitIfLast(this.name):this.addEntryIfLastEntryHasValue()},removeEntry(t){this.internalValues.splice(t,1),this.$emit("input",this.internalValues)},async focusInput(t=0){var e,a,s;await d(),null==(s=null==(a=null==(e=this.inputs)?void 0:e[t])?void 0:a.focus)||s.call(a)},async pulseAndFocusInput(t){await this.focusInput(t),this.pulseInputIndex=t??null,await c(1e3),this.pulseInputIndex=null}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("form-field-wrapper",t._b({staticClass:"form-repeatable-input"},"form-field-wrapper",t.$props,!1),[e("sortable-item-list",{staticClass:"repeatable-input-rows",attrs:{items:t.value,type:t.sortableType,"use-handles":!0},scopedSlots:t._u([{key:"default",fn:function({sortables:a}){return t._l(a,(function(a,s){return e("div",{directives:[{name:"sortable",rawName:"v-sortable",value:a,expression:"sortable"}],key:a.id,staticClass:"repeatable-input-row",attrs:{"data-test":"repeatable-input-row"}},[t.value.length>1?e("drag-drop-handle"):t._e(),t._t("repeatable-input-row-before-input",null,{value:a.data[t.property]}),e("div",{staticClass:"repeatable-input-row-content"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.data[t.property],expression:"sortable.data[property]"}],ref:"inputs",refInFor:!0,class:{"empty-input":!a.data[t.property],pulse:t.pulseInputIndex===s},attrs:{placeholder:s?"":t.placeholder},domProps:{value:a.data[t.property]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a.data,t.property,e.target.value)}}}),e("div",{staticClass:"repeatable-input-row-actions"},[t._t("repeatable-input-row-actions",null,{value:a.data[t.property]}),t.value.length>1?e("div",{staticClass:"icon-wrapper",attrs:{title:"Delete"},on:{click:function(e){return t.removeEntry(s)}}},[e("base-icon",{attrs:{src:"trash-2"}})],1):t._e()],2)])],2)}))}}],null,!0)}),e("div",{staticClass:"add",on:{click:t.onAddEntryClick}},[t._t("add",(function(){return[e("div",{staticClass:"button-clear"},[e("div",{staticClass:"button-label"},[e("base-icon",{attrs:{src:"plus"}}),e("span",[t._v(t._s(t.addButtonText))])],1)])]}))],2)],1)}),[],!1,null,"2c180030").exports,FormInput:a,BaseForm:e,AppHeader:t,AppConfirmCancel:F,BaseIcon:r},inject:["itemStore","viewStateStore","capture","batchCapture"],computed:{activeItem(){return this.itemStore.activeItem}},mounted(){this.viewStateStore.beforeViewChange=()=>0===this.getFormMutations({cancelling:!0}).length?Promise.resolve(!0):this.viewStateStore.setConfirmation({title:"Are you sure you want to cancel?",dashboardOverlay:!0}),L.registerEventListener("backToList","keyup",27,this.returnToListView)},async destroyed(){this.viewStateStore.resetBeforeViewChange(),this.itemStore.clearActiveItem(),L.removeEventListener("backToList","keyup",27,this.returnToListView)},methods:{getFormMutations({cancelling:t=!1}={}){let e;if(this.itemStore.adding){if(t){const t=new b({id:this.activeItem.id});e=y(g(t))}}else{const t=this.itemStore.buildLinkGroup(this.itemStore.getItemById(this.itemStore.activeItemId));e=y(t)}const a=y(g(this.activeItem));return C(e,a)},async submit(){const t=this.getFormMutations();if(0===t.length)return void(await this.returnToListView());const e=g(this.activeItem);k(e),this.capture(`${e.hasManyLinks?"tab group":"link"} ${this.itemStore.adding?"add":"edit"}`,{is_paid_event:e.hasManyLinks}),await this.itemStore.processMutations(t),this.viewStateStore.resetBeforeViewChange(),await this.returnToListView()},async confirmAndDelete(){var t;null==(t=this.$refs.editingDropdown)||t.closeDropdown();await this.viewStateStore.setConfirmation({title:"Are you sure you want to delete this link?"})&&(this.capture((this.activeItem.hasManyLinks?"tab group":"link")+" delete",{is_paid_event:this.activeItem.hasManyLinks}),await this.itemStore.deleteLinkGroup(this.activeItem.id),this.viewStateStore.resetBeforeViewChange(),await this.returnToListView())},returnToListView(){return this.viewStateStore.setActiveView(x.List)},createNewUrl:()=>new I,showTabGroupsUpsell(){T(V.TAB_GROUPS,"dash")},closePopup(){return this.viewStateStore.togglePopup(!1)},async openLinkInNewTab(t){this.batchCapture("link click",{is_paid_event:!1}),await m.utils.getBrowser().tabs.create({url:f.ensureUrlScheme(t)})}}},(function(){var t=this,e=t._self._c;return e("app-view",{staticClass:"links-app-form",attrs:{"data-test":"links-form-view"},scopedSlots:t._u([{key:"header",fn:function(){return[e("app-header",{on:{close:t.closePopup},scopedSlots:t._u([{key:"left",fn:function(){return[e("app-header-control",{attrs:{"data-test":"return-list-view"},on:{click:t.returnToListView}},[e("base-icon",{staticClass:"icon",attrs:{src:"icon/arrow-left"}})],1)]},proxy:!0},{key:"center",fn:function(){return[t._v(" "+t._s(t.itemStore.adding?"Creating a":"Editing")+" link ")]},proxy:!0},{key:"right",fn:function(){return[t.itemStore.adding?t._e():e("base-dropdown",{ref:"editingDropdown",attrs:{"data-test":"edit-dropdown","container-class":"app"}},[e("base-dropdown-option",{attrs:{"data-test":"delete-link"},on:{click:t.confirmAndDelete}},[e("inline-svg",{staticClass:"icon icon-trash",attrs:{src:D}}),t._v(" Delete ")],1)],1)]},proxy:!0}])})]},proxy:!0},{key:"body",fn:function(){return[e("base-form",{attrs:{submit:t.submit,adding:t.itemStore.adding}},[e("form-input",{attrs:{"data-test":"title-input",autofocus:"",label:"Title",name:"title"},model:{value:t.activeItem.title,callback:function(e){t.$set(t.activeItem,"title",e)},expression:"activeItem.title"}}),e("form-repeatable-input",{attrs:{placeholder:"example.com",label:"Links",name:"links",property:"url","data-test":"links-input","get-new-entry":t.createNewUrl,"disable-multiple-entries":!t.$plus},on:{addBlocked:t.showTabGroupsUpsell},scopedSlots:t._u([{key:"repeatable-input-row-before-input",fn:function({value:t}){return[e("fav-icon",{staticClass:"repeatable-favicon",attrs:{url:t}})]}},{key:"repeatable-input-row-actions",fn:function({value:a}){return[a?e("div",{staticClass:"icon-wrapper",attrs:{"data-test":"repeatable-icon-link",title:"Open Link in New Tab"},on:{click:function(e){return t.openLinkInNewTab(a)}}},[e("base-icon",{attrs:{src:"square-arrow-out-up-right"}})],1):t._e()]}},{key:"add",fn:function(){return[e("div",{staticClass:"button-clear",attrs:{"data-test":"add-link"}},[e("div",{staticClass:"button-label"},[e("base-icon",{attrs:{src:"plus",size:"15px","stroke-width":"3px"}}),e("span",[t._v("Add another tab")])],1),t.$plus?t._e():e("div",{staticClass:"badge badge-plus"},[t._v("PLUS")])])]},proxy:!0}]),model:{value:t.activeItem.links,callback:function(e){t.$set(t.activeItem,"links",e)},expression:"activeItem.links"}}),e("form-toggle",{attrs:{"data-test":"pinned-input",label:"Pin to Dashboard"},model:{value:t.activeItem.pinned,callback:function(e){t.$set(t.activeItem,"pinned",e)},expression:"activeItem.pinned"}})],1)]},proxy:!0},{key:"confirm",fn:function(){return[t.viewStateStore.confirmationProps?e("app-confirm-cancel",t._b({attrs:{"data-test":"confirm-cancel"}},"app-confirm-cancel",t.viewStateStore.confirmationProps,!1)):t._e()]},proxy:!0}])})}),[],!1,null,"e3549ef8").exports;export{M as default};