const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/DataSyncService-BnTv72BN.js","assets/js/index-DY0DW88M.js","assets/js/Logger-CErMjlBd.js","assets/js/style-cpFB66wV.js","assets/css/style-CrTXrpPu.css"])))=>i.map(i=>d[i]);
import{I as e,H as t,aF as s,r as i,ah as a,n as o,ab as r,g as n,a3 as l,A as c,V as d,h as m}from"./index-DY0DW88M.js";import{I as u,C as p}from"./ClickOutside-DCLvi2fj.js";import{R as h}from"./ResizeSensor-ZXOsDHeC.js";import{A as v,g as b,I as g,a as f,b as w,c as k,d as C,s as S,D as _,S as y}from"./siteBlocker-C6Hr7RId.js";import"./localStorage-B4mFdj8F.js";import{e as x,D as I,c as R,P as M,h as j}from"./DataSyncService-BnTv72BN.js";import{_ as T}from"./style-cpFB66wV.js";import{u as H}from"./internalDataMetrics-iQDg_iJD.js";import{n as B}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import{a as P}from"./Logger-CErMjlBd.js";import{u as D,S as A}from"./streaks-Co8maZu5.js";import{e as E,a as V,S as L}from"./constants-CHIvVb_r.js";import z from"./Popup-3lZ9av7x.js";import{F}from"./FlashMessage-gZ_ihQT2.js";import{p as W}from"./promisifiedChrome-B6V9WMyE.js";import{a as U,D as G}from"./constants-CALDQiUE.js";import N from"./BaseIcon-Bb2ZVMd4.js";import"./main-DggM1g6v.js";import"./BaseDropdownContent-Nf5O_5Ty.js";import"./index-CV0q_XsJ.js";import"./dynamic-import-helper-DIl3ayLm.js";import"./flashMessageQueue-Byrek2Yp.js";import"./info-DdD9a7JK.js";import"./globalKeyEventManager-Dw4DvSNm.js";import"./icon-close-DRlspKs3.js";const O=B(e({name:"SiteBlockerInterventionResistanceStreak",setup:()=>({internalDataMetrics:H()}),computed:{sitesResistedStreakMetric(){return this.internalDataMetrics.getMetric("streaksStats","getSitesResistedStreak")},sitesResistedStreak(){var e,t;return this.sitesResistedStreakMetric.value.storeLoaded?(null==(t=(e=this.sitesResistedStreakMetric.value).getterValue)?void 0:t.call(e))||0:"-"}}}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"site-blocker-intervention-resistance-streak metric-type app-dash"},[t("div",{staticClass:"metric-stat"},[t("span",{attrs:{"data-test":"resistance-streak"}},[e._v(e._s(e.sitesResistedStreak))])]),e._m(0)])}),[function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"metric-label"},[t("span",{staticClass:"metric-label-name"},[e._v("Resistance streak")])])}],!1,null,"035e5669").exports;const $=B(e({name:"SiteBlockerInterventionAffirmation",setup:()=>({affirmation:P(v)})}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"site-blocker-intervention-affirmation"},[e._v(" "+e._s(e.affirmation)+" ")])}),[],!1,null,"91e3e7ce").exports;const K=B(e({name:"SiteBlockerInterventionBypassBreath",emits:["complete"],data:()=>({text:"inhale",shrinking:!0}),async mounted(){await t(700),this.shrinking=!1,await t(3750),this.text="",await t(800),this.text="exhale",await t(600),this.shrinking=!0,await t(3750),this.text="",await t(1500),this.$emit("complete")}}),(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"site-blocker-intervention-bypass-breath"},[t("div",{staticClass:"breath-title"},[e._v("Take a deep breath")]),t("div",{staticClass:"breath-content",class:{shrinking:e.shrinking}},[t("div",{staticClass:"circle"}),t("div",{staticClass:"circle"}),t("div",{staticClass:"circle"}),t("transition",{attrs:{name:"fade",mode:"out-in",duration:500}},[t("div",{key:e.text,staticClass:"text"},[e._v(e._s(e.text))])])],1)])}),[],!1,null,"cc77d2f6").exports,Y=new c({feature:"site blocker"}),Q=e({name:"SiteBlockerInterventionDashboard",components:{BaseIcon:N,SiteBlockerInterventionResistanceStreak:O,SiteBlockerInterventionAffirmation:$,SiteBlockerInterventionBypassBreath:K,Popup:z,FlashMessage:F},setup(){const e=new URL(location.href).searchParams,t=s(!1);return{center:i(),topLeft:i(),searchParams:e,siteName:b(decodeURIComponent(e.get("sitename")||""),decodeURIComponent(e.get("metatitle")||""),decodeURIComponent(e.get("documenttitle")||""),decodeURIComponent(e.get("hostname")||"")),streaksStore:D(),lastFocus:localStorage.getItem(E),shouldShowFlashMessage:"true"===e.get("bypassDelayOver"),tabWasMuted:!1,tabId:null,isChromium:a(),metaKeyOrSymbol:"Cmd"===t?"⌘":t,activeStateExpiredTimeout:void 0,DropdownPosition:U,DropdownAlignment:G}},data:()=>({topRowHeight:0,centerAboveHeight:0,bypassing:!1,dashboardVisible:!0,streakTipVisible:"true"!==localStorage.getItem(g),unstoppableModeActive:f()}),computed:{topRowHeightPx(){return this.topRowHeight+"px"},centerAboveHeightPx(){return this.centerAboveHeight+"px"}},async mounted(){var e;if(this.shouldShowFlashMessage){const e=(await T((async()=>{const{default:e}=await import("./DataSyncService-BnTv72BN.js").then((e=>e.j));return{default:e}}),__vite__mapDeps([0,1,2,3,4]))).default;await o(),e.$emit("flashMessage",{message:"It's been 5 minutes. Focus on what matters.",persist:5e3})}if(x.$emit("globalEvent:window:resize"),r(localStorage.getItem(V))&&this.setActiveStateExpiredTimeout(),window.addEventListener("storage",(e=>{const t=w(),s=e.key===V&&("false"===e.newValue||null===e.newValue),i=e.key===V&&"false"!==e.newValue&&null!==e.newValue&&"true"!==e.newValue,a=e.key===L&&!t,o=e.key===k&&t&&C(t);e.key===V&&(clearTimeout(this.activeStateExpiredTimeout),this.unstoppableModeActive=!!i&&f()),i?this.setActiveStateExpiredTimeout():(s||a||o)&&(this.dashboardVisible=!1)})),!this.isChromium)return;const t=await W.tabs.getCurrent();(null==t?void 0:t.id)&&(this.tabId=t.id,(null==(e=null==t?void 0:t.mutedInfo)?void 0:e.muted)?this.tabWasMuted=!0:(await W.tabs.update(this.tabId,{muted:!0}),window.addEventListener("beforeunload",this.unmuteTabBeforeUnload)),this.unregisterTabCloseInServiceWorker(),window.addEventListener("beforeunload",this.registerTabCloseInServiceWorker))},methods:{calculateGridRowHeights(){var e,t,s;((null==(e=this.center)?void 0:e.offsetHeight)??0)<0||(this.topRowHeight=(null==(t=this.topLeft)?void 0:t.offsetHeight)??0,this.centerAboveHeight=window.innerHeight/2-(((null==(s=this.center)?void 0:s.offsetHeight)??0)/2+this.topRowHeight))},startBypassing(){this.bypassing=!0,Y.capture("intervention start tab bypass")},async close(){if(Y.capture("intervention close tab",{currently_bypassing:this.bypassing}),!this.isChromium)return;const e=await n().tabs.getCurrent();(null==e?void 0:e.id)&&await n().tabs.remove(e.id)},async dismiss(){this.isChromium&&await this.streaksStore.create({subset:A.SitesResisted,timestamp:Date.now(),valid:!1,data:this.searchParams.get("hostname")||""}),this.dashboardVisible=!1},async openMomentum(e){await this.increaseStreak(),window.removeEventListener("beforeunload",this.registerTabCloseInServiceWorker),Y.capture("intervention open momentum",{from:e}),this.isChromium?n().tabs.update({url:"/index.html"}):window.parent.location.href=window.location.origin+"/index.html"},async increaseStreak(){this.isChromium&&await this.streaksStore.create({subset:A.SitesResisted,timestamp:Date.now(),valid:!0})},async afterLeave(){if(this.tabId&&(this.tabWasMuted||(await W.tabs.update(this.tabId,{muted:!1}),window.removeEventListener("beforeunload",this.unmuteTabBeforeUnload))),this.bypassing){Y.capture("intervention tab bypassed");const e=w();e&&S(e)}window.removeEventListener("beforeunload",this.registerTabCloseInServiceWorker),window.parent.postMessage(_,"*"),location.reload()},dismissStreakTip(){this.streakTipVisible=!1,localStorage.setItem(g,"true")},unmuteTabBeforeUnload(){this.tabId&&W.tabs.update(this.tabId,{muted:!1})},registerTabCloseInServiceWorker(){if(!this.tabId)return;if(!this.isChromium)return;const e=new I("");R.sendMessage({handler:"increaseStreakWhenTabClosed",args:[this.tabId,this.searchParams.get("hostname")||"",e.getEnv()]})},unregisterTabCloseInServiceWorker(){this.tabId&&this.isChromium&&R.sendMessage({handler:"removeStreakTabClosedListener",args:[this.tabId]})},setActiveStateExpiredTimeout(){this.activeStateExpiredTimeout=setTimeout((()=>{this.dashboardVisible=!1}),Number(localStorage.getItem(V))-Date.now())}}}),X=()=>{l(((e,t)=>({"48a91244":e.topRowHeightPx,"59fb42b2":e.centerAboveHeightPx})))},q=Q.setup;Q.setup=q?(e,t)=>(X(),q(e,t)):X;const J=B(e({name:"SiteBlockerIntervention",components:{SiteBlockerInterventionDashboard:B(Q,(function(){var e=this,t=e._self._c;return e._self._setupProxy,t("transition",{attrs:{name:"fade-fast"},on:{"after-leave":e.afterLeave}},[e.dashboardVisible?t("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.calculateGridRowHeights,expression:"calculateGridRowHeights"}],staticClass:"site-blocker-intervention-dashboard dashboard dark dark-full",class:{unstoppable:e.unstoppableModeActive}},[t("div",{staticClass:"top-row"},[t("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.calculateGridRowHeights,expression:"calculateGridRowHeights"}],ref:"topLeft",staticClass:"top-left"},[t("div",{staticClass:"dash-button dash-button-neutral open-momentum",on:{click:function(t){return e.openMomentum("button")}}},[e._v("Open Momentum")])]),t("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.calculateGridRowHeights,expression:"calculateGridRowHeights"}],staticClass:"top-right"},[e.isChromium?t("site-blocker-intervention-resistance-streak"):e._e()],1)]),t("div",{staticClass:"center-above"}),t("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:e.calculateGridRowHeights,expression:"calculateGridRowHeights"}],ref:"center",staticClass:"center"},[t("transition",{attrs:{name:"fade",mode:"out-in"}},[e.bypassing?t("site-blocker-intervention-bypass-breath",{staticClass:"center-content",on:{complete:e.dismiss}}):t("div",{staticClass:"center-content"},[t("div",{staticClass:"site-blocked"},[e._v("Site blocked"),e.lastFocus?t("span",[e._v(" • Focusing on")]):e._e()]),t("div",{staticClass:"current-focus",attrs:{"data-test":"current-focus"},on:{click:function(t){return e.openMomentum(e.lastFocus?"focus":"emptyFocus")}}},[e._v(e._s(e.lastFocus||"Focusing"))])])],1)],1),t("div",{staticClass:"center-below"},[t("div",{staticClass:"buttons",class:{"shortcut-help":!e.isChromium}},[e.isChromium?t("div",{staticClass:"dash-button close-tab",on:{click:e.close}},[e._v("Close tab")]):t("div",{staticClass:"dash-button close-tab no-pointer-events",on:{click:e.close}},[e._v("Press "+e._s(e.metaKeyOrSymbol)+" W to close tab")]),t("transition",{attrs:{name:"fade",mode:"out-in"}},[e.unstoppableModeActive?t("div",{key:"1",staticClass:"unstoppable-message"},[t("base-icon",{attrs:{src:"octagon-x",size:"16px","stroke-width":"2.5px"}}),e._v(" No access in Unstoppable Mode ")],1):e.bypassing?e.isChromium?t("div",{key:"3",staticClass:"dash-button open-site no-pointer-events"},[e._v("By continuing you will break your resistance streak")]):e._e():t("div",{key:"2",staticClass:"dash-button open-site",on:{click:e.startBypassing}},[e._v("Open "+e._s(e.siteName))])])],1)]),t("div",{staticClass:"bottom-row"},[t("div",{staticClass:"bottom-center"},[t("site-blocker-intervention-affirmation")],1)]),t("transition",{attrs:{name:"fade-blurred-tip-app",appear:""}},[e.streakTipVisible&&e.dashboardVisible&&e.isChromium?t("popup",{attrs:{id:"intervention-streak-tooltip","target-element-selector":".site-blocker-intervention-resistance-streak",position:e.DropdownPosition.Bottom,alignment:e.DropdownAlignment.Right,"body-text":"Your streak resets if you open this website.",width:225,"nipple-displacement":25,"target-distance":5},on:{dismiss:e.dismissStreakTip}}):e._e()],1),e.shouldShowFlashMessage?t("flash-message"):e._e()],1):e._e()])}),[],!1,null,"dbed73cd").exports}}),(function(){var e=this._self._c;return this._self._setupProxy,e("div",{staticClass:"site-blocker-intervention",on:{scroll:function(e){e.stopPropagation()}}},[e("site-blocker-intervention-dashboard")],1)}),[],!1,null,null).exports;window.addEventListener("resize",(()=>{o((()=>{x.$emit("globalEvent:window:resize")}))})),d.use(u),d.use(M),d.directive("resize-sensor",h),d.directive("click-outside",p),new d({render:()=>m(J),pinia:j()}).$mount("#app"),window.parent.postMessage(y,"*");