import"./VueBase-EULQJZ9I.js";import{I as t,u as e,as as o,at as a,n as i,a as s,V as r,h as n}from"./index-DY0DW88M.js";import{d as l,a as p}from"./onboarding-CbWaAKel.js";import{s as d}from"./enums-C0TfsRui.js";import{u as S}from"./modal-DiTGFINU.js";import{S as c,a as u}from"./onboarding-Cm39YS_P.js";import{v as h}from"./v-style-8O6T7tyx.js";import{a as v}from"./DataSyncService-BnTv72BN.js";import{o as b}from"./upgrade-DsD9ozzX.js";import{n as g}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import"./SubscriptionSummary-BQ9oLLHV.js";import"./_commonjsHelpers-B3K3fdV-.js";import"./ClickOutside-DCLvi2fj.js";import"./pinia-bvFMkYCE.js";import"./portal-vue.esm-BDTnR1AQ.js";import"./Logger-CErMjlBd.js";import"./style-cpFB66wV.js";import"./helpers-Dah3fQ_V.js";import"./TabLeaderElection-S4Ghxpfd.js";import"./state-odjm2uKU.js";import"./LocalStorageStoreSyncedItem-kVGQtJA7.js";import"./compareObjects-R6Hcs7xe.js";import"./reactiveCustomization-B8WwDagp.js";import"./constants-CALDQiUE.js";import"./constants-KuzCZNtH.js";import"./state-DDN7j9xD.js";import"./constants-CHIvVb_r.js";import"./authService-CEyg9tcu.js";import"./auth-HiWjNVol.js";import"./persistStore-CE5fTtZd.js";import"./legacyUserMigration-eNETLKah.js";import"./migrateLegacyUserMessageHandler-HceDQnYT.js";import"./login-ByohQG_J.js";import"./index-DM3Q2nkp.js";import"./PomodoroTimers-CqOVDo7T.js";import"./settings-rA0qDzbq.js";import"./experiments-D9-xSE76.js";import"./settingsViewState-ZEr74HQm.js";import"./ViewState-DzCxxm0h.js";import"./appZStack-B9FmF8l5.js";import"./siteBlockerGroups-CkkkdBQZ.js";import"./ErrorPulseInput-CkNsRuJq.js";import"./SettingsTypes-C_Wf2Ybw.js";import"./accessToken-q_Kr5K6L.js";import"./tasksMockData-9Ir8-V1W.js";import"./tasksViewState-DGees08o.js";import"./embeddedApp-R3YDNjex.js";import"./plusStatusBanner-hTEdr56E.js";const f=g(t({name:"ModalContainer",components:{vStyle:h},setup:()=>({modalStore:S()}),data:()=>({plans:{},plansError:!1,sales:{},transitionDisabled:!1,transitionDuration:0,transitionName:void 0}),computed:{transitionProps(){const t={};this.transitionName&&(t.name=this.transitionName);const e=this.transitionDisabled?0:this.transitionDuration;return void 0!==e&&(t.duration=e),t},transitionGroupProps(){const t={},e=this.transitionDuration;return void 0!==e&&(t.duration=e),t},activeSubStep(){var t,e;return(null==(e=null==(t=this.modalStore.activeStep)?void 0:t.subSteps)?void 0:e[this.modalStore.activeSubStepIndex])||null},componentProps(){var t;return{...(null==(t=this.modalStore.activeStep)?void 0:t.componentProps)||{},...this.commonProps,commonProps:this.commonProps}},commonProps(){var t;return{id:this.modalStore.activeStep.id,subSteps:null==(t=this.modalStore.activeStep)?void 0:t.subSteps,plans:this.plans,plansError:this.plansError,sales:this.sales,activeSubStepIndex:this.modalStore.activeSubStepIndex,activeSubStep:this.activeSubStep,hidden:this.modalStore.hidden}}},watch:{async"modalStore.activeStep"(t,e){var o;t!==e&&(t.key&&t.key===e.key&&(this.transitionDisabled=!0),null==(o=t.onShow)||o.call(t)),(null==t?void 0:t.getPlanInfo)&&!Object.keys(this.plans).length&&this.getPlanInfo().then((({plans:t={},sales:e={}}={})=>{this.plans=t,this.sales=e||{}})).catch((t=>{this.plansError=!0,console.error(t)})),0===Object.keys(e).length&&this.setActiveStepTransition()},"modalStore.activeStep.hideOtherApps"(t,e){t?m.widgetManager.hideApps({layer:"modalContainer"}):e&&m.widgetManager.showApps({layer:"modalContainer"})}},created(){m.modals={stepsEnum:d,definitions:l,getAllocatedDefinitions:p},m.on("modal:show",this.showModal),m.on("modal:complete",this.handleStepCompletion),m.on("modal:subStepComplete",this.handleSubStepCompletion),m.on("modal:close",this.dismissModal),m.on("modal:showUpgrade",this.showUpgrade),m.trigger("modalContainer:created:checkForced"),m.trigger("modalContainer:created"),this.checkParamsAndShowModal()},destroyed(){m.off("modal:show",this.showModal),m.off("modal:complete",this.handleStepCompletion),m.off("modal:subStepComplete",this.handleSubStepCompletion),m.off("modal:close",this.dismissModal),m.off("modal:showUpgrade",this.showUpgrade),delete m.modals},methods:{updateStepActiveProperties(t,{deactivate:e,activeSubStepIndex:o}={}){e?(this.$delete(t,"activeSubStepIndex"),this.$delete(t,"active")):(t.active||this.$set(t,"active",!0),t.subSteps&&void 0!==o&&this.$set(t,"activeSubStepIndex",o))},async showModal(t,{subStepIndex:o,force:a}={}){var i,s,r,n;await e((()=>this.modalStore.hidden)).toBe(!1),this.modalStore.locked&&!a||(a&&this.modalStore.activeStep.keepOpenUntilComplete&&this.modalStore.addCurrentModalToStack(),this.modalStore.locked=!0,void 0===o&&(o="firstSubStep"in t?t.firstSubStep():0),"function"==typeof t.component&&await t.component(),await(null==(i=t.beforeShow)?void 0:i.call(t)),await(null==(n=null==(r=null==(s=t.subSteps)?void 0:s[o])?void 0:r.beforeShow)?void 0:n.call(r)),this.modalStore.activeStep=t,this.modalStore.activeSubStepIndex=o,this.updateStepActiveProperties(this.modalStore.activeStep,{activeSubStepIndex:this.modalStore.activeSubStepIndex}))},async handleSubStepCompletion(){var t,e,o,a,i,s;const r=this.activeSubStep,n=this.modalStore.activeSubStepIndex,l=!!(this.modalStore.activeStep.subSteps&&this.modalStore.activeSubStepIndex<this.modalStore.activeStep.subSteps.length-1);l&&(this.modalStore.activeSubStepIndex++,await(null==(o=null==(e=null==(t=this.modalStore.activeStep.subSteps)?void 0:t[this.modalStore.activeSubStepIndex])?void 0:e.beforeShow)?void 0:o.call(e)),this.updateStepActiveProperties(this.modalStore.activeStep,{activeSubStepIndex:this.modalStore.activeSubStepIndex})),await(null==(a=null==r?void 0:r.onLeave)?void 0:a.call(r,c.Completed)),await(null==(s=(i=this.modalStore.activeStep).onSubStepComplete)?void 0:s.call(i,{activeSubStep:r,activeSubStepIndex:n,nextSubStepIndex:this.modalStore.activeSubStepIndex,nextSubStep:this.activeSubStep,hasSubStepsRemaining:l})),l||await this.handleStepCompletion()},async handleStepCompletion({state:t}={state:c.Completed}){var e,o,a;const i=this.modalStore.activeStep,s=this.activeSubStep;if(t in u){const o=u[t];await(null==(e=i[o])?void 0:e.call(i,{activeSubStep:this.activeSubStep,activeSubStepIndex:this.modalStore.activeSubStepIndex}))}this.updateStepActiveProperties(i,{deactivate:!0}),this.modalStore.locked=!1,await(null==(o=null==s?void 0:s.onLeave)?void 0:o.call(s,t)),await(null==(a=i.onLeave)?void 0:a.call(i,t));const r=this.modalStore.getModalFromStack();r&&await this.showModal(r[0],{subStepIndex:r[1]}),i.id===this.modalStore.activeStep.id&&(this.modalStore.activeStep={})},showUpgrade(){var t,e;null==(e=(t=this.modalStore.activeStep).onUpgradeClick)||e.call(t),b()},dismissModal(){this.handleStepCompletion({state:c.Dismissed})},handleModalError(){this.handleStepCompletion({state:c.Errored}),this.$set(this.modalStore.activeStep,"error",!0)},goToSubStep(t){this.modalStore.activeSubStepIndex=t,this.updateStepActiveProperties(this.modalStore.activeStep,{activeSubStepIndex:this.modalStore.activeSubStepIndex})},getPlanInfo:()=>v.get("account/plans",{timeout:8e3,params:{exp:!0}}).then((({data:t})=>{if(!t)throw new Error("no data for plans");return localStorage.getItem("sale:force")&&o()&&(t.personal.sales={yearly:a}),t.personal})),async afterModalEnter(){await i(),this.transitionDisabled=!1},afterModalLeave(){this.setActiveStepTransition(),this.resetActiveSubStepIndex(),Object.keys(this.modalStore.activeStep).length||m.models.notificationManager.displayPendingMessages()},setActiveStepTransition(){this.transitionDuration=this.modalStore.activeStep.transitionDuration,this.transitionName=this.modalStore.activeStep.transitionName??"fade"},checkParamsAndShowModal(){const t=s.getAndRemoveParamsFromUrl("modalStep","modalSubStepIndex");if(!t.modalStep||!(t.modalStep in d))return;const e=d[t.modalStep];e in l&&this.showModal(l[e],{subStepIndex:Number(t.modalSubStepIndex??"0")})},resetActiveSubStepIndex(){this.modalStore.stepActive||(this.modalStore.activeSubStepIndex=0)}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{directives:[{name:"show",rawName:"v-show",value:!t.modalStore.hidden,expression:"!modalStore.hidden"}],staticClass:"modal-container",attrs:{"data-test":"modal-container"},on:{mousedown:function(t){t.stopPropagation()},mouseup:function(t){t.stopPropagation()}}},[e("transition",t._b({attrs:{mode:"out-in"},on:{"after-enter":t.afterModalEnter,"after-leave":t.afterModalLeave}},"transition",t.transitionProps,!1),[t.modalStore.stepActive?e(t.modalStore.activeStep.component,t._b({key:t.modalStore.activeStep.transitionOnSubStepChange?`${t.modalStore.activeStep.id}-${t.modalStore.activeSubStepIndex}`:t.modalStore.activeStep.id,tag:"component",staticClass:"modal-component",class:t.modalStore.activeStep.customClasses,on:{error:t.handleModalError,dismiss:t.dismissModal,stepComplete:t.handleStepCompletion,subStepComplete:t.handleSubStepCompletion,goToSubStep:t.goToSubStep,upgrade:t.showUpgrade}},"component",t.componentProps,!1)):t._e()],1),e("transition-group",t._b({},"transition-group",t.transitionGroupProps,!1),[t.modalStore.activeStep&&t.modalStore.activeStep.customCss&&!t.modalStore.hidden?e("v-style",{key:t.modalStore.activeStep.id},[t._v(t._s(t.modalStore.activeStep.customCss))]):t._e(),t.activeSubStep&&t.activeSubStep.customCss&&!t.modalStore.hidden?e("v-style",{key:t.modalStore.activeSubStepIndex},[t._v(t._s(t.activeSubStep.customCss))]):t._e()],1)],1)}),[],!1,null,"96799d16").exports;if(!m.modals){const t=new r({render:()=>n(f)}).$mount();document.querySelector(".apps .full").appendChild(t.$el)}