import{r as t,b as e,i as a,L as o}from"./Logger-CErMjlBd.js";const s="user:migration:",r={TIME:s+"time",FOCUS:s+"focus",ONBOARDING:s+"onboarding"},n=6e4,m=100,c={REGISTER:"register",FOCUS:"focus",ONBOARDING:"onboarding"},i="tab.legacyUserMigration",u="syncedData:migration:lastAttempted",g="syncedData:migration:successful";var d={URL_ROOT_API:"https://api.momentumdash.com/",URL_ROOT_ACCOUNT:"https://account.momentumdash.com/",URL_ROOT_MARKETING:"https://www.momentumdash.com/",VERSION:"2.25.1",PLATFORM:"Chrome",PARTNER_ID:0,MODE:"production"};async function l({context:s,tabId:r,loggerName:n},m){try{const o=await async function(o){const s=localStorage.getObject("momentum-customization-1").displayname,r=await t({method:"post",url:d.URL_ROOT_API+"user:migrateLegacy?canceled=true",data:{name:s},headers:{"X-Momentum-Version":d.VERSION,"X-Momentum-ClientDate":e(),"X-Momentum-ClientId":localStorage.getItem("client_uuid"),"X-Momentum-TabId":o}});if(a(null==r?void 0:r.status)&&r.data)return localStorage.setItem("token",r.data.token),localStorage.setItem("token_uuid",r.data.token_uuid),localStorage.setItem("unregistered",!0),r.data.settings;throw new Error("Legacy Migration Request Failed",r)}(r);m({success:!0,settings:o})}catch(i){if(console.error(i),n){new o(n).error(s+" migration error",{errorMessage:i.message,stack:i.stack,phase:c.REGISTER})}m({success:!1,error:i})}}export{r as L,u as M,i as a,n as b,m as c,c as d,g as e,l as m};