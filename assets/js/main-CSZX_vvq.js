const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/FocusModeHoverDropdown-S35i8KJT.js","assets/js/BaseDropdownContent-Nf5O_5Ty.js","assets/js/constants-CALDQiUE.js","assets/js/index-DY0DW88M.js","assets/js/Logger-CErMjlBd.js","assets/js/style-cpFB66wV.js","assets/css/style-CrTXrpPu.css","assets/js/DataSyncService-BnTv72BN.js","assets/js/index-CV0q_XsJ.js","assets/js/_plugin-vue2_normalizer-DeUNqxFl.js","assets/css/BaseDropdownContent-BVfvvT0B.css","assets/js/focus-mode-fill-qvXwryrv.js","assets/js/sounds-DyeiSxA-.js","assets/js/tabs-B0xiyzOS.js","assets/js/links-B3EjXGZU.js","assets/js/pomodoro-circle-CecfhCBZ.js","assets/css/FocusModeHoverDropdown-CFs4UYpX.css","assets/js/FocusModeFocusingView-DiQMqXXY.js","assets/js/BaseIcon-Bb2ZVMd4.js","assets/js/dynamic-import-helper-DIl3ayLm.js","assets/css/BaseIcon-Bkqy2Cka.css","assets/js/state-odjm2uKU.js","assets/js/LocalStorageStoreSyncedItem-kVGQtJA7.js","assets/js/v-style-8O6T7tyx.js","assets/js/flashMessageMixin--L52atuB.js","assets/js/globalKeyEventManager-Dw4DvSNm.js","assets/js/VueBase-EULQJZ9I.js","assets/js/_commonjsHelpers-B3K3fdV-.js","assets/js/ClickOutside-DCLvi2fj.js","assets/js/pinia-bvFMkYCE.js","assets/js/portal-vue.esm-BDTnR1AQ.js","assets/js/PomodoroTimers-CqOVDo7T.js","assets/js/settings-rA0qDzbq.js","assets/js/reactiveCustomization-B8WwDagp.js","assets/js/focus-mode-TgjJstn5.js","assets/js/AppContainer-Dy_GGrtc.js","assets/js/showAnyway-CR--Ivye.js","assets/js/useAllComponentsMounted-RTvHVD2I.js","assets/css/AppContainer-Okwrv5EP.css","assets/js/index-DM3Q2nkp.js","assets/js/persistStore-CE5fTtZd.js","assets/js/AppDash-CNft_R_U.js","assets/js/constants-KuzCZNtH.js","assets/css/AppDash-Bgvh0Jie.css","assets/js/focusModeViewState-PmqXWVgL.js","assets/js/ViewState-DzCxxm0h.js","assets/js/appZStack-B9FmF8l5.js","assets/js/login-ByohQG_J.js","assets/js/authService-CEyg9tcu.js","assets/js/auth-HiWjNVol.js","assets/js/legacyUserMigration-eNETLKah.js","assets/js/enums-C0TfsRui.js","assets/js/migrateLegacyUserMessageHandler-HceDQnYT.js","assets/js/onboarding-Cm39YS_P.js","assets/js/promisifiedChrome-B6V9WMyE.js","assets/js/modal-CXkRDJ21.js","assets/css/FocusModeFocusingView-Bt48pUjZ.css"])))=>i.map(i=>d[i]);
import"./VueBase-EULQJZ9I.js";import{_ as e}from"./style-cpFB66wV.js";import t from"./focus-mode-TgjJstn5.js";import o from"./AppContainer-Dy_GGrtc.js";import{u as s,a as i}from"./index-DM3Q2nkp.js";import{A as a}from"./AppDash-CNft_R_U.js";import{useFocusModeViewStateStore as n}from"./focusModeViewState-PmqXWVgL.js";import{F as r,C as c,A as u,I as d,d as l}from"./state-odjm2uKU.js";import{r as p,H as f,A as h,z as M,d as w,a as g,w as S,n as v,V as F,h as y}from"./index-DY0DW88M.js";import{a as A}from"./appZStack-B9FmF8l5.js";import{s as b}from"./showAnyway-CR--Ivye.js";import{w as V}from"./login-ByohQG_J.js";import{p as _}from"./promisifiedChrome-B6V9WMyE.js";import{e as T}from"./DataSyncService-BnTv72BN.js";import{a as C}from"./modal-CXkRDJ21.js";import{U as D}from"./enums-C0TfsRui.js";import{g as I}from"./settings-rA0qDzbq.js";import{n as j}from"./_plugin-vue2_normalizer-DeUNqxFl.js";const O=new class{constructor(){this.fullscreen=p(!!document.fullscreenElement),this.fullscreenModeAvailable=document.fullscreenEnabled,document.addEventListener("fullscreenchange",(()=>{this.fullscreen.value=!!document.fullscreenElement}))}async enterFullscreen(e){if(this.fullscreenModeAvailable){if(e){const e=await _.tabs.getCurrent();if(!e)return;await _.windows.create({tabId:e.id}),await f(100)}await document.body.requestFullscreen({navigationUI:"hide"})}}async exitFullscreen(){this.fullscreenModeAvailable&&await document.exitFullscreen()}async toggleFullscreen(e,t){this.fullscreen.value?await this.exitFullscreen():await this.enterFullscreen(e),h.capture((this.fullscreen.value?"enter":"leave")+" fullscreen",{feature:t})}},E=new h({feature:"focus mode"});const L=j({name:"FocusMode",components:{AppContainer:o,AppDash:a,FocusModeHoverDropdown:()=>e((()=>import("./FocusModeHoverDropdown-S35i8KJT.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])),FocusModeFocusingView:()=>e((()=>import("./FocusModeFocusingView-DiQMqXXY.js")),__vite__mapDeps([17,5,6,3,4,18,19,9,20,7,21,22,23,24,25,26,27,28,29,30,8,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56]))},setup(){const e=n(),t=s();return M("store",t),M("viewStateStore",e),{apps:i,FocusModeView:r,focusModeViewStateStore:e,focusModeSessionStore:t,CAPACITY_LIMIT_MS_ALLOWED_PER_DAY:c,showAnyway:b,capacityLimitInterval:null,APP_TRANSITION_TIME:u}},data:()=>({hoverDropdownOpen:!1,instantFocusingViewTransition:!1,focusModeCancelled:!1}),computed:{tabFocused:()=>w.tabFocused,activatedApps(){return Object.keys(this.apps).filter((e=>"pomodoro"===e||this.settingsWithDefaults.apps[e].enabled&&!this.apps[e].unsupported)).map((e=>({key:e,...this.apps[e]})))},focusing(){return this.focusModeViewStateStore.currentlyFocusing},focusingOrCelebrationViewActive(){return this.focusModeViewStateStore.currentlyFocusing||this.focusModeViewStateStore.currentFocusModeView===r.Celebration},settingsWithDefaults:()=>I()},watch:{"focusModeViewStateStore.currentFocusModeView"(e){e===r.Transition&&this.loadPlusApps()},"focusModeSessionStore.loaded":{handler(e){if(e){const e=async()=>{await this.focusModeViewStateStore.resumeFocusModeAfterTabLoad(),this.setCapacityLimitFocusModeTimeout()};this.focusModeSessionStore.shouldAutoDisable&&this.$plus&&"true"!==localStorage.getItem("pomodoro-running")?(this.stopFocusMode(!0),V().then((async()=>{T.$emit("flashMessage",{icon:t,message:d,button:{text:"Jump back in",action:()=>this.startFocusMode("inactivity flash message")}})}))):this.focusModeSessionStore.focusModeActive&&(this.loadPlusApps(),V().then((async()=>{var e;for(const t of this.activatedApps){(null==(e=t.shouldEnableOnResume)?void 0:e.call(t))&&t.enable(this.focusModeSessionStore.appActivationData[t.key])}await this.triggerFocusModeStartedEventAfterDelay()})),this.instantFocusingViewTransition=!0,w.disableAppTransitions=!0,Promise.race([g.delay(1e3),V()]).then(e)),this.unwatch=S((()=>this.focusModeSessionStore.focusModeActive),(async t=>{t?await e():t||this.focusModeViewStateStore.currentFocusModeView===r.Idle||(this.focusModeViewStateStore.currentFocusModeView!==r.Celebration&&(this.instantFocusingViewTransition=!0,await v()),await this.focusModeViewStateStore.stopFocusMode(),m.tourActive&&m.trigger("modal:close"))})),m.widgetManager.appReady("focus-mode")}},immediate:!0},tabFocused:{handler(){this.setCapacityLimitFocusModeTimeout()},immediate:!0},settingsWithDefaults(){this.onSettingsUpdate()}},mounted(){m.on("globalEvent:click",this.focusModeSessionStore.refreshLastInteraction),m.on("focusMode:start",this.startFocusMode),m.on("focusMode:stop",this.stopFocusMode),m.on("focusMode:cancel",this.cancelFocusMode),l.currentValue||m.widgetManager.appReady("focus-mode"),T.$emit("focusMode:ready")},destroyed(){var e;m.off("globalEvent:click",this.focusModeSessionStore.refreshLastInteraction),m.off("focusMode:start",this.startFocusMode),m.off("focusMode:stop",this.stopFocusMode),m.off("focusMode:cancel",this.cancelFocusMode),null==(e=this.unwatch)||e.call(this)},methods:{async loadPlusApps(){this.$plus||(g.isSafari()||g.isPwa()||await m.widgetManager.loadWidget("tabs"),g.isPwa()||await m.widgetManager.loadWidget("site-blocker"),await m.widgetManager.loadWidget("sounds"))},openHoverDropdown(){1===this.focusModeSessionStore.start&&0===A.stack.length&&(this.hoverDropdownOpen=!0,m.trigger("focusMode:hover:toggle",!0))},closeHoverDropdown(){this.hoverDropdownOpen=!1,m.trigger("focusMode:hover:toggle",!1)},async triggerFocusModeStartedEventAfterDelay(){await g.delay(u),await g.doubleRaf(),m.trigger("focusMode:started")},async startFocusMode(e){var t,o;if(!this.focusing)if(!this.$plus&&this.focusModeSessionStore.isOverCapacityLimit)this.openUpsell();else{if(this.closeHoverDropdown(),m.trigger("focusMode:starting"),await this.focusModeViewStateStore.startFocusModeWithCancelPeriod(),this.focusModeCancelled)return this.focusModeCancelled=!1;await this.focusModeViewStateStore.finalizeStartFocusModeAfterCancelPeriod();const s={};for(const e of this.activatedApps)s[e.key]=await(null==(o=(t=i[e.key]).enable)?void 0:o.call(t));await this.focusModeSessionStore.startAndSaveFocusMode(s),E.capture("focus mode start",{enabled_apps:this.activatedApps.map((e=>e.key)),source:e}),await this.triggerFocusModeStartedEventAfterDelay()}},async cancelFocusMode(){this.focusModeCancelled=!0,await this.focusModeViewStateStore.cancelFocusModeStart()},async stopFocusMode(e=!1){var t,o;m.trigger("focusMode:stopping"),await(null==(o=(t=i.pomodoro).disable)?void 0:o.call(t,{}));const s=async()=>{await g.delay(u),await this.focusModeSessionStore.disableAppsBeforeStop(e)};e?s():await Promise.allSettled([s(),this.focusModeViewStateStore.celebrateFocusMode()]),O.fullscreen.value&&await O.exitFullscreen(),await this.focusModeSessionStore.stopAndSaveFocusMode();const a=this.activatedApps.map((e=>e.key)),n=Math.round((this.focusModeSessionStore.stop-this.focusModeSessionStore.start)/1e3);E.capture("focus mode stop",{enabled_apps:a,seconds_since_start:n,stopped_by_inactivity:e}),this.setCapacityLimitFocusModeTimeout(),m.trigger("focusMode:stopped")},setCapacityLimitFocusModeTimeout(){clearTimeout(this.capacityLimitInterval),this.$plus||this.focusing&&(this.capacityLimitInterval=setTimeout((async()=>{var e,t,o,s,a,n;if(this.focusing){if(!this.focusModeSessionStore.isOverCapacityLimit)return this.setCapacityLimitFocusModeTimeout();await(null==(t=(e=i.pomodoro).disable)?void 0:t.call(e,{})),await(null==(s=(o=i.soundscapes).disable)?void 0:s.call(o,{})),await(null==(n=(a=i.siteBlocker).disable)?void 0:n.call(a,{})),w.tabFocused&&(await this.stopFocusMode(),this.openUpsell())}}),Math.max(this.focusModeSessionStore.msUntilOverCapacityLimit+100,500)))},openUpsell(){C(D.FOCUS_MODE,"dash")},onSettingsUpdate(){this.focusing&&(this.focusModeViewStateStore.resetFocusingStyleVariables(),this.focusModeViewStateStore.setFocusingStyleVariables())},resetInstantTransition(){this.instantFocusingViewTransition=!1}}},(function(){var e,t=this,o=t._self._c;return o("app-container",{class:{focusing:t.focusingOrCelebrationViewActive},attrs:{"app-name":"focus-mode","visible-setting":"focusModeVisible","data-test":"focus-mode"}},[o("transition",{attrs:{name:"focus-mode-fade-deep",duration:t.instantFocusingViewTransition?0:t.APP_TRANSITION_TIME},on:{"after-enter":t.resetInstantTransition,"after-leave":t.resetInstantTransition}},[t.focusingOrCelebrationViewActive&&t.showAnyway.includes("focus-mode")?o("focus-mode-focusing-view",{on:{openUpsell:t.openUpsell,stopFocusMode:t.stopFocusMode}}):t._e()],1),t.focusingOrCelebrationViewActive?t._e():[o("app-dash",{ref:"focusModeAppToggle",attrs:{icon:"icon/apps/focus-mode",label:"Focus","data-test":"focus-mode-top-left-app-toggle"},on:{mouseenter:t.openHoverDropdown,mouseleave:t.closeHoverDropdown,click:function(e){return t.startFocusMode("dash icon")}}}),o("transition",{attrs:{name:"slide-down-fade-blurred",duration:200}},[t.hoverDropdownOpen?o("focus-mode-hover-dropdown",{attrs:{target:null==(e=t.$refs.focusModeAppToggle)?void 0:e.$el}}):t._e()],1)]],2)}),[],!1,null,"0d89a0d0").exports,P=document.querySelector(".region.top-left"),k=document.createElement("div");P&&P.prepend(k),new F({render:()=>y(L)}).$mount(k);const x=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{O as f,x as m};