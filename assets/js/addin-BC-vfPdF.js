import{S as t}from"./settingsViewState-ZEr74HQm.js";import{e as n}from"./DataSyncService-BnTv72BN.js";import{h as e}from"./handlebarLoader-xbtIzd6B.js";import"./ViewState-DzCxxm0h.js";import"./index-DY0DW88M.js";import"./Logger-CErMjlBd.js";import"./style-cpFB66wV.js";import"./appZStack-B9FmF8l5.js";var a="https://api.momentumdash.com/";const o={1:function(t,n,e,a,o){var i,s,l=null!=n?n:t.nullContext||{},r=t.hooks.helperMissing,c="function",d=t.escapeExpression,p=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'            <li data-board-id="'+d(typeof(s=null!=(s=p(e,"id")||(null!=n?p(n,"id"):n))?s:r)===c?s.call(l,{name:"id",hash:{},data:o,loc:{start:{line:5,column:31},end:{line:5,column:37}}}):s)+'" class="connect-board">\n                <div class="u--flex-grow">\n                    '+(null!=(i=p(e,"if").call(l,null!=n?p(n,"icon_url"):n,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:7,column:20},end:{line:7,column:122}}}))?i:"")+'\n                    <span class="provider-title">'+d(typeof(s=null!=(s=p(e,"board_name")||(null!=n?p(n,"board_name"):n))?s:r)===c?s.call(l,{name:"board_name",hash:{},data:o,loc:{start:{line:8,column:49},end:{line:8,column:63}}}):s)+'</span>\n                </div>\n                <div class="settings-list-right">\n                    <div class="status"></div>\n                </div>\n            </li>\n'},2:function(t,n,e,a,o){var i,s=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<span class="board-icon"><img class="todo-list-icon" src="'+t.escapeExpression("function"==typeof(i=null!=(i=s(e,"icon_url")||(null!=n?s(n,"icon_url"):n))?i:t.hooks.helperMissing)?i.call(null!=n?n:t.nullContext||{},{name:"icon_url",hash:{},data:o,loc:{start:{line:7,column:94},end:{line:7,column:106}}}):i)+'"></span>'},compiler:[8,">= 4.3.0"],main:function(t,n,e,a,o){var i,s,l=null!=n?n:t.nullContext||{},r=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<div class="section-organization">\n    <h5>'+t.escapeExpression("function"==typeof(s=null!=(s=r(e,"organization_name")||(null!=n?r(n,"organization_name"):n))?s:t.hooks.helperMissing)?s.call(l,{name:"organization_name",hash:{},data:o,loc:{start:{line:2,column:8},end:{line:2,column:29}}}):s)+'</h5>\n    <ul class="settings-list provider-list add-provider">\n'+(null!=(i=r(e,"each").call(l,null!=n?r(n,"boards"):n,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:4,column:8},end:{line:14,column:17}}}))?i:"")+"    </ul>\n</div>\n"},useData:!0},i={1:function(t,n,e,a,o){var i,s,l=null!=n?n:t.nullContext||{},r=t.hooks.helperMissing,c="function",d=t.escapeExpression,p=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'\t\t<li data-board-id="'+d(typeof(s=null!=(s=p(e,"id")||(null!=n?p(n,"id"):n))?s:r)===c?s.call(l,{name:"id",hash:{},data:o,loc:{start:{line:4,column:21},end:{line:4,column:27}}}):s)+'" class="has-board-id">\n\t\t\t<span class="u--flex-grow">\n\t\t\t\t<span class="board-icon">'+(null!=(i=p(e,"if").call(l,null!=n?p(n,"icon_url"):n,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:6,column:29},end:{line:6,column:99}}}))?i:"")+'<span class="provider-title">'+d(typeof(s=null!=(s=p(e,"board_name")||(null!=n?p(n,"board_name"):n))?s:r)===c?s.call(l,{name:"board_name",hash:{},data:o,loc:{start:{line:6,column:128},end:{line:6,column:142}}}):s)+'</span></span>\n\t\t\t</span>\n\t\t\t<span class="settings-list-right">\n\t\t\t\t<span class="provider-actions">\n\t\t\t\t\t<span class="action provider-action disconnect-board">Disconnect</span>\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t</li>\n'},2:function(t,n,e,a,o){var i,s=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<img class="todo-list-icon" src="'+t.escapeExpression("function"==typeof(i=null!=(i=s(e,"icon_url")||(null!=n?s(n,"icon_url"):n))?i:t.hooks.helperMissing)?i.call(null!=n?n:t.nullContext||{},{name:"icon_url",hash:{},data:o,loc:{start:{line:6,column:78},end:{line:6,column:90}}}):i)+'">'},compiler:[8,">= 4.3.0"],main:function(t,n,e,a,o){var i,s,l=null!=n?n:t.nullContext||{},r=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return"<h5>"+t.escapeExpression("function"==typeof(s=null!=(s=r(e,"organization_name")||(null!=n?r(n,"organization_name"):n))?s:t.hooks.helperMissing)?s.call(l,{name:"organization_name",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:25}}}):s)+'</h5>\n<ul class="settings-list provider-list connected-providers">\n'+(null!=(i=r(e,"each").call(l,null!=n?r(n,"boards"):n,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:3,column:1},end:{line:14,column:10}}}))?i:"")+"</ul>\n"},useData:!0},s=Object.assign({"./views/main.js":e=>{e.views.Main=m.settingsAddin.views.SettingsPanel.extend({attributes:{id:"settings-trello",class:"settings-view settings-trello"},template:e.templates.main,panelid:"trello",events:{"click .connect-board":"connectBoard","click .disconnect-board":"disconnectBoard","click #connect-button":"connectTodoProvider","click .toggle-form":"toggleForm","click .back":"clickedBack"},initialize:function(){var t=this;this.collection=new m.collect.Settings,this.collection.url=a+"settings/todo/providers/5",this.collection.parse=function(n){return t.collection.lastResponse=n,t.collection.organizations=_.chain(t.collection.lastResponse.available_boards).map((function(t){if(t.organization_id)return{id:t.organization_id,name:t.organization_name}})).uniq((function(t){return t?t.id:null})).omit(_.isUndefined).omit(_.isNull).sortBy("name").value(),n.connected_boards},this.listenTo(this.collection,"reset",this.collectionReset),this.listenTo(m.models.customization,"change",this.customizationChanged),this.refreshData()},render:function(){return this.$el.html(this.template({})),this.$connect=this.$(".settings-connect")[0],this.$settingsTrello=this.$(".settings-trello")[0],this.$("#connected-boards-header").hide(),this},collectionReset:function(){this.populateConnectedBoards(),this.populateAvailableBoards()},refreshData:function(){this.collection.fetch({reset:!0})},disconnectBoard:function(t){t&&(t.stopPropagation(),t.preventDefault());var n=$(t.delegatedTarget).closest(".has-board-id"),e=n.data("board-id");if(e){$(t.delegatedTarget).hide(),n.find(".status").html('<span class="loading disconnecting-board"><i class="loading-icon"></i>Disconnecting...</span>');var o=this;this.authAttempts=0;var i=a+"settings/todo/providers/5",s={operation:"disconnect_board",board_id:e};$.ajax({type:"POST",contentType:"application/json",url:i,data:JSON.stringify(s)}).done((function(t){if(t.status&&"authRequired"==t.status){if(t.authorizationUrl&&o.authAttempts<2){o.authAttempts++;var n=t.winWidth?t.winWidth:600,e=t.winHeight?t.winHeight:510,a=t.windowFeatures?t.windowFeatures:"titlebar,resizable,toolbar,status",i=window.screen.width/2-n/2,s=window.screen.height/2-e/2,l=window.open(t.authorizationUrl,"MomentumAuthWindow",a+",left="+i+",top="+s+",width="+n+",height="+e),r=setInterval((function(){l.closed&&(clearInterval(r),o.$connect.hide(),o.$settingsTrello.css("display","block"),o.$el.find(".pop-body").scrollTop(0),o.refreshData(),m.commandManager.execute("settings.todo.provider.change",null,{provider_id:"1"}))}),250)}}else t.status&&"success"==t.status&&m.commandManager.execute("settings.todo.provider.change",null,{provider_id:"1"}),o.$el.find(".pop-body").scrollTop(0),o.refreshData()})).fail((function(){o.$el.find(".pop-body").scrollTop(0),o.refreshData()}))}},connectBoard:function(t){t&&(t.stopPropagation(),t.preventDefault());var n=$(t.delegatedTarget).data("board-id");if(n){$(t.delegatedTarget).find(".status").html('<span class="loading"><i class="loading-icon"></i>Connecting...</span>');var e=this;this.authAttempts=0;var o=a+"settings/todo/providers/5",i={operation:"connect_board",board_id:n};$.ajax({type:"POST",contentType:"application/json",url:o,data:JSON.stringify(i)}).done((function(t){if(t.status&&"authRequired"==t.status){if(t.authorizationUrl&&e.authAttempts<2){e.authAttempts++;var n=t.winWidth?t.winWidth:600,a=t.winHeight?t.winHeight:510,o=t.windowFeatures?t.windowFeatures:"titlebar,resizable,toolbar,status",s=window.screen.width/2-n/2,l=window.screen.height/2-a/2,r=window.open(t.authorizationUrl,"MomentumAuthWindow",o+",left="+s+",top="+l+",width="+n+",height="+a),c=setInterval((function(){r.closed&&(clearInterval(c),e.$connect.hide(),e.$settingsTrello.css("display","block"),e.$el.find(".pop-body").scrollTop(0),e.refreshData(),m.commandManager.execute("settings.todo.provider.change",null,{provider_id:"5-"+i.board_id}))}),250)}}else t.status&&"success"==t.status&&(e.$el.find(".pop-body").scrollTop(0),e.refreshData(),m.commandManager.execute("settings.todo.provider.change",null,{provider_id:"5-"+i.board_id}))})).fail((function(){}))}},clickedBack:function(e){e&&(e.stopPropagation(),e.preventDefault()),n.$emit("settings:open",t.Todo)},populateConnectedBoards:function(){var t=$(this.$("#connected-providers")[0]),n=e.templates.boards_connected({organization_name:"",boards:this.collection.toJSON()});t.html(n),this.collection.length<1?(this.$(".show-form").hide(),this.$("#connected-boards-header").hide(),this.$(".form").css("display","block"),this.$(".empty").css("display","block"),t.hide()):(t.css("display","block"),this.$(".empty").hide(),this.$("#connected-boards-header").css("display","block"))},populateAvailableBoards:function(){var t,n=this,a=$(this.$("#available-providers")[0]);a.html("");var o=_.chain(n.collection.lastResponse.available_boards).where({starred:!0}).sortBy("board_name").value();o&&o.length>0&&(t=e.templates.boards_available({organization_name:"Starred Boards",boards:o}),a.append(t));var i=_.chain(n.collection.lastResponse.available_boards).filter((function(t){return null!=t.dateLastActivity})).sortBy("dateLastActivity").reverse().first(5).value();i&&i.length>0&&(t=e.templates.boards_available({organization_name:"Recent Boards",boards:i}),a.append(t));var s=_.chain(n.collection.lastResponse.available_boards).filter((function(t){return!t.organization_id})).sortBy("board_name").value();s&&s.length>0&&(t=e.templates.boards_available({organization_name:"My Boards",boards:s}),a.append(t)),_.each(n.collection.organizations,(function(t){var o=_.chain(n.collection.lastResponse.available_boards).where({organization_id:t.id}).sortBy("board_name").value();if(o&&o.length>0){var i=e.templates.boards_available({organization_name:t.name,boards:o});a.append(i)}})),0==this.collection.lastResponse.available_boards.length?(this.$(".all-connected").css("display","block"),this.$("#available-providers").hide()):(this.$(".all-connected").hide(),this.$("#available-providers").css("display","block"))},toggleForm:function(){this.$(".show-form").mToggle("inline-block"),this.$(".form").mToggle("block")}})}}),l=Object.assign({"./templates/boards_available.hbs":o,"./templates/boards_connected.hbs":i,"./templates/main.hbs":{compiler:[8,">= 4.3.0"],main:function(t,n,e,a,o){return'<div class="setting-panel">\n<span class="icon-wrapper back" title="Back"><i class="icon icon-left"></i></span>\n<div class="settings-detail-header">\n\t<h3><img src="https://content.momentumdash.com/logos/trello-blue-128.png"> Trello</h3>\n\t<p class="description">Choose the boards you\'d like to use in Momentum</p>\n</div>\n\n<div>\n\t<h4 id="connected-boards-header">Connected boards</h4>\n\t<div id="connected-providers" class="provider-list-wrapper"><span class="loading"><i class="loading-icon"></i>Loading...</span></div>\n</div>\n\n<p class="board-empty empty">No Trello boards connected yet. Add a board to get started!</p>\n\n<button class="button show-form toggle-form">Add board</button>\n\n<div class="form" style="display: none;">\n\t<div class="boards">\n\t\t<h4>Add boards</h4>\n\t\t<p class="all-connected">Congratulations, you\'re fully connected!</p>\n\t\t<div id="available-providers" class="provider-list-wrapper"><span class="loading"><i class="loading-icon"></i>Loading...</span></div>\n\t</div>\n\t<div class="suggest-integration">\n\t\t<h5>Suggestions for this integration?</h5>\n\t\t<p>\x3c!--We\'d love to hear what other services you use.<br>--\x3e\n\t\t\t<a href="https://momentumdash.com/contact">Make a suggestion</a></p>\n\t</div>\n</div>\n\n<div class="settings-connect"></div>\n</div>\n'},useData:!0}});let r=null;const c=async()=>{if(r)return await r;r=new Promise((a=>e({addin:"c61b7775-7ab8-443a-a6b7-c8c8de6fc755",dependencies:["settings"]},s,l,(e=>{m.commandManager&&m.commandManager.registerCommand("todo.trello.config",(function(){e.styleLoaded||(e.styleLoaded=!0,e.styles.style()),m.views.SettingsTrello=e.views.Main,n.$emit("settings:open",t.Trello)})),a()}))))};export{c as loadSettingsTrelloAddin};