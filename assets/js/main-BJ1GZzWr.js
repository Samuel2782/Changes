import"./VueBase-EULQJZ9I.js";import o from"./AppContainer-Dy_GGrtc.js";import{I as t,r as e,n as s,G as i,A as a,V as n,h as r}from"./index-DY0DW88M.js";import{B as d}from"./BaseDropdown-CJtlJqHX.js";import{B as c}from"./BaseDropdownOption-Bn6J2nm1.js";import{B as p}from"./BaseDropdownDivider-Bay0Demn.js";import l from"./BaseIcon-Bb2ZVMd4.js";import{A as u}from"./AppDash-CNft_R_U.js";import{A as h}from"./AppDashOverlay-CBdBpUlV.js";import{a as g}from"./modal-CXkRDJ21.js";import{U as v}from"./enums-C0TfsRui.js";import f from"./AppHeader-DINik7Wl.js";import{A as w}from"./constants-KuzCZNtH.js";import{n as b}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import{B as k}from"./BaseDropdownText-CSYTEDLS.js";import{e as A}from"./DataSyncService-BnTv72BN.js";import{S as D}from"./settingsViewState-ZEr74HQm.js";import{T as y}from"./ToggleSwitch-DSwcb4Go.js";import{persistent as _,computed as j}from"./reactiveCustomization-B8WwDagp.js";import{g as C}from"./experiments-D9-xSE76.js";import"./_commonjsHelpers-B3K3fdV-.js";import"./ClickOutside-DCLvi2fj.js";import"./pinia-bvFMkYCE.js";import"./portal-vue.esm-BDTnR1AQ.js";import"./showAnyway-CR--Ivye.js";import"./useAllComponentsMounted-RTvHVD2I.js";import"./Logger-CErMjlBd.js";import"./style-cpFB66wV.js";import"./BaseDropdownContent-Nf5O_5Ty.js";import"./constants-CALDQiUE.js";import"./index-CV0q_XsJ.js";import"./icon-ellipsis-D7nTOXaQ.js";import"./dynamic-import-helper-DIl3ayLm.js";import"./SmoothReflow-Cnw3bIxd.js";import"./ResizeSensor-ZXOsDHeC.js";import"./AppHeaderControl-CYSrwe76.js";import"./icon-close-DRlspKs3.js";import"./ViewState-DzCxxm0h.js";import"./appZStack-B9FmF8l5.js";const B=b(t({name:"BaseDropdownHeader",components:{AppHeader:f},setup:()=>({AppHeaderCloseOn:w})}),(function(){var o=this,t=o._self._c;return o._self._setupProxy,t("app-header",{staticClass:"base-dropdown-header",attrs:{"show-close-button-on":o.AppHeaderCloseOn.None},scopedSlots:o._u([{key:"left",fn:function(){return[o._t("left")]},proxy:!0},{key:"right",fn:function(){return[o._t("right")]},proxy:!0}],null,!0)})}),[],!1,null,"56182732").exports,x=new a({feature:"photos"});function S(){const o=m.models.backgroundManager.getActiveItem();return o?{id:o.get("_id")||o.get("id"),title:o.get("title"),source:o.get("source"),fav:o.get("is_favorite"),url:o.get("sourceUrl"),unsplash:o.get("sourceUrl")&&o.get("sourceUrl").includes("unsplash"),destination:o.get("destination_name"),custom:!!o.get("isCustom")}:{}}const H=b(t({name:"BackgroundInfo",components:{ToggleSwitch:y,BaseDropdownText:k,BaseDropdownHeader:B,AppDashOverlay:h,AppDash:u,BaseIcon:l,AppContainer:o,BaseDropdownDivider:p,BaseDropdownOption:c,BaseDropdown:d},setup:()=>({settingsDropdown:e(),admireTimeoutId:void 0,debouncedHover:void 0}),data:()=>({hoveringDash:!1,dropdownActive:!1,background:S(),skipping:!1,admiring:!1}),computed:{backgroundTitle(){return this.background.title||"Untitled"},sourceText(){return this.background.source?this.$touch?`${this.backgroundTitle} by ${this.background.source}`:`By ${this.background.source}`:this.$touch?`${this.backgroundTitle}`:""},showLocation:{get(){var o;return void 0!==_.photoInfoShowLocation?j.photoInfoShowLocation:"visible"===(null==(o=C("photo_info_default_show_location"))?void 0:o.variantName)},set(o){_.photoInfoShowLocation=o,x.capture("photo location visible change",{visible:o})}}},watch:{async"background.title"(){var o;await s(),null==(o=this.settingsDropdown)||o.forceUpdateDropdownPosition()}},created(){m.models.activeBackground.on("background:successfullyLoaded",this.setActiveBackground),m.on("photoDetailsChanged",this.updatePhotoDetails),m.on("backgroundInfo:admire:start",this.admire),m.on("backgroundInfo:admire:stop",this.stopAdmire),m.on("globalEvent:windowBlur",this.stopAdmire)},mounted(){m.widgetManager.appReady("photo-info")},destroyed(){m.models.activeBackground.off("background:successfullyLoaded",this.setActiveBackground),m.off("photoDetailsChanged",this.updatePhotoDetails),m.off("backgroundInfo:admire:start",this.admire),m.off("backgroundInfo:admire:stop",this.stopAdmire),m.off("globalEvent:windowBlur",this.stopAdmire)},methods:{startHoveringAndAdmire(o){this.hoveringDash=!0,this.admireOnHover(o)},stopHoveringAndStopAdmire(){this.hoveringDash=!1,this.stopAdmire()},setActiveBackground(){this.background=S()},updatePhotoDetails(o){o.id&&o.id===this.background.id&&(o.title&&""!==o.title&&(this.background.title=o.title),o.source&&""!==o.source&&(this.background.source=o.source))},toggleFavorite(){this.background.fav=!this.background.fav,m.models.backgroundManager.toggleFavorite(this.background.fav),x.capture("photo "+(this.background.fav?"fav":"unfav"),{custom:this.background.custom})},skipBackground(){var o;if(!this.$plus)return null==(o=this.settingsDropdown)||o.closeDropdown(),g(v.PHOTOS,"dash"),void this.stopAdmire();this.skipping||(this.skipping=!0,m.models.backgroundManager.skipItem().finally((()=>{this.skipping=!1})),x.capture("photo skip",{is_paid_event:!0,custom:this.background.custom}))},clickTitle(){this.background.url&&(this.captureAndHandleCustomLocation("photo source click"),i(this.background.url))},admire(){var o;if((null==(o=document.getElementsByClassName("apps")[0])?void 0:o.classList.contains("hide-apps"))||this.admiring)return;this.admiring=!0,m.widgetManager.hideApps({exemptionSelectors:".apps .photo-info"});const t=document.getElementsByClassName("background-overlay")[0];null==t||t.classList.add("slow"),null==t||t.classList.remove("show"),x.capture("photo admire",{custom:this.background.custom})},admireOnHover(o){var t;this.$touch||(null==(t=document.getElementsByClassName("apps")[0])?void 0:t.classList.contains("hide-apps"))||(this.clearAdmireTimeout(),this.captureDebouncedHover(o),this.admireTimeoutId=setTimeout(this.admire,3e3))},captureDebouncedHover(o){const t=o.target;this.cancelDebouncedHoverCapture(),this.debouncedHover=setTimeout((()=>{t.matches(":hover")&&this.captureAndHandleCustomLocation("photo hover")}),1e3)},cancelDebouncedHoverCapture(){clearTimeout(this.debouncedHover)},stopAdmire(){if(this.clearAdmireTimeout(),this.cancelDebouncedHoverCapture(),!this.admiring||this.dropdownActive)return;this.admiring=!1,m.widgetManager.showApps();const o=document.getElementsByClassName("background-overlay")[0];null==o||o.classList.remove("slow"),null==o||o.classList.add("show")},clearAdmireTimeout(){clearTimeout(this.admireTimeoutId)},openDropdown(){var o;null==(o=this.settingsDropdown)||o.openDropdown()},closeDropdown(){var o;null==(o=this.settingsDropdown)||o.closeDropdown()},onDropdownToggle(o){this.dropdownActive=o},openSettings(){var o;null==(o=this.settingsDropdown)||o.closeDropdown(),this.stopAdmire(),A.$emit("settings:open",D.Photos)},captureAndHandleCustomLocation(o){var t;const e={custom:this.background.custom,photo_location:this.background.custom?"custom":null==(t=this.background.title)?void 0:t.toLowerCase(),location:"dash",visible:this.showLocation};x.capture(o,e)},toggleDropdown(){if(this.dropdownActive)return this.closeDropdown();this.openDropdown()},toggleShowLocation(){this.showLocation=!this.showLocation}}}),(function(){var o=this,t=o._self._c;return o._self._setupProxy,t("app-container",{directives:[{name:"click-outside",rawName:"v-click-outside",value:o.closeDropdown,expression:"closeDropdown"}],attrs:{"app-name":"photo-info","data-test":"photo-info"}},[t("app-dash",{staticClass:"photo-info-app-dash",class:{admiring:o.admiring},attrs:{icon:"icon/apps/photo-info","app-visible":o.dropdownActive},on:{click:o.toggleDropdown},nativeOn:{mouseenter:function(t){return o.startHoveringAndAdmire.apply(null,arguments)},mouseleave:function(t){return o.stopHoveringAndStopAdmire.apply(null,arguments)}},scopedSlots:o._u([{key:"icon",fn:function(){return[t("div",{staticClass:"dash-content"},[t("base-icon",{attrs:{src:"icon/apps/photo-info",size:"var(--spacing-6)"}}),o.showLocation?t("p",{attrs:{"data-test":"dash-title"}},[o._v(o._s(o.background.title||"Untitled"))]):o._e()],1)]},proxy:!0},{key:"top-overlay",fn:function(){return[t("app-dash-overlay",{directives:[{name:"click-outside",rawName:"v-click-outside",value:o.stopAdmire,expression:"stopAdmire"}],attrs:{"overflow-visible":o.dropdownActive||o.admiring||o.hoveringDash,"data-test":"photo-info-dash-overlay"},scopedSlots:o._u([{key:"overflow-content",fn:function(){return[t("div",{staticClass:"title",attrs:{"data-test":"title"},on:{click:function(t){return t.stopPropagation(),o.clickTitle.apply(null,arguments)}}},[o._v(" "+o._s(o.background.title||"Untitled")+" ")]),t("base-dropdown",{ref:"settingsDropdown",attrs:{"container-class":"dash","data-test":"settings-dropdown","mobile-toggle-hidden":!0,"position-offset":6,"disable-click-outside":!0,"disable-pointer-events":!0,"min-width":"240px"},on:{toggle:o.onDropdownToggle},nativeOn:{mouseenter:function(t){o.admiring||o.stopAdmire},mouseleave:function(t){o.admiring||o.admireOnHover}}},[t("base-dropdown-header",{scopedSlots:o._u([{key:"left",fn:function(){return[t("base-icon",{staticClass:"app-header-icon",attrs:{src:"icon/apps/photo-info"}}),t("span",{staticClass:"app-header-name"},[o._v("Photo")])]},proxy:!0}])}),o.sourceText?t("base-dropdown-text",{staticClass:"source-text",on:{click:o.clickTitle}},[t("span",[o._v(o._s(o.sourceText))]),t("base-icon",{attrs:{src:"external-link"}})],1):o._e(),t("base-dropdown-divider"),t("base-dropdown-option",{attrs:{"data-test":"favorite"},on:{click:o.toggleFavorite}},[t("base-icon",{class:{active:o.background.fav},attrs:{src:o.background.fav?"heart-off":"heart","data-test":"favorite-icon"}}),o._v(" "+o._s(o.background.fav?"Unfavorite":"Favorite")+" ")],1),t("base-dropdown-option",{attrs:{"data-test":"skip"},on:{click:o.skipBackground}},[t("base-icon",{attrs:{src:"redo"}}),o._v(" Skip to new photo "),o.$plus?o._e():t("span",{staticClass:"badge badge-plus"},[o._v("PLUS")])],1),t("base-dropdown-divider"),t("base-dropdown-option",{attrs:{"data-test":"manage"},on:{click:o.openSettings}},[t("base-icon",{attrs:{src:"images"}}),o._v(" Manage photos ")],1),t("base-dropdown-divider"),t("base-dropdown-option",{attrs:{"data-test":"show"},on:{click:o.toggleShowLocation}},[t("base-icon",{attrs:{src:"map-pin"}}),o._v(" Always show location "),t("toggle-switch",{staticClass:"dropdown-spacing-left",attrs:{value:o.showLocation}})],1),t("base-dropdown-option",{attrs:{"data-test":"settings"},on:{click:o.openSettings}},[t("base-icon",{attrs:{src:"settings"}}),o._v(" Settings ")],1)],1)]},proxy:!0}])},[t("base-icon",{staticClass:"photo-info-icon",attrs:{src:"icon/apps/photo-info",size:"var(--spacing-6)"}})],1)]},proxy:!0}])})],1)}),[],!1,null,"14405017").exports,T=document.querySelector(".region.bottom-left"),L=document.createElement("div");T.appendChild(L),new n({render:()=>r(H)}).$mount(L);