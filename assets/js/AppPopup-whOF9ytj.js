import{R as t}from"./ResizeSensor-ZXOsDHeC.js";import{g as i}from"./globalKeyEventManager-Dw4DvSNm.js";import{f as e,a as s,d as n,n as a,a3 as o}from"./index-DY0DW88M.js";import{n as p}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import"./Logger-CErMjlBd.js";import"./style-cpFB66wV.js";const l={name:"AppPopup",doNotWaitForMount:!0,directives:{ResizeSensor:t},provide(){return{appDimensions:this.dimensions}},props:{nippleDisplacement:{type:Number,default:e.nippleDisplacementPx},offset:{type:Number,default:0},width:{type:Number,default:300},position:{type:String,required:!0},detailedPosition:{type:Object,default:null},region:{type:[String,Array],required:!0},fullscreenAnimDuration:{type:Number,default:200},fullscreen:{type:Boolean,default:!1},hideAppsExclusions:{type:String,default:""},focused:{type:Boolean,default:null},nippleVisible:{type:Boolean,default:!0}},emits:["close"],setup:()=>({halfNippleWidth:e.nippleWidthPx/2,uuid:s.uuidv4()}),data(){return{flipHorizontalPosition:!1,shiftByPx:0,instantTransition:!1,inset:this.getDefaultInset(this.fullscreen),animating:!1,positionTransitionsActive:!1,fullscreenClass:this.fullscreen,dimensions:{maxHeight:null,width:null,height:null}}},computed:{contentMaxHeight(){return null===this.dimensions.maxHeight?"":this.dimensions.maxHeight+"px"},windowWidth:()=>n.windowDimensions.width,appStyle(){const t={...this.inset,position:this.positionFixed?"fixed !important":"absolute","transition-duration":this.instantTransition?"0s":this.fullscreenAnimDuration+"ms","max-height":`calc(var(--content-max-height) + ${this.nippleVisible?this.halfNippleWidth:0}px)`,"--opacity-anim-duration":this.fullscreenAnimDuration/2+"ms"};return this.positionFixed&&Object.assign(t,{width:"auto !important",height:"auto !important","max-height":"100dvh",overflow:"hidden"}),t},positionFixed(){return null!==this.inset.left},positionArray(){const t=this.position.split("-");return this.flipHorizontalPosition&&(t[1]=s.getOppositePosition(t[1])),t},nippleClass(){return["nipple"].concat(this.positionArray.map(s.getOppositePosition)).join("-")},positionCss(){const t=s.getOppositePosition(this.positionArray[0]),i=this.detailedPosition||{[t]:this.$mobile?"0":"100%",[s.getOppositePosition(this.positionArray[1])]:"50%"};return Object.entries(i).reduce(((t,[i,e],n)=>(this.detailedPosition?("number"!=typeof e&&console.warn("detailedPosition case with non-number value"),["left","right"].includes(i)&&(e=e-(this.flipHorizontalPosition?this.width-2*this.nippleDisplacement:0)-this.shiftByPx),["top","bottom"].includes(i)&&(e+=this.offset,t["--app-"+i]="0px")):(1===n&&(e=`calc(${e} - ${this.nippleDisplacement-this.shiftByPx}px)`),0===n&&(e=`calc(${e} + ${this.offset}px)`,t["--app-"+i]="0px",t["--app-"+s.getOppositePosition(i)]="auto")),t["--"+i]="number"==typeof e?e+"px":e,t)),{"--origin-inset":`var(--${t})`})},shiftedNippleDisplacement(){return this.nippleDisplacement-this.halfNippleWidth-this.shiftByPx},svgBackgroundVisible(){if(!this.animating&&!this.fullscreen&&!this.fullscreenClass)return!0;if(this.animating){if(!this.fullscreenClass&&this.fullscreen)return!0;if(!this.fullscreen&&this.fullscreenClass&&null===this.inset.left)return!0;if(!this.fullscreen&&!this.fullscreenClass&&this.instantTransition)return!0}return!1},svgBackgroundStyles(){if(!this.svgBackgroundVisible)return{};const t=s.getOppositePosition(this.positionArray[0]),i=s.getOppositePosition(this.positionArray[1]);let n,a=0,o=0,p=0,l=0,r=this.dimensions.width,h=this.dimensions.height;switch(t){case"top":n="0deg",l=this.halfNippleWidth,h-=this.halfNippleWidth;break;case"right":n="90deg",a=this.dimensions.width,r-=this.halfNippleWidth;break;case"bottom":n="180deg",o=this.dimensions.height,h-=this.halfNippleWidth;break;case"left":n="270deg",p=this.halfNippleWidth,r-=this.halfNippleWidth}switch(i){case"top":o=this.shiftedNippleDisplacement,"left"===t&&(o+=e.nippleWidthPx);break;case"right":a=this.dimensions.width-this.shiftedNippleDisplacement,"top"===t&&(a-=e.nippleWidthPx);break;case"left":a=this.shiftedNippleDisplacement,"bottom"===t&&(a+=e.nippleWidthPx)}return{app:{clipPath:`url(#clip${this.uuid})`,"-webkit-clip-path":`url(#clip${this.uuid})`,[`padding-${t}`]:this.halfNippleWidth+"px",[t]:`calc(var(--app-${t}) - ${this.halfNippleWidth}px)`,boxShadow:"none"},appSvgStyle:{width:"100%",height:"100%",position:"absolute","pointer-events":"none",inset:"0"},appSvgNipple:{rotate:n,translate:`${a}px ${o}px`},appSvgBackgroundRectangle:{translate:`${p}px ${l}px`,width:r+"px",height:h+"px"},appShadowDiv:{width:r+"px",height:h+"px",position:"absolute",inset:"auto 0",[t]:0,borderRadius:"10px",boxShadow:"1px 1px 5px rgba(0 0 0 / var(--opacity-stop-3))"}}},wrapperHeightDashPadding(){return"top"===this.positionArray[0]?"var(--dash-padding-bottom)":"var(--dash-padding-top)"}},watch:{fullscreen(t){t?this.enterFullscreen():this.exitFullscreen()},async windowWidth(){this.shiftByPx=0,await a(),this.shiftByPx=this.getShiftPx()},detailedPosition:{handler(){this.positionTransitionsActive=!0},deep:!0}},mounted(){var t;this.flipHorizontalPosition=this.shouldFlipHorizontalPosition(),a((()=>this.shiftByPx=this.getShiftPx())),this.hideOverlappingWidgets(),this.updateContentMaxHeight(),this.updateDimensions(),this.fullscreen&&(null==(t=m.widgetManager)||t.hideApps({exemptionSelectors:this.hideAppsExclusions,layer:"appPopup"}))},created(){i.registerEventListener("closeApp","keyup",27,this.close)},destroyed(){var t,e;i.removeEventListener("closeApp","keyup",27),null==(t=m.widgetManager)||t.refocusOverlap(this.region),this.fullscreen&&(null==(e=m.widgetManager)||e.showApps({layer:"appPopup"}))},methods:{updateDimensions({height:t,width:i}={}){if(void 0===t||void 0===i){const e=this.$refs.app;t=e.clientHeight,i=e.clientWidth}this.dimensions.height=t,this.dimensions.width=i},updateContentMaxHeight({height:t}={}){var i;void 0===t&&(t=null==(i=this.$refs["app-wrapper"])?void 0:i.clientHeight),this.dimensions.maxHeight=t},shouldFlipHorizontalPosition(){const t=this.$refs.app&&this.$refs.app.getBoundingClientRect();return!!t&&(t.left<0&&t.right-window.innerWidth>t.left)},getShiftPx(){const t=e.dashboardSidePaddingPx,i=this.$refs.app&&this.$refs.app.getBoundingClientRect();return i?"left"===this.positionArray[1]?i.left<t?i.left-t:Math.max(i.right-(window.innerWidth-t),0):"right"===this.positionArray[1]?i.right>window.innerWidth-t?window.innerWidth-i.right-t:Math.max(-1*(i.left-t),0):0:0},close(){this.$emit("close")},hideOverlappingWidgets(){var t,i,e;let s=(null==(t=this.$refs.view)?void 0:t.scrollHeight)||(null==(i=this.$refs.loading)?void 0:i.scrollHeight);s&&(null==(e=m.widgetManager)||e.unfocusOverlap(this.region,s))},getDefaultInset:t=>t?{left:0,right:0,top:0,bottom:0}:{left:null,right:null,top:null,bottom:null},async enterFullscreen(){var t;null==(t=m.widgetManager)||t.hideApps({exemptionSelectors:this.hideAppsExclusions,layer:"appPopup"}),this.animating=!0,await s.delay(this.fullscreenAnimDuration/2),this.instantTransition=!0,this.fullscreenClass=!0,this.inset=this.getFixedRectInset(),await s.doubleRaf(),this.inset=this.getDefaultInset(!0),this.instantTransition=!1,await s.delay(this.fullscreenAnimDuration),this.animating=!1,await s.delay(this.fullscreenAnimDuration/2)},async exitFullscreen(){var t;null==(t=m.widgetManager)||t.showApps({layer:"appPopup"}),this.animating=!0,await s.delay(this.fullscreenAnimDuration/2),this.instantTransition=!0,this.inset=this.getDefaultInset(!1),await a();const i=this.getFixedRectInset();this.inset=this.getDefaultInset(!0),await s.doubleRaf(),this.instantTransition=!1,this.fullscreenClass=!1,this.inset=i,await s.delay(this.fullscreenAnimDuration),this.instantTransition=!0,this.inset=this.getDefaultInset(!1),await s.doubleRaf(),this.instantTransition=!1,this.animating=!1,await s.delay(this.fullscreenAnimDuration/2)},getFixedRectInset(){const t=this.$refs.app;if(!t)return this.getDefaultInset(!0);let i=t.getBoundingClientRect();const e=0,s=0;return{top:i.y+e+"px",right:window.innerWidth-i.right+"px",bottom:window.innerHeight-i.bottom+s+"px",left:i.x+"px"}},onTransitionEnd(t){["top","left"].includes(t.propertyName)&&(this.positionTransitionsActive=!1)}}},r=()=>{o(((t,i)=>({"63e46f7e":t.width+"px","2c948d09":t.contentMaxHeight,c14ef2d0:t.shiftedNippleDisplacement+"px","2c9c9a08":t.wrapperHeightDashPadding})))},h=l.setup;l.setup=h?(t,i)=>(r(),h(t,i)):r;const d=p(l,(function(){var t=this,i=t._self._c;return i("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:t.updateContentMaxHeight,expression:"updateContentMaxHeight"}],ref:"app-wrapper",staticClass:"app-popup",class:[{animating:t.animating,fullscreen:t.fullscreenClass,focused:t.focused,unfocused:!1===t.focused,"position-transitions":t.positionTransitionsActive},t.nippleClass],style:t.positionCss,attrs:{"data-test":"app-popup-wrapper"},on:{transitionend:t.onTransitionEnd}},[i("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:t.updateDimensions,expression:"updateDimensions"}],ref:"app",staticClass:"app popup",style:[t.appStyle,t.svgBackgroundStyles.app],attrs:{"data-test":"app-popup"}},[t.svgBackgroundVisible?i("svg",{style:t.svgBackgroundStyles.appSvgStyle},[i("clipPath",{attrs:{id:"clip"+t.uuid}},[t.$mobile?t._e():i("path",{style:t.nippleVisible&&t.svgBackgroundStyles.appSvgNipple,attrs:{d:"M5.58579 1.41421L0 7H14L8.41421 1.41421C7.63316 0.633165 6.36684 0.633164 5.58579 1.41421Z",fill:"black"}}),i("rect",{style:t.svgBackgroundStyles.appSvgBackgroundRectangle,attrs:{x:"0",y:"0",rx:"10",ry:"10"}})])]):t._e(),t._t("default",null,{showFullscreenElements:t.fullscreenClass})],2),t.svgBackgroundStyles.appShadowDiv?i("div",{staticClass:"app-shadow",style:t.svgBackgroundStyles.appShadowDiv}):t._e()])}),[],!1,null,"8a9a13f4").exports;export{d as default};